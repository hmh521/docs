<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Redis | 轻狂帅哥</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-Y62GB4CEGY" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];        function gtag(){dataLayer.push(arguments);}        gtag('js', new Date());        gtag('config', 'G-Y62GB4CEGY');</script>
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
    <meta name="description" content="轻狂帅哥的笔记">
    <meta names="author" content="轻狂帅哥">
    <meta names="keywords" content="学习，成长，轻狂帅哥的笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.25c602b9.css" as="style"><link rel="preload" href="/assets/js/app.c2492ba0.js" as="script"><link rel="preload" href="/assets/js/7.6855d7f5.js" as="script"><link rel="preload" href="/assets/js/1.3a8374e6.js" as="script"><link rel="preload" href="/assets/js/19.8952cbc3.js" as="script"><link rel="preload" href="/assets/js/22.15b12c38.js" as="script"><link rel="prefetch" href="/assets/js/11.1265b5f0.js"><link rel="prefetch" href="/assets/js/12.54e0ed27.js"><link rel="prefetch" href="/assets/js/13.5d7b1694.js"><link rel="prefetch" href="/assets/js/14.0fe1e3ae.js"><link rel="prefetch" href="/assets/js/15.eba1568d.js"><link rel="prefetch" href="/assets/js/16.78b9404e.js"><link rel="prefetch" href="/assets/js/17.6ab60dbd.js"><link rel="prefetch" href="/assets/js/18.8a31c3b4.js"><link rel="prefetch" href="/assets/js/2.2f2477cb.js"><link rel="prefetch" href="/assets/js/20.8bc8271e.js"><link rel="prefetch" href="/assets/js/21.11541702.js"><link rel="prefetch" href="/assets/js/23.152108a2.js"><link rel="prefetch" href="/assets/js/24.8d878e40.js"><link rel="prefetch" href="/assets/js/25.823137af.js"><link rel="prefetch" href="/assets/js/26.f23185c9.js"><link rel="prefetch" href="/assets/js/27.43be4522.js"><link rel="prefetch" href="/assets/js/28.74ed9ffb.js"><link rel="prefetch" href="/assets/js/29.375d247b.js"><link rel="prefetch" href="/assets/js/3.9e2336a3.js"><link rel="prefetch" href="/assets/js/30.f0afd84f.js"><link rel="prefetch" href="/assets/js/31.6ae0e49e.js"><link rel="prefetch" href="/assets/js/32.d4e12b03.js"><link rel="prefetch" href="/assets/js/33.75ea2804.js"><link rel="prefetch" href="/assets/js/34.5890d495.js"><link rel="prefetch" href="/assets/js/35.ca26b966.js"><link rel="prefetch" href="/assets/js/36.e127d760.js"><link rel="prefetch" href="/assets/js/37.97de2b13.js"><link rel="prefetch" href="/assets/js/38.5db24d98.js"><link rel="prefetch" href="/assets/js/39.d9d174e0.js"><link rel="prefetch" href="/assets/js/4.e7d0eacc.js"><link rel="prefetch" href="/assets/js/40.aba65f1e.js"><link rel="prefetch" href="/assets/js/41.efe6c0c2.js"><link rel="prefetch" href="/assets/js/42.7803e2c3.js"><link rel="prefetch" href="/assets/js/43.c81a9343.js"><link rel="prefetch" href="/assets/js/44.560a8b57.js"><link rel="prefetch" href="/assets/js/45.799166cd.js"><link rel="prefetch" href="/assets/js/46.61a082bf.js"><link rel="prefetch" href="/assets/js/47.8989967c.js"><link rel="prefetch" href="/assets/js/48.c4f46e16.js"><link rel="prefetch" href="/assets/js/49.3ebd371b.js"><link rel="prefetch" href="/assets/js/5.947449fc.js"><link rel="prefetch" href="/assets/js/50.0b88538c.js"><link rel="prefetch" href="/assets/js/51.c8efff9d.js"><link rel="prefetch" href="/assets/js/52.d2410e99.js"><link rel="prefetch" href="/assets/js/53.8168a589.js"><link rel="prefetch" href="/assets/js/54.9069084d.js"><link rel="prefetch" href="/assets/js/55.bfe16c8a.js"><link rel="prefetch" href="/assets/js/6.15ee44d5.js"><link rel="prefetch" href="/assets/js/8.c7e6bb89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.94c2c2a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25c602b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="轻狂帅哥" class="logo"> <span class="site-name can-hide">轻狂帅哥</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>redis</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/redis/" aria-current="page" class="active sidebar-link">Redis</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/redis/#redis-的使用场景" class="sidebar-link">Redis 的使用场景</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#缓存穿透" class="sidebar-link">缓存穿透</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#缓存击穿" class="sidebar-link">缓存击穿</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#缓存雪崩" class="sidebar-link">缓存雪崩</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#双写一致性" class="sidebar-link">双写一致性</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#redis持久化" class="sidebar-link">redis持久化</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#redis数据过期策略" class="sidebar-link">Redis数据过期策略</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#redis的数据淘汰策略" class="sidebar-link">Redis的数据淘汰策略</a></li><li class="sidebar-sub-header"><a href="/interview/redis/#redis实现分布式锁" class="sidebar-link">Redis实现分布式锁</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="redis"><a href="#redis" class="header-anchor">#</a> Redis</h1> <h2 id="redis-的使用场景"><a href="#redis-的使用场景" class="header-anchor">#</a> Redis 的使用场景</h2> <ol><li>缓存</li> <li>分布式锁</li> <li>消息队列、延迟队列</li></ol> <h2 id="缓存穿透"><a href="#缓存穿透" class="header-anchor">#</a> 缓存穿透</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>查询一个不存在的数据，MySQL 查询不到数据也不会直接写入缓存，这会导致每次请求都查询数据库。</p></div> <h4 id="解决方案"><a href="#解决方案" class="header-anchor">#</a> 解决方案</h4> <ol><li><p><strong>缓存空数据</strong><br>
查询返回的数据为空时，仍将这个空数据写入缓存。<br>
优点：可以防止缓存穿透。<br>
缺点：缓存空数据可能会占用大量缓存空间。</p></li> <li><p><strong>布隆过滤器</strong></p> <ul><li>缓存预热：系统启动时，把所有可能的数据都加载到缓存中。</li> <li>位图（bitmap）：相当于一个以位为单位的数组，数组中的每个元素只能是 0 或 1，用于判断某个元素是否存在。</li></ul> <p><strong>布隆过滤器用来判断一个元素是否存在于一个集合中。</strong></p> <ul><li><strong>存储数据</strong>：将数据通过多个哈希函数映射到位图中的多个位置，并将这些位置的值置为 1。</li> <li><strong>查询数据</strong>：将数据通过多个哈希函数映射到位图中的多个位置，判断这些位置的值是否都为 1。</li> <li>可能存在误判：数组越小误判率越高，数组越大误判率越低，但占用内存越大。误判率是可以设置的。</li></ul></li></ol> <p><img src="/assets/img/bulong.d6812e4d.png" alt="布隆过滤器"></p> <h4 id="实现方式"><a href="#实现方式" class="header-anchor">#</a> 实现方式</h4> <ul><li>Guava</li> <li>Redisson</li></ul> <h4 id="优缺点"><a href="#优缺点" class="header-anchor">#</a> 优缺点</h4> <ol><li>查询速度快 2. 占用内存少 3. 可能存在误判 4. 无法删除数据</li></ol> <h2 id="缓存击穿"><a href="#缓存击穿" class="header-anchor">#</a> 缓存击穿</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>缓存中的数据过期，大量请求同时查询数据库，导致数据库压力过大。</p></div> <p>解决方案:</p> <ol><li>互斥锁 性能差
<img src="/assets/img/lock.50e53bf5.png" alt="互斥锁"></li> <li>逻辑过期 不能保证数据绝对一致
<img src="/assets/img/expire.0a9f5144.png" alt="逻辑过期"></li></ol> <h2 id="缓存雪崩"><a href="#缓存雪崩" class="header-anchor">#</a> 缓存雪崩</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>缓存中的数据同时过期，大量请求同时查询数据库，导致数据库压力过大。</p></div> <p>解决方案:</p> <ol><li>给不同的key设置不同的过期时间</li> <li>利用Redis集群提高服务的高可用性  哨兵模式、集群模式</li> <li>限流降级 nginx/gateway 保底策略</li> <li>给业务添加多级缓存 Guava或Caffeine</li></ol> <h2 id="双写一致性"><a href="#双写一致性" class="header-anchor">#</a> 双写一致性</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>缓存和数据库的数据要保持一致。</p></div> <p>解决方案:</p> <blockquote><p>先删除缓存，还是先更新数据库？</p></blockquote> <p>延迟双删策略 有可能会出现数据不一致</p> <p>分布式锁 保证数据一致性</p> <p>异步更新缓存 保证数据最终一致性  MQ的可靠性或者Canal中间件读取binlog  可以接收短暂延迟</p> <h2 id="redis持久化"><a href="#redis持久化" class="header-anchor">#</a> redis持久化</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>Redis 持久化是指将 Redis 在内存中的数据保存到硬盘中，以便在 Redis 重启后可以再次加载使用。</p></div> <h3 id="rdb-持久化"><a href="#rdb-持久化" class="header-anchor">#</a> RDB 持久化</h3> <p>RDB 持久化是通过快照的方式来进行持久化的，当满足一定条件时，Redis 会自动将内存中的数据保存到硬盘中。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>save <span class="token number">900</span> <span class="token number">1</span> <span class="token comment"># 900 秒内有 1 个 key 发生变化</span>
bgsave <span class="token comment"># 异步保存</span>
</code></pre></div><h4 id="执行原理"><a href="#执行原理" class="header-anchor">#</a> 执行原理</h4> <ol><li>Redis 会 fork 出一个子进程，子进程负责将内存数据写入到临时文件中。</li> <li>页表: 内存中的数据是通过页表来管理的，子进程会复制一份父进程的页表，这样就可以保证子进程可以访问到父进程的所有数据。
<img src="/assets/img/RDB.3c22e3e2.png" alt="逻辑过期"></li></ol> <h3 id="aof-持久化"><a href="#aof-持久化" class="header-anchor">#</a> AOF 持久化</h3> <p>AOF 持久化是通过记录 Redis 服务器所处理的每一个写操作来记录数据库的变化。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>appendonly <span class="token function">yes</span>
appendfsync always <span class="token comment"># 每次写入都同步</span>
appendfsync everysec <span class="token comment"># 每秒同步</span>
appendfsync no <span class="token comment"># 不同步</span>
bgrewriteaof <span class="token comment"># 重写AOF文件 最少的命令达到相同的效果</span>
</code></pre></div><p>redis.conf 配置文件</p> <div class="language-shell extra-class"><pre class="language-shell"><code>appendonly <span class="token function">yes</span>
appendfsync everysec
auto-aof-rewrite-percentage <span class="token number">100</span> <span class="token comment"># 当AOF文件大小超过上次重写后的大小100%时，触发重写</span>
auto-aof-rewrite-min-size 64mb <span class="token comment"># AOF文件大小超过64M时，触发重写</span>
</code></pre></div><p>实际工作都是使用 RDB 和 AOF 混合使用，先读取 AOF 文件，再读取 RDB 文件。</p> <h2 id="redis数据过期策略"><a href="#redis数据过期策略" class="header-anchor">#</a> Redis数据过期策略</h2> <blockquote><p>假如redis的key过期之后，会立即删除吗？</p></blockquote> <h3 id="惰性删除"><a href="#惰性删除" class="header-anchor">#</a> 惰性删除</h3> <p>当客户端访问某个 key 时，Redis 会检查这个 key 是否过期，如果过期则删除。</p> <p>对内存不是很友好，可能会导致内存泄漏。</p> <h3 id="定期删除"><a href="#定期删除" class="header-anchor">#</a> 定期删除</h3> <p>Redis 默认每隔 100ms 就随机抽取一些 key 进行检查，如果过期则删除。</p> <p>难以确定删除操作执行的时常和频率。</p> <p>Redis 的过期键删除策略是惰性删除和定期删除的结合。</p> <h2 id="redis的数据淘汰策略"><a href="#redis的数据淘汰策略" class="header-anchor">#</a> Redis的数据淘汰策略</h2> <blockquote><p>当 Redis 的内存不足时，会如何处理？</p></blockquote> <p>LRU（Least Recently Used）：最近最少使用</p> <p>LFU（Least Frequently Used）：最少频率使用</p> <p>8种数据淘汰策略：</p> <ul><li>noeviction：默认策略，不会删除任何数据，直接返回错误。</li> <li>volatile-lru：从设置了过期时间的数据集中删除最近最少使用的数据。</li> <li>allkeys-random：从所有数据集中随机删除数据。</li> <li>volatile-random：从设置了过期时间的数据集中随机删除数据。</li> <li>volatile-ttl：从设置了过期时间的数据集中删除最快要过期的数据。</li> <li>allkeys-lru：从所有数据集中删除最近最少使用的数据。</li> <li>allkeys-lfu：从所有数据集中删除最不经常使用的数据。</li> <li>volatile-lfu：从设置了过期时间的数据集中删除最不经常使用的数据。</li></ul> <ol><li>优先使用 allkeys-lru策略，如果有冷热数据区分</li> <li>优先使用 allkeys-random策略，如果没有冷热数据区分</li> <li>优先使用 volatile-lru策略，如果有置顶不设置过期时间的热数据</li> <li>优先使用 allkeys-lfu/volatile-lfu 策略，如果短时间高频访问</li></ol> <blockquote><p>1.数据库有1000万数据，Redis只能缓存20万数据，如何保证热点数据都在内存中？</p></blockquote> <p>使用allkeys-lru策略，将热点数据放在内存中。</p> <blockquote><p>2.redis的内存用完了会发生什么？</p></blockquote> <ol><li>内存淘汰策略</li></ol> <h2 id="redis实现分布式锁"><a href="#redis实现分布式锁" class="header-anchor">#</a> Redis实现分布式锁</h2> <p>使用场景:</p> <ol><li>需要结合项目中的业务进行回答，通常情况下，分布式锁用于解决并发问题。</li></ol> <ul><li>集群下的定时任务、抢单、幂等性场景。</li></ul> <h3 id="使用原理"><a href="#使用原理" class="header-anchor">#</a> 使用原理</h3> <ol><li>setnx(key, value)：如果 key 不存在，则设置 key 的值为 value，返回 1；如果 key 存在，则返回 0。</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code># 1. 加锁 NX 互斥 EX 过期时间
SET KEY value NX EX 10
# 2. 解锁
DEL KEY
</code></pre></div><blockquote><p>redis分布式锁如何合理控制锁的有效时长？</p></blockquote> <ol><li>业务执行时间不确定，锁的有效时长应该大于业务执行时间。</li> <li>锁续期</li></ol> <h3 id="redission实现的分布式锁"><a href="#redission实现的分布式锁" class="header-anchor">#</a> redission实现的分布式锁</h3> <ol><li>加锁后 每隔一段时间续期 (releaseTime - currentTime) / 3 每隔10秒续期一次</li> <li>while循环不断尝试获取锁，直到获取锁成功或者超时 重试机制</li> <li>加锁和设置过期时间都是基于Lua脚本实现的，保证原子性</li> <li>redisson实现的分布式锁是可重入锁 跟当前的线程绑定 必须是同一个线程才能重入</li> <li>利用hash结构 线程id和冲入次数</li> <li>红锁： 不能只能一个节点加锁，需要多个节点加锁，（n/2）+ 1个节点加锁成功，才算成功 不能保证主从一致性</li> <li>redis 保证ap 高可用  Zookeeper 保证cp 高一致性</li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024年11月13日星期三晚上11点53分</span></div></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c2492ba0.js" defer></script><script src="/assets/js/7.6855d7f5.js" defer></script><script src="/assets/js/1.3a8374e6.js" defer></script><script src="/assets/js/19.8952cbc3.js" defer></script><script src="/assets/js/22.15b12c38.js" defer></script>
  </body>
</html>
