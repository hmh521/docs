<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>多线程 | 轻狂帅哥</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-Y62GB4CEGY" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];        function gtag(){dataLayer.push(arguments);}        gtag('js', new Date());        gtag('config', 'G-Y62GB4CEGY');</script>
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
    <meta name="description" content="轻狂帅哥的笔记">
    <meta names="author" content="轻狂帅哥">
    <meta names="keywords" content="学习，成长，轻狂帅哥的笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.25c602b9.css" as="style"><link rel="preload" href="/assets/js/app.c2492ba0.js" as="script"><link rel="preload" href="/assets/js/7.6855d7f5.js" as="script"><link rel="preload" href="/assets/js/1.3a8374e6.js" as="script"><link rel="preload" href="/assets/js/21.11541702.js" as="script"><link rel="preload" href="/assets/js/22.15b12c38.js" as="script"><link rel="prefetch" href="/assets/js/11.1265b5f0.js"><link rel="prefetch" href="/assets/js/12.54e0ed27.js"><link rel="prefetch" href="/assets/js/13.5d7b1694.js"><link rel="prefetch" href="/assets/js/14.0fe1e3ae.js"><link rel="prefetch" href="/assets/js/15.eba1568d.js"><link rel="prefetch" href="/assets/js/16.78b9404e.js"><link rel="prefetch" href="/assets/js/17.6ab60dbd.js"><link rel="prefetch" href="/assets/js/18.8a31c3b4.js"><link rel="prefetch" href="/assets/js/19.8952cbc3.js"><link rel="prefetch" href="/assets/js/2.2f2477cb.js"><link rel="prefetch" href="/assets/js/20.8bc8271e.js"><link rel="prefetch" href="/assets/js/23.152108a2.js"><link rel="prefetch" href="/assets/js/24.8d878e40.js"><link rel="prefetch" href="/assets/js/25.823137af.js"><link rel="prefetch" href="/assets/js/26.f23185c9.js"><link rel="prefetch" href="/assets/js/27.43be4522.js"><link rel="prefetch" href="/assets/js/28.74ed9ffb.js"><link rel="prefetch" href="/assets/js/29.375d247b.js"><link rel="prefetch" href="/assets/js/3.9e2336a3.js"><link rel="prefetch" href="/assets/js/30.f0afd84f.js"><link rel="prefetch" href="/assets/js/31.6ae0e49e.js"><link rel="prefetch" href="/assets/js/32.d4e12b03.js"><link rel="prefetch" href="/assets/js/33.75ea2804.js"><link rel="prefetch" href="/assets/js/34.5890d495.js"><link rel="prefetch" href="/assets/js/35.ca26b966.js"><link rel="prefetch" href="/assets/js/36.e127d760.js"><link rel="prefetch" href="/assets/js/37.97de2b13.js"><link rel="prefetch" href="/assets/js/38.5db24d98.js"><link rel="prefetch" href="/assets/js/39.d9d174e0.js"><link rel="prefetch" href="/assets/js/4.e7d0eacc.js"><link rel="prefetch" href="/assets/js/40.aba65f1e.js"><link rel="prefetch" href="/assets/js/41.efe6c0c2.js"><link rel="prefetch" href="/assets/js/42.7803e2c3.js"><link rel="prefetch" href="/assets/js/43.c81a9343.js"><link rel="prefetch" href="/assets/js/44.560a8b57.js"><link rel="prefetch" href="/assets/js/45.799166cd.js"><link rel="prefetch" href="/assets/js/46.61a082bf.js"><link rel="prefetch" href="/assets/js/47.8989967c.js"><link rel="prefetch" href="/assets/js/48.c4f46e16.js"><link rel="prefetch" href="/assets/js/49.3ebd371b.js"><link rel="prefetch" href="/assets/js/5.947449fc.js"><link rel="prefetch" href="/assets/js/50.0b88538c.js"><link rel="prefetch" href="/assets/js/51.c8efff9d.js"><link rel="prefetch" href="/assets/js/52.d2410e99.js"><link rel="prefetch" href="/assets/js/53.8168a589.js"><link rel="prefetch" href="/assets/js/54.9069084d.js"><link rel="prefetch" href="/assets/js/55.bfe16c8a.js"><link rel="prefetch" href="/assets/js/6.15ee44d5.js"><link rel="prefetch" href="/assets/js/8.c7e6bb89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.94c2c2a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25c602b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="轻狂帅哥" class="logo"> <span class="site-name can-hide">轻狂帅哥</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>thread</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/thread/" aria-current="page" class="active sidebar-link">多线程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/thread/#进程和线程的区别" class="sidebar-link">进程和线程的区别</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#并行和并发的区别" class="sidebar-link">并行和并发的区别</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#创建线程的方式有哪些" class="sidebar-link">创建线程的方式有哪些</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#runnable和callable的区别" class="sidebar-link">runnable和callable的区别</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#线程包含哪些状态-状态之间是如何变化的" class="sidebar-link">线程包含哪些状态，状态之间是如何变化的</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#新建t1、t2、t3三个线程-如何保证t2在t1执行完后执行-t3在t2执行完后执行" class="sidebar-link">新建T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#notify和notifyall的区别" class="sidebar-link">notify和notifyAll的区别</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#wait和sleep的区别" class="sidebar-link">wait和sleep的区别</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#如何停止正在运行的线程" class="sidebar-link">如何停止正在运行的线程</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#synchronized关键字的底层原理-悲观锁" class="sidebar-link">synchronized关键字的底层原理 悲观锁</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#谈谈jmm" class="sidebar-link">谈谈JMM</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#cas-乐观锁" class="sidebar-link">CAS 乐观锁</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#谈谈你对volatile的理解" class="sidebar-link">谈谈你对volatile的理解</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#什么是aqs" class="sidebar-link">什么是AQS</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#reentrantlock的实现原理" class="sidebar-link">ReentrantLock的实现原理</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#synchronized和-lock的区别" class="sidebar-link">synchronized和 Lock的区别</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#产生死锁的条件" class="sidebar-link">产生死锁的条件</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#如何进行死锁诊断" class="sidebar-link">如何进行死锁诊断？</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#concurrenthashmap" class="sidebar-link">ConcurrentHashMap</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#导致并发程序出现问题的根本原因是什么" class="sidebar-link">导致并发程序出现问题的根本原因是什么？</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#线程池的核心参数" class="sidebar-link">线程池的核心参数</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#线程池有哪些常见的阻塞队列" class="sidebar-link">线程池有哪些常见的阻塞队列</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#如何确定核心线程数" class="sidebar-link">如何确定核心线程数</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#线程池的种类" class="sidebar-link">线程池的种类</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#为什么不建议使用executors创建线程池" class="sidebar-link">为什么不建议使用Executors创建线程池</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#线程池的使用场景" class="sidebar-link">线程池的使用场景</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#如何控制某个方法的并发数" class="sidebar-link">如何控制某个方法的并发数</a></li><li class="sidebar-sub-header"><a href="/interview/thread/#threadlocal的理解" class="sidebar-link">ThreadLocal的理解</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="多线程"><a href="#多线程" class="header-anchor">#</a> 多线程</h1> <h2 id="进程和线程的区别"><a href="#进程和线程的区别" class="header-anchor">#</a> 进程和线程的区别</h2> <ul><li>程序由指令和数据组成，进程是程序的一次执行，线程是进程的一个执行流程。</li> <li>当一个程序被运行，从磁盘加载程序的代码到内存，这时就开启了一个进程。</li> <li>一个线程就是一个指令流，将指令流中的一条条指令以一定的顺序交给CPU执行。</li> <li>一个进程里面分为一到多个线程。</li></ul> <h3 id="区别"><a href="#区别" class="header-anchor">#</a> 区别</h3> <ol><li>进程包含线程</li> <li>不同的进程使用不同的内存空间，线程共享进程的内存空间</li> <li>线程更加轻量级，创建和销毁线程的开销比进程小</li></ol> <h2 id="并行和并发的区别"><a href="#并行和并发的区别" class="header-anchor">#</a> 并行和并发的区别</h2> <ul><li>并行：多个任务同时执行</li> <li>并发：多个任务交替执行</li></ul> <ol><li>单核cpu下线程实际是并发执行的，多核cpu下线程才是并行执行的。</li> <li>并发：同一时间应对多件事情的能力</li> <li>并行：同一时间做多件事情的能力</li></ol> <h2 id="创建线程的方式有哪些"><a href="#创建线程的方式有哪些" class="header-anchor">#</a> 创建线程的方式有哪些</h2> <ol><li>继承Thread类</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyThread&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>实现Runnable接口</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRunnable</span> <span class="token keyword">implements</span> <span class="token class-name">Runnable</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;MyRunnable&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>实现Callable接口</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyCallable</span> <span class="token keyword">implements</span> <span class="token class-name">Callable</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
   
        <span class="token keyword">return</span> <span class="token string">&quot;MyCallable&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>使用线程池</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token class-name">ExecutorService</span> executorService <span class="token operator">=</span> <span class="token class-name">Executors</span><span class="token punctuation">.</span><span class="token function">newFixedThreadPool</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建一个固定大小的线程池</span>
executorService<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyRunnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行Runnable</span>
<span class="token class-name">Future</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> future <span class="token operator">=</span> executorService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyCallable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 执行Callable</span>
</code></pre></div><h2 id="runnable和callable的区别"><a href="#runnable和callable的区别" class="header-anchor">#</a> runnable和callable的区别</h2> <ol><li>Runnable的run方法没有返回值，Callable的call有返回值</li> <li>Runnable的run方法不能抛出异常，Callable的call方法可以抛出异常</li></ol> <h2 id="线程包含哪些状态-状态之间是如何变化的"><a href="#线程包含哪些状态-状态之间是如何变化的" class="header-anchor">#</a> 线程包含哪些状态，状态之间是如何变化的</h2> <ol><li>NEW：新建状态</li> <li>RUNNABLE：可运行状态</li> <li>BLOCKED：阻塞状态</li> <li>WAITING：等待状态</li> <li>TIMED_WAITING：超时等待状态</li> <li>TERMINATED：终止状态</li></ol> <ul><li>线程的状态之间是如何变化的</li></ul> <p><img src="/assets/img/threadState.cf89efd0.png" alt="threadState.png"></p> <ul><li>创建线程对象是新建状态</li> <li>调用了start()方法后，线程进入可运行状态</li> <li>线程获取了cpu的执行权，执行结束是终止状态</li> <li>在可执行状态的过程中，如果没有获取cpu的执行权，可能会切换其他状态</li></ul> <h2 id="新建t1、t2、t3三个线程-如何保证t2在t1执行完后执行-t3在t2执行完后执行"><a href="#新建t1、t2、t3三个线程-如何保证t2在t1执行完后执行-t3在t2执行完后执行" class="header-anchor">#</a> 新建T1、T2、T3三个线程，如何保证T2在T1执行完后执行，T3在T2执行完后执行</h2> <ol><li>可以使用线程中的join方法解决</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JoinTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> t1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;T1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                t1<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;T2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Thread</span> t3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                t2<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;T3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t1<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t2<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        t3<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="notify和notifyall的区别"><a href="#notify和notifyall的区别" class="header-anchor">#</a> notify和notifyAll的区别</h2> <ol><li>notify：唤醒一个等待线程</li> <li>notifyAll：唤醒所有等待线程</li></ol> <h2 id="wait和sleep的区别"><a href="#wait和sleep的区别" class="header-anchor">#</a> wait和sleep的区别</h2> <h3 id="共同点"><a href="#共同点" class="header-anchor">#</a> 共同点</h3> <ol><li>wait和sleep都可以进入阻塞状态</li> <li>都可以被打断唤醒</li></ol> <h3 id="不同点"><a href="#不同点" class="header-anchor">#</a> 不同点</h3> <ul><li>sleep是Thread类的静态方法，wait是Object类的方法</li> <li>sleep不会释放锁，wait会释放锁</li> <li>sleep必须指定时间，wait可以指定时间也可以不指定时间</li> <li>wait必须在同步代码块中使用，sleep可以在任何地方使用</li></ul> <h2 id="如何停止正在运行的线程"><a href="#如何停止正在运行的线程" class="header-anchor">#</a> 如何停止正在运行的线程</h2> <ul><li>使用退出标志</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopThread</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">volatile</span> <span class="token keyword">boolean</span> flag <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span>flag<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        flag <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用interrupt方法</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopThread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isInterrupted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        thread<span class="token punctuation">.</span><span class="token function">interrupt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 阻塞的线程会抛出InterruptedException异常</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>使用stop方法（不推荐）</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StopThread</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Thread</span> thread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;running&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        thread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        thread<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="synchronized关键字的底层原理-悲观锁"><a href="#synchronized关键字的底层原理-悲观锁" class="header-anchor">#</a> synchronized关键字的底层原理 悲观锁</h2> <ul><li>Monitor
<img src="/assets/img/Monitor.f415c42e.png" alt="Monitor.png"></li></ul> <ol><li>每个对象都有一个Monitor对象，Monitor对象是由C++实现的</li> <li>Monitor对象里面有一个Owner字段，记录当前拥有锁的线程，为null表示没有线程拥有锁</li> <li>Monitor对象里面有一个EntryList字段，记录等待锁的线程</li> <li>Monitor对象里面有一个WaitSet字段，记录调用了wait方法的线程</li></ol> <ul><li>Monitor 是重量级锁，会消耗系统资源，JVM会尽量减少Monitor的使用</li></ul> <h2 id="谈谈jmm"><a href="#谈谈jmm" class="header-anchor">#</a> 谈谈JMM</h2> <ul><li>JMM（Java Memory Model）是一种规范，定义了Java虚拟机和计算机硬件之间的工作协议</li> <li>共享内存中多线程程序读写操作的行为规范</li> <li>工作内存和主内存，线程和线程之间是相互隔离的，交互需要通过主内存来完成。</li></ul> <h2 id="cas-乐观锁"><a href="#cas-乐观锁" class="header-anchor">#</a> CAS 乐观锁</h2> <ul><li>CAS（Compare And Swap）是一种乐观锁技朽，通过比较当前值和期望值是否一样，一样则更新，不一样则不更新</li> <li>因为没有加锁，所以线程不会陷入阻塞，效率较高。</li> <li>如何竞争激烈，重试频繁发生，效率会受影响。</li> <li>底层依赖于unsafe类来直接调用操作系统底层的CAS指令</li> <li>ReentrantLock、AtomicInteger等类都是基于CAS实现的</li></ul> <h2 id="谈谈你对volatile的理解"><a href="#谈谈你对volatile的理解" class="header-anchor">#</a> 谈谈你对volatile的理解</h2> <ul><li>一旦一个共享变量被volatile修饰</li></ul> <ol><li>保证了线程之间的可见性 读取的都是主内存</li> <li>禁止指令重排序 写共享变量时加入不同的屏障，阻止其他读写操作越过屏障，从而达到禁止指令重排序的目的</li></ol> <h2 id="什么是aqs"><a href="#什么是aqs" class="header-anchor">#</a> 什么是AQS</h2> <ul><li>AQS（AbstractQueuedSynchronizer）是JUC包中的一个工具类，是用来构建锁和同步器的基础框架</li> <li>抽象队列同步器，是一个用来构建锁和同步器的框架，ReentrantLock、CountDownLatch、Semaphore、ReentrantReadWriteLock等都是基于AQS实现的</li></ul> <h3 id="aqs和synchronized的区别"><a href="#aqs和synchronized的区别" class="header-anchor">#</a> AQS和synchronized的区别</h3> <ol><li>synchronized是关键字，AQS是一个工具类</li> <li>synchronized是悲观锁，AQS是乐观锁</li> <li>synchronized只能实现互斥锁，AQS可以实现互斥锁和读写锁</li></ol> <h3 id="工作机制"><a href="#工作机制" class="header-anchor">#</a> 工作机制</h3> <ol><li>AQS维护了一个volatile int state，表示当前同步状态</li> <li>AQS维护了一个FIFO队列，用于存放等待获取锁的线程</li> <li>AQS定义了两种资源共享方式，独占和共享</li></ol> <h3 id="多线程共同去抢资源是如何保证原子性"><a href="#多线程共同去抢资源是如何保证原子性" class="header-anchor">#</a> 多线程共同去抢资源是如何保证原子性？</h3> <ul><li>通过CAS操作保证原子性</li> <li>可以是公平锁，也可以是非公平锁</li></ul> <h2 id="reentrantlock的实现原理"><a href="#reentrantlock的实现原理" class="header-anchor">#</a> ReentrantLock的实现原理</h2> <ul><li>ReentrantLock是基于AQS实现的</li> <li>可中断</li> <li>可以设置超时时间</li> <li>可以设置公平锁</li> <li>支持多个条件变量</li> <li>与synchronized一样，都支持重入
主要是利用CAS和A队列来实现的，默认非公平锁，可以通过构造方法设置为公平锁。</li></ul> <h2 id="synchronized和-lock的区别"><a href="#synchronized和-lock的区别" class="header-anchor">#</a> synchronized和 Lock的区别</h2> <ol><li>synchronized是关键字，Lock是一个接口</li> <li>synchronized和Lock都是悲观锁，具备互斥、同步、锁重入的功能</li> <li>synchronized 退出同步块时会自动释放锁，Lock需要手动释放锁</li> <li>Lock提供了许多syncrhonized不具备的特性，如可中断、超时、公平锁等</li></ol> <h2 id="产生死锁的条件"><a href="#产生死锁的条件" class="header-anchor">#</a> 产生死锁的条件</h2> <ol><li>互斥条件：一个资源每次只能被一个进程使用</li> <li>请求与保持条件：一个进程因请求资源而阻塞时，对已获得的资源保持不放</li> <li>不剥夺条件：进程已获得的资源，在未使用完之前，不能强行剥夺</li> <li>循环等待条件：若干进程之间形成一种头尾相接的循环等待资源关系</li></ol> <h2 id="如何进行死锁诊断"><a href="#如何进行死锁诊断" class="header-anchor">#</a> 如何进行死锁诊断？</h2> <ol><li>jps查看进程号</li> <li>jstack 进程号 查看线程堆栈信息</li></ol> <div class="language-xml extra-class"><pre class="language-xml"><code>jps 查看进程号
jstack -l 进程号
</code></pre></div><h3 id="可视化工具"><a href="#可视化工具" class="header-anchor">#</a> 可视化工具</h3> <ul><li>jconsole是JDK自带的监控工具，可以查看线程、内存、类、MBean等信息</li> <li>VisualVM是一个免费的开源工具，可以查看线程、内存、类、GC、CPU等信息</li></ul> <h2 id="concurrenthashmap"><a href="#concurrenthashmap" class="header-anchor">#</a> ConcurrentHashMap</h2> <ul><li>ConcurrentHashMap是一个线程安全的哈希表，是HashMap的线程安全版本</li> <li>JDK1.7采用分段锁实现，JDK1.8采用CAS和synchronized实现</li> <li>分段锁：将整个哈希表分为N个Segment，每个Segment都是一个小的哈希表，每个Segment都有自己的锁，只要保证每个Segment是线程安全的，就可以保证整个ConcurrentHashMap是线程安全的</li> <li>JDK1.8采用CAS和synchronized实现，将整个哈希表分为N个桶，每个桶是一个链表，当链表长度大于8时，链表转换为红黑树，提高查询效率</li> <li>CAS 控制数组节点的添加</li> <li>synchronized 控制链表的添加</li></ul> <h2 id="导致并发程序出现问题的根本原因是什么"><a href="#导致并发程序出现问题的根本原因是什么" class="header-anchor">#</a> 导致并发程序出现问题的根本原因是什么？</h2> <ul><li>原子性 一个或多个操作要么全部执行成功，要么全部执行失败</li> <li>可见性 让一个线程对共享变量的修改，对其他线程是立即可见的</li> <li>有序性 保证程序执行的顺序按照代码的先后顺序执行</li></ul> <h2 id="线程池的核心参数"><a href="#线程池的核心参数" class="header-anchor">#</a> 线程池的核心参数</h2> <ol><li>corePoolSize 核心线程数</li> <li>maximumPoolSize 最大线程数 = 核心线程数 + 救急线程数</li> <li>keepAliveTime 线程空闲时间</li> <li>unit 时间单位</li> <li>workQueue 阻塞队列</li> <li>threadFactory 线程工厂</li> <li>handler 拒绝策略</li></ol> <h3 id="拒绝策略"><a href="#拒绝策略" class="header-anchor">#</a> 拒绝策略</h3> <ol><li>AbortPolicy 直接抛出异常</li> <li>CallerRunsPolicy 由调用线程处理</li> <li>DiscardPolicy 直接丢弃任务</li> <li>DiscardOldestPolicy 丢弃队列中最老的任务</li></ol> <h2 id="线程池有哪些常见的阻塞队列"><a href="#线程池有哪些常见的阻塞队列" class="header-anchor">#</a> 线程池有哪些常见的阻塞队列</h2> <ol><li>ArrayBlockingQueue 基于数组的有界队列</li> <li>LinkedBlockingQueue 基于链表的有界队列 默认无界</li> <li>DelayedWorkQueue 是一个优先级队列</li> <li>SynchronousQueue 不存储元素的队列</li></ol> <h2 id="如何确定核心线程数"><a href="#如何确定核心线程数" class="header-anchor">#</a> 如何确定核心线程数</h2> <ol><li>IO密集型 2N+1 文件读写、网络读写、DB读写</li> <li>CPU密集型 N+1 计算型代码、Bitmap、Gson转换</li></ol> <h2 id="线程池的种类"><a href="#线程池的种类" class="header-anchor">#</a> 线程池的种类</h2> <ol><li>newFixedThreadPool 固定大小线程池 适用于任务量已知，相对耗时的任务。</li> <li>newSingleThreadExecutor 单线程线程池 适用于按照顺序执行任务</li> <li>newCachedThreadPool 缓存线程池 适用于任务量比较密集，任务执行时间短的任务</li> <li>newScheduledThreadPool 定时线程池 适用于需要定时执行任务的场景</li></ol> <h2 id="为什么不建议使用executors创建线程池"><a href="#为什么不建议使用executors创建线程池" class="header-anchor">#</a> 为什么不建议使用Executors创建线程池</h2> <ol><li>newFixedThreadPool 和 newSingleThreadExecutor 使用的是无界队列，可能会导致OOM</li> <li>newCachedThreadPool 使用的是SynchronousQueue，可能会导致线程数过多，导致OOM</li></ol> <h2 id="线程池的使用场景"><a href="#线程池的使用场景" class="header-anchor">#</a> 线程池的使用场景</h2> <ol><li>CountDownLatch 用于等待多个线程执行完毕</li></ol> <ul><li>初始化CountDownLatch时，需要传入一个int类型的参数，表示计数器的初始值</li> <li>调用CountDownLatch的countDown方法时，计数器减1</li> <li>调用CountDownLatch的await方法时，会阻塞当前线程，直到计数器的值为0</li></ul> <h3 id="es批量导入数据"><a href="#es批量导入数据" class="header-anchor">#</a> ES批量导入数据</h3> <p><img src="/assets/img/page.f2becc6a.png" alt="page.png"></p> <h3 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CountDownLatchDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">CountDownLatch</span> countDownLatch <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CountDownLatch</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 执行完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                countDownLatch<span class="token punctuation">.</span><span class="token function">countDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            countDownLatch<span class="token punctuation">.</span><span class="token function">await</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;所有线程执行完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="数据汇总"><a href="#数据汇总" class="header-anchor">#</a> 数据汇总</h3> <ul><li>在实际开发的过程中，难免需要调用多个接口，然后将多个接口的数据汇总到一起，可以使用线程池和Future来实现</li></ul> <h3 id="异步调用"><a href="#异步调用" class="header-anchor">#</a> 异步调用</h3> <p>@Async注解可以实现异步调用，可以加在方法上，也可以加在类上，里面指定线程池的名称，启动类上需要加@EnableAsync注解</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Async</span><span class="token punctuation">(</span><span class="token string">&quot;asyncServiceExecutor&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;异步调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="如何控制某个方法的并发数"><a href="#如何控制某个方法的并发数" class="header-anchor">#</a> 如何控制某个方法的并发数</h2> <ul><li>Semaphore 信号量，可以控制某个方法的并发数，常用于限流</li> <li>Semaphore的构造方法需要传入一个int类型的参数，表示许可的数量</li> <li>调用Semaphore的acquire方法时，会获取一个许可，如果没有许可，会阻塞当前线程</li> <li>调用Semaphore的release方法时，会释放一个许可</li></ul> <h3 id="代码实现-2"><a href="#代码实现-2" class="header-anchor">#</a> 代码实现</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SemaphoreDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Semaphore</span> semaphore <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Semaphore</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">acquire</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; 执行完毕&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    semaphore<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="threadlocal的理解"><a href="#threadlocal的理解" class="header-anchor">#</a> ThreadLocal的理解</h2> <ul><li>ThreadLocal是一个线程内部的数据存储类，可以在每个线程中存储数据，数据存储在ThreadLocalMap中
可以通过ThreadLocal的get方法获取数据，通过set方法设置数据，通过remove方法移除数据</li> <li>本质来说是一个线程内部存储类，可以让多个线程只操作自己内部的值，从而实现线程数据隔离</li> <li>ThreadLocal的使用场景：数据库连接、Session管理、事务管理、日志管理</li></ul> <h3 id="内存泄露问题"><a href="#内存泄露问题" class="header-anchor">#</a> 内存泄露问题</h3> <ol><li>强引用 new</li> <li>弱引用 WeakReference 发生垃圾回收</li> <li>软引用 SoftReference</li> <li>虚引用 PhantomReference</li></ol> <ul><li>key是弱引用，value是强引用  key被回收，value不会被回收</li> <li>务必使用remove方法，防止内存泄露</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c2492ba0.js" defer></script><script src="/assets/js/7.6855d7f5.js" defer></script><script src="/assets/js/1.3a8374e6.js" defer></script><script src="/assets/js/21.11541702.js" defer></script><script src="/assets/js/22.15b12c38.js" defer></script>
  </body>
</html>
