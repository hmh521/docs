<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>SpringCloud | 轻狂帅哥</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-Y62GB4CEGY" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];        function gtag(){dataLayer.push(arguments);}        gtag('js', new Date());        gtag('config', 'G-Y62GB4CEGY');</script>
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
    <meta name="description" content="轻狂帅哥的笔记">
    <meta names="author" content="轻狂帅哥">
    <meta names="keywords" content="学习，成长，轻狂帅哥的笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.25c602b9.css" as="style"><link rel="preload" href="/assets/js/app.c2492ba0.js" as="script"><link rel="preload" href="/assets/js/7.6855d7f5.js" as="script"><link rel="preload" href="/assets/js/1.3a8374e6.js" as="script"><link rel="preload" href="/assets/js/52.d2410e99.js" as="script"><link rel="preload" href="/assets/js/22.15b12c38.js" as="script"><link rel="prefetch" href="/assets/js/11.1265b5f0.js"><link rel="prefetch" href="/assets/js/12.54e0ed27.js"><link rel="prefetch" href="/assets/js/13.5d7b1694.js"><link rel="prefetch" href="/assets/js/14.0fe1e3ae.js"><link rel="prefetch" href="/assets/js/15.eba1568d.js"><link rel="prefetch" href="/assets/js/16.78b9404e.js"><link rel="prefetch" href="/assets/js/17.6ab60dbd.js"><link rel="prefetch" href="/assets/js/18.8a31c3b4.js"><link rel="prefetch" href="/assets/js/19.8952cbc3.js"><link rel="prefetch" href="/assets/js/2.2f2477cb.js"><link rel="prefetch" href="/assets/js/20.8bc8271e.js"><link rel="prefetch" href="/assets/js/21.11541702.js"><link rel="prefetch" href="/assets/js/23.152108a2.js"><link rel="prefetch" href="/assets/js/24.8d878e40.js"><link rel="prefetch" href="/assets/js/25.823137af.js"><link rel="prefetch" href="/assets/js/26.f23185c9.js"><link rel="prefetch" href="/assets/js/27.43be4522.js"><link rel="prefetch" href="/assets/js/28.74ed9ffb.js"><link rel="prefetch" href="/assets/js/29.375d247b.js"><link rel="prefetch" href="/assets/js/3.9e2336a3.js"><link rel="prefetch" href="/assets/js/30.f0afd84f.js"><link rel="prefetch" href="/assets/js/31.6ae0e49e.js"><link rel="prefetch" href="/assets/js/32.d4e12b03.js"><link rel="prefetch" href="/assets/js/33.75ea2804.js"><link rel="prefetch" href="/assets/js/34.5890d495.js"><link rel="prefetch" href="/assets/js/35.ca26b966.js"><link rel="prefetch" href="/assets/js/36.e127d760.js"><link rel="prefetch" href="/assets/js/37.97de2b13.js"><link rel="prefetch" href="/assets/js/38.5db24d98.js"><link rel="prefetch" href="/assets/js/39.d9d174e0.js"><link rel="prefetch" href="/assets/js/4.e7d0eacc.js"><link rel="prefetch" href="/assets/js/40.aba65f1e.js"><link rel="prefetch" href="/assets/js/41.efe6c0c2.js"><link rel="prefetch" href="/assets/js/42.7803e2c3.js"><link rel="prefetch" href="/assets/js/43.c81a9343.js"><link rel="prefetch" href="/assets/js/44.560a8b57.js"><link rel="prefetch" href="/assets/js/45.799166cd.js"><link rel="prefetch" href="/assets/js/46.61a082bf.js"><link rel="prefetch" href="/assets/js/47.8989967c.js"><link rel="prefetch" href="/assets/js/48.c4f46e16.js"><link rel="prefetch" href="/assets/js/49.3ebd371b.js"><link rel="prefetch" href="/assets/js/5.947449fc.js"><link rel="prefetch" href="/assets/js/50.0b88538c.js"><link rel="prefetch" href="/assets/js/51.c8efff9d.js"><link rel="prefetch" href="/assets/js/53.8168a589.js"><link rel="prefetch" href="/assets/js/54.9069084d.js"><link rel="prefetch" href="/assets/js/55.bfe16c8a.js"><link rel="prefetch" href="/assets/js/6.15ee44d5.js"><link rel="prefetch" href="/assets/js/8.c7e6bb89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.94c2c2a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25c602b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="轻狂帅哥" class="logo"> <span class="site-name can-hide">轻狂帅哥</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>springcloud</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/springcloud/" aria-current="page" class="active sidebar-link">SpringCloud</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/springcloud/#springcloud的五大常用组件" class="sidebar-link">SpringCloud的五大常用组件</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#服务注册与发现" class="sidebar-link">服务注册与发现</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#ribbon负载均衡策有哪些" class="sidebar-link">Ribbon负载均衡策有哪些</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#什么是服务雪崩" class="sidebar-link">什么是服务雪崩</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#微服务监控" class="sidebar-link">微服务监控</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#微服务限流" class="sidebar-link">微服务限流</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#实现方式" class="sidebar-link">实现方式</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#比较令牌桶和漏桶" class="sidebar-link">比较令牌桶和漏桶</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#cap定理" class="sidebar-link">CAP定理</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#分布式事务" class="sidebar-link">分布式事务</a></li><li class="sidebar-sub-header"><a href="/interview/springcloud/#分布式服务的接口幂等性" class="sidebar-link">分布式服务的接口幂等性</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="微服务"><a href="#微服务" class="header-anchor">#</a> 微服务</h1> <h2 id="springcloud的五大常用组件"><a href="#springcloud的五大常用组件" class="header-anchor">#</a> SpringCloud的五大常用组件</h2> <h3 id="通常情况下-springcloud的五大常用组件是指以下五个组件"><a href="#通常情况下-springcloud的五大常用组件是指以下五个组件" class="header-anchor">#</a> 通常情况下，SpringCloud的五大常用组件是指以下五个组件：</h3> <ol><li>Eureka：服务注册与发现</li> <li>Ribbon：负载均衡</li> <li>Feign：声明式服务调用</li> <li>Hystrix：服务熔断与降级</li> <li>Zuul：API网关</li></ol> <h3 id="随着springcloud的发展-我们项目中使用了一些阿里巴巴的组件-如"><a href="#随着springcloud的发展-我们项目中使用了一些阿里巴巴的组件-如" class="header-anchor">#</a> 随着SpringCloud的发展，我们项目中使用了一些阿里巴巴的组件，如：</h3> <ol><li>Nacos：服务注册与发现/配置中心</li> <li>Ribbon：负载均衡</li> <li>Feign：声明式服务调用</li> <li>sentinel：服务熔断与降级</li> <li>Gateway：API网关</li></ol> <h2 id="服务注册与发现"><a href="#服务注册与发现" class="header-anchor">#</a> 服务注册与发现</h2> <h3 id="服务注册与发现的核心组件是eureka和nacos"><a href="#服务注册与发现的核心组件是eureka和nacos" class="header-anchor">#</a> 服务注册与发现的核心组件是Eureka和Nacos</h3> <h4 id="eureka-服务注册与发现"><a href="#eureka-服务注册与发现" class="header-anchor">#</a> Eureka：服务注册与发现</h4> <ul><li>服务注册：服务提供者需要把自己的信息注册到Eureka Server上，以便服务消费者能够找到。</li> <li>服务发现：服务消费者从Eureka Server上获取服务提供者的信息，以便能够调用服务。</li> <li>服务监控：服务提供者会每隔30s定时向Eureka Server发送心跳，以保证服务的可用性。如果90s内没有收到心跳，则Eureka Server会将该服务实例从注册表中删除。</li></ul> <h4 id="nacos-服务注册与发现-配置中心"><a href="#nacos-服务注册与发现-配置中心" class="header-anchor">#</a> Nacos：服务注册与发现/配置中心</h4> <ul><li>服务注册：服务提供者需要把自己的信息注册到Nacos Server上，以便服务消费者能够找到。</li> <li>服务发现：服务消费者从Nacos Server上获取服务提供者的信息，以便能够调用服务。</li> <li>配置中心：Nacos Server还可以作为配置中心，用于统一管理配置文件。</li></ul> <h4 id="eureka和nacos的区别"><a href="#eureka和nacos的区别" class="header-anchor">#</a> Eureka和Nacos的区别</h4> <ul><li>Eureka是Netflix公司开源的组件，Nacos是阿里巴巴公司开源的组件。</li> <li>Eureka只能用于服务注册与发现，Nacos既可以用于服务注册与发现，也可以用于配置中心。</li> <li>Nacos提供服务端主动检测提供者状态；临时实例采用心跳检测，非临时实例采用主动检测模式。</li> <li>临时实例在心跳不正常时，会被删除；非临时实例不会被剔除。</li> <li>Nacos支持服务列表变更的消息推送模式，Eureka不支持。</li> <li>Nacos集群默认采用AP模式，当存在非临时实例，采用CP模式。Eureka集群默认采用AP模式。</li></ul> <h2 id="ribbon负载均衡策有哪些"><a href="#ribbon负载均衡策有哪些" class="header-anchor">#</a> Ribbon负载均衡策有哪些</h2> <h3 id="ribbon负载均衡策略有以下几种"><a href="#ribbon负载均衡策略有以下几种" class="header-anchor">#</a> Ribbon负载均衡策略有以下几种：</h3> <ol><li><strong>轮询策略：依次轮询选择服务实例。</strong></li> <li><strong>随机策略：随机选择服务实例。</strong></li> <li><strong>权重策略：根据服务实例的权重选择服务实例。</strong></li> <li>最小并发策略：选择并发量最小的服务实例。</li> <li>重试策略：在一定次数内重试选择服务实例。</li> <li>可用性敏感策略：先过滤非健康的服务实例，再选择连接数最少的服务实例。</li> <li>区域感知策略：根据区域选择服务实例。</li></ol> <h3 id="自定义负载均衡策略"><a href="#自定义负载均衡策略" class="header-anchor">#</a> 自定义负载均衡策略</h3> <ol><li>自定义负载均衡策略需要实现IRule接口。（全局）</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyRule</span> <span class="token keyword">implements</span> <span class="token class-name">IRule</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Server</span> <span class="token function">choose</span><span class="token punctuation">(</span><span class="token class-name">Object</span> key<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 自定义负载均衡策略</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li>自定义负载均衡策略 @Bean注入。（局部）</li></ol> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Bean</span>
<span class="token keyword">public</span> <span class="token class-name">IRule</span> <span class="token function">myRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyRule</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="什么是服务雪崩"><a href="#什么是服务雪崩" class="header-anchor">#</a> 什么是服务雪崩</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>服务雪崩是指当一个服务出现故障时，由于服务之间的调用关系，可能会导致多个服务出现故障，最终导致整个系统不可用。</p></div> <h3 id="如何解决服务雪崩"><a href="#如何解决服务雪崩" class="header-anchor">#</a> 如何解决服务雪崩</h3> <ol><li>熔断降级 （解决）</li> <li>限流 （预防）</li></ol> <h3 id="服务降级"><a href="#服务降级" class="header-anchor">#</a> 服务降级</h3> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>服务降级是服务自我保护的一种方式,或者保护下游服务的一种方式，用于确保服务不会收到请求突增影响变得不可用，确保服务不会崩溃。</p></div> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;service-provider&quot;</span><span class="token punctuation">,</span> fallback <span class="token operator">=</span> <span class="token class-name">MyFallback</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="服务熔断"><a href="#服务熔断" class="header-anchor">#</a> 服务熔断</h3> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>服务熔断用于监控某个服务的调用情况，当调用10s失败次数达到50%时，会触发熔断器，之后每隔五秒会尝试调用一次，如果调用成功，则关闭熔断器，否则继续等待。</p></div> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 开启服务熔断</span>
<span class="token annotation punctuation">@EnableCircuitBreaker</span>
<span class="token comment">// 服务熔断</span>
<span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;fallbackMethod&quot;</span><span class="token punctuation">)</span>
<span class="token comment">// 配置规则</span>
<span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;circuitBreaker.requestVolumeThreshold&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;10&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;circuitBreaker.sleepWindowInMilliseconds&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;10000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;circuitBreaker.errorThresholdPercentage&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;60&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 服务熔断</span>
<span class="token annotation punctuation">@HystrixCommand</span><span class="token punctuation">(</span>fallbackMethod <span class="token operator">=</span> <span class="token string">&quot;fallbackMethod&quot;</span><span class="token punctuation">,</span> commandProperties <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@HystrixProperty</span><span class="token punctuation">(</span>name <span class="token operator">=</span> <span class="token string">&quot;execution.isolation.thread.timeoutInMilliseconds&quot;</span><span class="token punctuation">,</span> value <span class="token operator">=</span> <span class="token string">&quot;3000&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="微服务监控"><a href="#微服务监控" class="header-anchor">#</a> 微服务监控</h2> <h3 id="skywalking"><a href="#skywalking" class="header-anchor">#</a> skywalking</h3> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>SkyWalking是一个开源的分布式APM系统，用于监控微服务架构中的应用性能。提供了完善的链路追踪功能。</p></div> <ol><li>skywalking主要可以监控接口、服务、物理实例的一些状态。特别是在压测的时候可以看到众多服务中哪些服务和接口比较慢，我们可以针对性的分析和优化。</li> <li>还可以设置告警规则，项目上线以后，如果报错，我们分别设置了可以给相关负责人发短信和发邮件，第一时间了解项目的bug情况。</li></ol> <h2 id="微服务限流"><a href="#微服务限流" class="header-anchor">#</a> 微服务限流</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>限流是指对系统的访问流量进行限制，防止系统被过多的请求拖垮，导致系统不可用。</p></div> <h3 id="为什么要限流"><a href="#为什么要限流" class="header-anchor">#</a> 为什么要限流</h3> <ol><li>并发的确大（突发流量）</li> <li>防止用户恶意刷接口</li></ol> <h2 id="实现方式"><a href="#实现方式" class="header-anchor">#</a> 实现方式</h2> <ol><li>Tomcat可以设置最大连接数</li> <li>Nginx 漏桶算法</li> <li>网关 令牌桶算法</li> <li>自定义拦截器</li></ol> <h3 id="nginx限流"><a href="#nginx限流" class="header-anchor">#</a> Nginx限流</h3> <div class="language-nginx extra-class"><pre class="language-nginx"><code>// 漏桶算法 限流 以固定速率处理请求
<span class="token directive"><span class="token keyword">limit_req_zone</span> <span class="token variable">$binary_remote_addr</span> zone=mylimit:10m rate=1r/s</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">limit_req_zone=mylimit</span> burst=5 nodelay</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>语法 limit_req_zone key zone rate;</li> <li>key：限流的key，可以是$binary_remote_addr、$server_name等。</li> <li>zone：定义共享内存区域，来存储访问信息，10m可以存储16w个ip的访问信息。</li> <li>rate：限流的速率，1r/s表示每秒1个请求。</li> <li>burst：桶的大小，5表示最大并发数为5。</li> <li>nodelay：快速处理请求，不会等待。</li></ul> <div class="language-nginx extra-class"><pre class="language-nginx"><code>// 控制并发连接数
<span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$binary_remote_addr</span> zone=mylimit:10m</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">limit_conn_zone</span> <span class="token variable">$server_name</span> zone=perserver:10m</span><span class="token punctuation">;</span>
<span class="token directive"><span class="token keyword">server</span></span> <span class="token punctuation">{</span>
    <span class="token directive"><span class="token keyword">location</span> /</span> <span class="token punctuation">{</span>
        <span class="token directive"><span class="token keyword">limit_conn</span> mylimit <span class="token number">5</span></span><span class="token punctuation">;</span> // 限制并发连接数为5
        <span class="token directive"><span class="token keyword">limit_conn</span> perserver <span class="token number">10</span></span><span class="token punctuation">;</span> // 限制每个server的并发连接数为10
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>limit_conn mylimit 5; 限制单个IP同时连接数为5</li> <li>limit_conn perserver 10; 限制每个虚拟主机的最大并发连接数为10</li></ul> <h3 id="网关限流"><a href="#网关限流" class="header-anchor">#</a> 网关限流</h3> <div class="language-yaml extra-class"><pre class="language-yaml"><code> // 令牌桶算法 限流 以固定速率处理请求
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> rate_limit_route
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span><span class="token number">8081</span>
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/rateLimit
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> RequestRateLimiter
              <span class="token key atrule">args</span><span class="token punctuation">:</span>
                <span class="token key atrule">key-resolver</span><span class="token punctuation">:</span> <span class="token string">&quot;#{@userKeyResolver}&quot;</span>
                <span class="token key atrule">redis-rate-limiter.replenishRate</span><span class="token punctuation">:</span> <span class="token number">1</span>
                <span class="token key atrule">redis-rate-limiter.burstCapacity</span><span class="token punctuation">:</span> <span class="token number">2</span>
</code></pre></div><ul><li>key-resolver 定义限流对象，使用SpEL表达式获取，需要代码实现</li> <li>redis-rate-limiter.replenishRate: 1 令牌桶每秒填充速率</li> <li>redis-rate-limiter.burstCapacity: 2 令牌桶最大容量</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserKeyResolver</span> <span class="token keyword">implements</span> <span class="token class-name">KeyResolver</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token class-name">ServerWebExchange</span> exchange<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>exchange<span class="token punctuation">.</span><span class="token function">getRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRemoteAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getHostAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>KeyResolver 限流对象接口</li> <li>resolve 限流对象的实现方法</li> <li>exchange.getRequest().getRemoteAddress().getAddress().getHostAddress() 获取请求的IP地址</li> <li>Mono.just() 将IP地址包装成Mono对象</li></ul> <h2 id="比较令牌桶和漏桶"><a href="#比较令牌桶和漏桶" class="header-anchor">#</a> 比较令牌桶和漏桶</h2> <ol><li>漏桶：如果一下子来了很多请求，但是请求会被放在池子里面，然后以固定的速率去处理请求。</li> <li>令牌桶：以固定的速率往桶内放入令牌，一下来很多请求，只要桶内的令牌足够多，请求就会立马被处理，这就是允许突发大量请求进来。</li></ol> <h2 id="cap定理"><a href="#cap定理" class="header-anchor">#</a> CAP定理</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>CAP定理是分布式系统中最基本的理论，指的是在一个分布式系统中，一致性（Consistency）、可用性（Availability）、分区容错性（Partition tolerance）三者不可兼得。</p></div> <ol><li>可用性：系统提供的服务必须一直处于可用的状态，对于用户的每一个操作请求都必须有响应。</li> <li>一致性：系统中的数据一旦发生变化，所有的用户都能够立即看到。</li> <li>分区容错性：系统在遇到网络分区故障时，仍然能够继续提供服务。</li></ol> <h3 id="base理论"><a href="#base理论" class="header-anchor">#</a> BASE理论</h3> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>BASE理论是对CAP理论的延伸，是对大规模分布式系统的实践总结，核心思想是即使无法做到强一致性，但可以做到最终一致性。</p></div> <ol><li>基本可用（Basically Available）：系统保证基本的可用性，允许损失部分可用性。</li> <li>软状态（Soft state）：允许系统中的数据存在中间状态，不同节点的数据副本可能不一致。</li> <li>最终一致性（Eventually Consistent）：系统保证在一段时间内，数据一致性最终能够达到。</li></ol> <h2 id="分布式事务"><a href="#分布式事务" class="header-anchor">#</a> 分布式事务</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>分布式事务是指事务的参与者、资源、执行者分布在不同的节点上，分布式事务需要满足ACID特性。</p></div> <h3 id="seata架构"><a href="#seata架构" class="header-anchor">#</a> Seata架构</h3> <ul><li>TC（Transaction Coordinator）：事务协调器，负责全局事务的协调。</li> <li>TM（Transaction Manager）：事务管理器，负责事务的开启、提交、回滚。</li> <li>RM（Resource Manager）：资源管理器，负责分支事务的注册、状态汇报、回滚。</li></ul> <h4 id="seata的xa模式"><a href="#seata的xa模式" class="header-anchor">#</a> Seata的XA模式</h4> <ol><li>CP，需要互相等待各个分支的事务提交，可以保证强一致性，但是性能较差。（银行业务）</li></ol> <h4 id="seata的at模式"><a href="#seata的at模式" class="header-anchor">#</a> Seata的AT模式</h4> <ol><li>AP，底层使用数据库的undo log，可以保证最终一致性，性能较好。（电商业务）</li></ol> <h4 id="seata的tcc模式"><a href="#seata的tcc模式" class="header-anchor">#</a> Seata的TCC模式</h4> <ol><li>AP，通过Try-Confirm-Cancel三个操作实现分布式事务，可以保证最终一致性，性能较好。（酒店预订）</li></ol> <h4 id="mq实现分布式事务"><a href="#mq实现分布式事务" class="header-anchor">#</a> MQ实现分布式事务</h4> <ol><li>在A服务写数据的时候，需要在同一事务中发送消息到另外一个事务，异步，性能最好</li></ol> <h2 id="分布式服务的接口幂等性"><a href="#分布式服务的接口幂等性" class="header-anchor">#</a> 分布式服务的接口幂等性</h2> <div class="custom-block tip"><p class="custom-block-title">定义</p> <p>接口幂等性是指对于同一个接口的多次调用，对于系统的状态和数据都是一致的，不会因为多次调用而产生副作用。</p></div> <ul><li>用户重复点击（网络波动）</li> <li>MQ消息重复</li> <li>应用使用失败或超时重复机制</li></ul> <h3 id="接口幂等"><a href="#接口幂等" class="header-anchor">#</a> 接口幂等</h3> <ol><li>GET请求：幂等性是指对于同一个请求的多次调用，返回的结果是一致的。</li> <li>POST请求：不是幂等的，因为POST请求每次请求都会创建一个新的资源。</li> <li>PUT请求：不是幂等的，因为PUT请求每次请求都会更新一个资源。</li> <li>DELETE请求：幂等性是指对于同一个请求的多次调用，返回的结果是一致的。</li></ol> <h3 id="实现幂等性"><a href="#实现幂等性" class="header-anchor">#</a> 实现幂等性</h3> <ol><li>如果是新增操作，可以使用唯一索引，保证幂等性。</li> <li>如果是新增或更改操作</li></ol> <ul><li>分布式锁：使用Redis分布式锁，保证幂等性。</li> <li>使用token+redis实现，性能比较好
<ul><li>第一次请求生成token，存入redis，返回给前端</li> <li>前端请求携带token，后端校验token，删除token</li></ul></li></ul> <h3 id="分布式任务调度-xxl-job"><a href="#分布式任务调度-xxl-job" class="header-anchor">#</a> 分布式任务调度 XXL-JOB</h3> <h3 id="xxl-job的路由策略"><a href="#xxl-job的路由策略" class="header-anchor">#</a> XXL-JOB的路由策略</h3> <ol><li>第一种策略：轮询策略，每次调度都是按照顺序轮询调度。</li> <li>第二种策略：故障转移策略，当某个执行器挂掉的时候，会自动切换到另外一个执行器。</li> <li>第三种策略：分片广播策略，每个执行器都会执行一次任务。</li></ol> <h3 id="xxl-job的任务执行失败怎么解决"><a href="#xxl-job的任务执行失败怎么解决" class="header-anchor">#</a> XXL-JOB的任务执行失败怎么解决</h3> <ul><li>路由策略如果是故障转移策略，使用健康的实例执行任务</li> <li>设置重试次数，如果任务执行失败，会自动重试</li> <li>查看日志+邮件告警来通知相关负责人</li></ul> <h3 id="如果有大数据量的任务同时都需要执行-怎么解决"><a href="#如果有大数据量的任务同时都需要执行-怎么解决" class="header-anchor">#</a> 如果有大数据量的任务同时都需要执行，怎么解决</h3> <ul><li>让多个实例一块去执行，路由策略使用分片广播策略</li> <li>在任务执行的代码中可以获取分片总数和当前分片，按照取模的方式分摊到各个实例去执行</li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024年11月13日星期三晚上11点53分</span></div></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c2492ba0.js" defer></script><script src="/assets/js/7.6855d7f5.js" defer></script><script src="/assets/js/1.3a8374e6.js" defer></script><script src="/assets/js/52.d2410e99.js" defer></script><script src="/assets/js/22.15b12c38.js" defer></script>
  </body>
</html>
