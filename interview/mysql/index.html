<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Mysql | 轻狂帅哥</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-Y62GB4CEGY" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];        function gtag(){dataLayer.push(arguments);}        gtag('js', new Date());        gtag('config', 'G-Y62GB4CEGY');</script>
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
    <meta name="description" content="轻狂帅哥的笔记">
    <meta names="author" content="轻狂帅哥">
    <meta names="keywords" content="学习，成长，轻狂帅哥的笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.25c602b9.css" as="style"><link rel="preload" href="/assets/js/app.c2492ba0.js" as="script"><link rel="preload" href="/assets/js/7.6855d7f5.js" as="script"><link rel="preload" href="/assets/js/1.3a8374e6.js" as="script"><link rel="preload" href="/assets/js/30.f0afd84f.js" as="script"><link rel="preload" href="/assets/js/22.15b12c38.js" as="script"><link rel="prefetch" href="/assets/js/11.1265b5f0.js"><link rel="prefetch" href="/assets/js/12.54e0ed27.js"><link rel="prefetch" href="/assets/js/13.5d7b1694.js"><link rel="prefetch" href="/assets/js/14.0fe1e3ae.js"><link rel="prefetch" href="/assets/js/15.eba1568d.js"><link rel="prefetch" href="/assets/js/16.78b9404e.js"><link rel="prefetch" href="/assets/js/17.6ab60dbd.js"><link rel="prefetch" href="/assets/js/18.8a31c3b4.js"><link rel="prefetch" href="/assets/js/19.8952cbc3.js"><link rel="prefetch" href="/assets/js/2.2f2477cb.js"><link rel="prefetch" href="/assets/js/20.8bc8271e.js"><link rel="prefetch" href="/assets/js/21.11541702.js"><link rel="prefetch" href="/assets/js/23.152108a2.js"><link rel="prefetch" href="/assets/js/24.8d878e40.js"><link rel="prefetch" href="/assets/js/25.823137af.js"><link rel="prefetch" href="/assets/js/26.f23185c9.js"><link rel="prefetch" href="/assets/js/27.43be4522.js"><link rel="prefetch" href="/assets/js/28.74ed9ffb.js"><link rel="prefetch" href="/assets/js/29.375d247b.js"><link rel="prefetch" href="/assets/js/3.9e2336a3.js"><link rel="prefetch" href="/assets/js/31.6ae0e49e.js"><link rel="prefetch" href="/assets/js/32.d4e12b03.js"><link rel="prefetch" href="/assets/js/33.75ea2804.js"><link rel="prefetch" href="/assets/js/34.5890d495.js"><link rel="prefetch" href="/assets/js/35.ca26b966.js"><link rel="prefetch" href="/assets/js/36.e127d760.js"><link rel="prefetch" href="/assets/js/37.97de2b13.js"><link rel="prefetch" href="/assets/js/38.5db24d98.js"><link rel="prefetch" href="/assets/js/39.d9d174e0.js"><link rel="prefetch" href="/assets/js/4.e7d0eacc.js"><link rel="prefetch" href="/assets/js/40.aba65f1e.js"><link rel="prefetch" href="/assets/js/41.efe6c0c2.js"><link rel="prefetch" href="/assets/js/42.7803e2c3.js"><link rel="prefetch" href="/assets/js/43.c81a9343.js"><link rel="prefetch" href="/assets/js/44.560a8b57.js"><link rel="prefetch" href="/assets/js/45.799166cd.js"><link rel="prefetch" href="/assets/js/46.61a082bf.js"><link rel="prefetch" href="/assets/js/47.8989967c.js"><link rel="prefetch" href="/assets/js/48.c4f46e16.js"><link rel="prefetch" href="/assets/js/49.3ebd371b.js"><link rel="prefetch" href="/assets/js/5.947449fc.js"><link rel="prefetch" href="/assets/js/50.0b88538c.js"><link rel="prefetch" href="/assets/js/51.c8efff9d.js"><link rel="prefetch" href="/assets/js/52.d2410e99.js"><link rel="prefetch" href="/assets/js/53.8168a589.js"><link rel="prefetch" href="/assets/js/54.9069084d.js"><link rel="prefetch" href="/assets/js/55.bfe16c8a.js"><link rel="prefetch" href="/assets/js/6.15ee44d5.js"><link rel="prefetch" href="/assets/js/8.c7e6bb89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.94c2c2a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25c602b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="轻狂帅哥" class="logo"> <span class="site-name can-hide">轻狂帅哥</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mysql</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/interview/mysql/" aria-current="page" class="active sidebar-link">Mysql</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/interview/mysql/#如何定位慢查询" class="sidebar-link">如何定位慢查询</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#如何分析执行速度很慢的sql语句" class="sidebar-link">如何分析执行速度很慢的SQL语句</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#什么是索引" class="sidebar-link">什么是索引</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#谈谈sql优化的经验" class="sidebar-link">谈谈Sql优化的经验</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#事务的四大特性" class="sidebar-link">事务的四大特性</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#undolog和redolog的区别" class="sidebar-link">undoLog和redoLog的区别</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#解释一下mvcc" class="sidebar-link">解释一下MVCC</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#mysql主从复制原理" class="sidebar-link">mysql主从复制原理</a></li><li class="sidebar-sub-header"><a href="/interview/mysql/#分库分表" class="sidebar-link">分库分表</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="mysql"><a href="#mysql" class="header-anchor">#</a> Mysql</h1> <h2 id="如何定位慢查询"><a href="#如何定位慢查询" class="header-anchor">#</a> 如何定位慢查询</h2> <div class="custom-block tip"><p class="custom-block-title">产生原因</p> <p>表象：页面加载过慢、接口响应时间过长（超过1s）</p> <ol><li>聚合查询 2. 多表查询 3.表数据量过大 4. 深度分页查询</li></ol></div> <h3 id="方案一-开源工具"><a href="#方案一-开源工具" class="header-anchor">#</a> 方案一：开源工具</h3> <ul><li>调试工具：Arthas（阿里）</li> <li>运维工具: Prometheus、Skywalking</li></ul> <h3 id="方案二-mysql自带慢查询日志"><a href="#方案二-mysql自带慢查询日志" class="header-anchor">#</a> 方案二：Mysql自带慢查询日志</h3> <ol><li>开启慢查询日志 <br>
慢查询日志 查询的是超过指定时间的数据（long_query_time） <br>
在 MySQL 的配置文件（通常是 my.cnf 或 my.ini）中，添加或修改以下配置项：</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
slow_query_log <span class="token operator">=</span> <span class="token number">1</span>              <span class="token comment"># 开启慢查询日志 1 表示开启慢查询日志，0 表示关闭。</span>
slow_query_log_file <span class="token operator">=</span> /path/to/slow_query.log  <span class="token comment"># 慢查询日志文件路径</span>
long_query_time <span class="token operator">=</span> <span class="token number">2</span>             <span class="token comment"># 设置慢查询的阈值（单位为秒，默认10秒）</span>
log_queries_not_using_indexes <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 记录未使用索引的查询，1 表示记录，0 表示不记录。</span>
</code></pre></div><h2 id="如何分析执行速度很慢的sql语句"><a href="#如何分析执行速度很慢的sql语句" class="header-anchor">#</a> 如何分析执行速度很慢的SQL语句</h2> <ol><li>使用<strong>explain</strong>分析SQL语句</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">explain</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> sys_user <span class="token keyword">where</span> id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="data:image/png;base64,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" alt="explain"></p> <ul><li>possible_keys: 可能使用的索引</li> <li>key: 实际使用的索引</li> <li>key_len: 索引占用的大小</li> <li>Extra: 额外信息</li></ul> <table><thead><tr><th>Extra</th> <th>含义</th></tr></thead> <tbody><tr><td>Using where;Using Index</td> <td>查找使用了索引，需要的数据都在索引列中能找到，不需要回表查询数据</td></tr> <tr><td>Using index condition</td> <td>查找使用了索引，但需要回表查询数据</td></tr></tbody></table> <ul><li>type: 查询类型  性能从好到差
<ul><li>system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; all</li> <li>system: 表只有一行记录（等于系统表）</li> <li>const: 根据主键查询</li> <li>eq_ref: 主键或唯一索引查询</li> <li>ref: 普通索引</li> <li>range: 索引范围扫描</li> <li>index: <strong>索引树扫描</strong></li> <li>all: <strong>全表扫描</strong></li></ul></li></ul> <h2 id="什么是索引"><a href="#什么是索引" class="header-anchor">#</a> 什么是索引</h2> <div class="custom-block tip"><p class="custom-block-title">索引</p> <p>索引是帮助MySQL高效获取数据的数据结构，Innodb特定查找算法B+树，以某种方式指向表中的数据。</p></div> <h3 id="简单说一下b树"><a href="#简单说一下b树" class="header-anchor">#</a> 简单说一下B树</h3> <ol><li>B树：多叉路平衡查找树，每一个节点有多个分支，5阶的B树，每个节点最多有4个子节点，最少有2个子节点。</li> <li>B+树：B树的变种，非叶子节点只存储索引，叶子节点存储索引和数据，叶子节点之间有指针相连，叶子节点形成一个链表。
B树和B+树的区别：</li></ol> <ul><li>磁盘读写代价B+树更低，因为非叶子节点不存储数据，数据都在叶子节点，叶子节点形成链表，可以顺序读取。</li> <li>查询效率：B+树查询效率更稳定，因为非叶子节点存储更多的索引，可以减少树的高度，减少磁盘IO次数。</li> <li>B+树适合范围查询，因为叶子节点之间有指针相连，可以快速找到范围内的数据。（双向链表）</li></ul> <h3 id="什么是聚簇索引-非聚簇索引"><a href="#什么是聚簇索引-非聚簇索引" class="header-anchor">#</a> 什么是聚簇索引/非聚簇索引</h3> <ol><li>聚簇索引：数据和索引存储在一起，Innodb的主键索引就是聚簇索引。 只能有一个聚簇索引。</li> <li>非聚簇索引：数据和索引分开存储，索引只存储索引列的值和指向数据的指针。 可以有多个非聚簇索引。</li></ol> <h4 id="选取规则"><a href="#选取规则" class="header-anchor">#</a> 选取规则</h4> <ul><li>如果表中有主键，Innodb会自动选择主键作为聚簇索引。</li> <li>如果表中没有主键，Innodb会选择第一个非空唯一索引作为聚簇索引。</li> <li>如果表中没有主键和唯一索引，Innodb会生成一个隐藏的6字节的rowid作为聚簇索引。</li></ul> <h3 id="什么是回表查询"><a href="#什么是回表查询" class="header-anchor">#</a> 什么是回表查询</h3> <div class="custom-block tip"><p class="custom-block-title">回表查询</p> <p>当通过非聚簇索引查询数据时，需要通过索引找到数据的主键，再通过主键找到数据，这个过程就是回表查询。</p></div> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> user_id <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> username <span class="token operator">=</span> <span class="token string">'exampleUser'</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> users <span class="token keyword">WHERE</span> user_id <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>使用索引：数据库首先会利用索引来快速找到匹配的记录。例如，在users表的username字段上创建了索引，数据库可以快速定位到对应的user_id。</li> <li>回表查询：数据库通过user_id找到对应的记录，然后返回给客户端。</li></ul> <h3 id="什么是覆盖索引"><a href="#什么是覆盖索引" class="header-anchor">#</a> 什么是覆盖索引</h3> <div class="custom-block tip"><p class="custom-block-title">覆盖索引</p> <p>当查询的列都在索引中时，不需要回表查询，直接从索引中获取数据，这个过程就是覆盖索引。</p></div> <ul><li>使用id查询数据，直接走聚集索引，不需要回表查询，直接查询到数据，性能最高。</li> <li>避免使用select *，会导致回表查询。聚集索引的叶子节点存储了所有的列，不需要回表查询。</li></ul> <h3 id="mysql超大分页问题"><a href="#mysql超大分页问题" class="header-anchor">#</a> MySQL超大分页问题</h3> <ol><li>MySQL的limit分页是先查询出所有的数据，再进行分页，如果数据量很大，会导致性能问题。</li></ol> <h4 id="优化思路"><a href="#优化思路" class="header-anchor">#</a> 优化思路</h4> <ol><li>使用覆盖索引查询，只查询需要的列。覆盖索引加子查询提升性能。</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> <span class="token operator">*</span> 
<span class="token keyword">from</span> tb_sku t
<span class="token keyword">left</span> <span class="token keyword">join</span> <span class="token punctuation">(</span>
    <span class="token keyword">select</span> id <span class="token keyword">from</span> tb_sku <span class="token keyword">limit</span> <span class="token number">1000000</span><span class="token punctuation">,</span> <span class="token number">10</span>
<span class="token punctuation">)</span> t1 <span class="token keyword">on</span> t<span class="token punctuation">.</span>id <span class="token operator">=</span> t1<span class="token punctuation">.</span>id<span class="token punctuation">;</span>
</code></pre></div><h3 id="索引的创建原则"><a href="#索引的创建原则" class="header-anchor">#</a> 索引的创建原则</h3> <ol><li><font style="color:#E8323C;">针对于数量大的表，查询比较频繁的表，单表超过10万行数据，可以考虑创建索引。</font></li> <li><font style="color:#E8323C;">针对于查询频繁的字段，需要创建索引。where条件中的字段，排序字段，分组字段。</font></li> <li>尽量选择区分度高的字段作为索引，尽量创建唯一索引。区分度越高，索引效果越好。</li> <li>如果字符串字段长度较大，可以使用前缀索引，减少索引占用空间。</li> <li><font style="color:#E8323C;">尽量使用联合索引，因为很多时候可以覆盖索引，减少索引数量，提升查询效率。</font></li> <li><font style="color:#E8323C;">控制索引的数量，索引越多，维护成本越高，建议不超过5个。</font></li> <li>索引不能存在空值，否则索引失效。</li></ol> <h3 id="什么情况下索引会失效"><a href="#什么情况下索引会失效" class="header-anchor">#</a> 什么情况下索引会失效</h3> <ol><li><font style="color:#E8323C;">违反索引最左前缀原则。</font></li> <li><font style="color:#E8323C;">范围查询右面的列，不能使用索引。</font></li> <li><font style="color:#E8323C;">不要在索引列上进行运算操作，会导致索引失效。</font></li> <li><font style="color:#E8323C;">字符串不加引号，会导致索引失效。</font></li> <li><font style="color:#E8323C;">以%开头的like查询，会导致索引失效。</font></li> <li>使用or连接条件，会导致索引失效。</li> <li>使用函数，会导致索引失效。</li> <li>使用is null，is not null，会导致索引失效。</li> <li>使用!=，&lt;&gt;，会导致索引失效。</li> <li>使用not in，not exists，会导致索引失效。</li></ol> <h2 id="谈谈sql优化的经验"><a href="#谈谈sql优化的经验" class="header-anchor">#</a> 谈谈Sql优化的经验</h2> <h3 id="表的设计优化"><a href="#表的设计优化" class="header-anchor">#</a> 表的设计优化</h3> <ol><li><font style="color:#E8323C;">设置合理的字段类型，尽量使用小的数据类型，减少存储空间。</font></li> <li><font style="color:#E8323C;">设置合适的字符串类型，char定长字符串效率比较高，varchar效率比较低。</font></li> <li><font style="color:#E8323C;">设置合理的字段长度，不要设置过长的字段，会浪费存储空间。</font></li> <li>设置合理的字段默认值，减少空值的存储。</li> <li>设置合理的字段注释，方便维护。</li> <li><font style="color:#E8323C;">设置合理的字段约束，减少错误数据的插入。</font></li> <li>设置合理的字段命名，方便维护。</li> <li>设置合理的表名，方便维护。</li> <li>设置合理的表注释，方便维护。</li> <li><font style="color:#E8323C;">设置合理的表引擎，Innodb支持事务，Myisam不支持事务。</font></li></ol> <h3 id="sql语句的优化"><a href="#sql语句的优化" class="header-anchor">#</a> SQL语句的优化</h3> <ol><li><font style="color:#E8323C;">尽量减少查询的字段，不要使用select *。</font></li> <li>SQL语句要避免索引失效的写法。</li> <li>尽量用union all代替union。因为union all不会去重，效率更高。</li> <li>避免在where子句中对字段进行表达式操作，会导致索引失效。</li> <li><span style="color:#E8323C;"> Join 优化，尽量使用inner join，避免使用外连接。如果一定要使用，一定要以小表驱动大表。</span></li></ol> <h2 id="事务的四大特性"><a href="#事务的四大特性" class="header-anchor">#</a> 事务的四大特性</h2> <ol><li>原子性：事务是一个不可分割的工作单位，要么都成功，要么都失败。</li> <li>一致性：事务执行前后，数据的完整性保持一致。</li> <li>隔离性：多个事务之间互不干扰，一个事务的执行不会影响其他事务。</li> <li>持久性：事务一旦提交，对数据的修改是永久性的。</li></ol> <h3 id="事务的并发问题"><a href="#事务的并发问题" class="header-anchor">#</a> 事务的并发问题</h3> <ol><li>脏读：一个事务读取到另一个事务未提交的数据。</li> <li>不可重复读：一个事务读取到另一个事务已提交的数据。</li> <li>幻读：一个事务读取到另一个事务插入的数据。</li></ol> <table><thead><tr><th>事务隔离级别</th> <th>脏读</th> <th>不可重复读</th> <th>幻读</th></tr></thead> <tbody><tr><td>读未提交</td> <td>是</td> <td>是</td> <td>是</td></tr> <tr><td>读已提交</td> <td>否</td> <td>是</td> <td>是</td></tr> <tr><td>可重复读</td> <td>否</td> <td>否</td> <td>是</td></tr> <tr><td>串行化</td> <td>否</td> <td>否</td> <td>否</td></tr></tbody></table> <p><span style="color:#E8323C;">Mysql默认的事务隔离级别是可重复读。</span></p> <h2 id="undolog和redolog的区别"><a href="#undolog和redolog的区别" class="header-anchor">#</a> undoLog和redoLog的区别</h2> <ol><li>undoLog是逻辑日志，记录的是数据修改前的内容，用于回滚操作。（一致性和原子性）</li> <li>redoLog是物理日志，记录的是数据修改后的内容，用于恢复操作。（持久性）</li></ol> <ul><li>缓冲池：缓冲池是内存中的一块区域，用于存放数据页，减少磁盘IO。</li> <li>数据页：数据页是磁盘上的一块区域，用于存放数据。 每个数据页默认大小为16KB。存储的数据是行记录。</li></ul> <blockquote><p>在执行更新操作时，会先将数据页中的数据拷贝到undoLog中，然后再将数据页中的数据修改，修改后的数据会记录到redoLog中。如果事务回滚，会先根据undoLog中的数据恢复数据页中的数据，然后再将redoLog中的数据恢复到数据页中。如果数据库宕机，会根据redoLog中的数据恢复数据页中的数据。</p></blockquote> <p><span style="color:#E8323C;">总之，undoLog是用于回滚操作，redoLog是用于恢复操作。</span></p> <p>undoLog还会用于MVCC多版本并发控制，用于读已提交和可重复读隔离级别。</p> <h3 id="隔离性是如何保证的"><a href="#隔离性是如何保证的" class="header-anchor">#</a> 隔离性是如何保证的</h3> <ol><li>锁机制：排他锁</li> <li>多版本并发控制：MVCC</li></ol> <h2 id="解释一下mvcc"><a href="#解释一下mvcc" class="header-anchor">#</a> 解释一下MVCC</h2> <blockquote><p><span style="color:#E8323C;">MVCC是多版本并发控制，用于解决事务并发问题。</span></p></blockquote> <ul><li>维护一个数据的多个版本，使得读写操作没有冲突。
主要实现方式：</li></ul> <ol><li>隐式字段</li></ol> <table><thead><tr><th>隐藏字段</th> <th>含义</th></tr></thead> <tbody><tr><td>DB_TRX_ID</td> <td>最近修改事务ID，记录插入这条数据的最后一次修改该记录的事务ID</td></tr> <tr><td>DB_ROLL_PTR</td> <td>回滚指针,指向这条记录的上一个版本，用于配合undoLog,指向上一个版本</td></tr> <tr><td>DB_ROW_ID</td> <td>隐藏主键，如果表结构没有指定主键，将会生成该隐藏字段</td></tr></tbody></table> <ol start="2"><li>undoLog</li></ol> <ul><li>当insert一条记录时，会生成一条undoLog，事务提交时，会立即删除undoLog。</li> <li>当update/delete一条记录时，会生成一条undoLog，事务提交时，不会立即删除undoLog，MVCC需要使用undoLog来获取数据的历史版本。</li> <li>undoLog 不同事务/相同事务对同一条记录的修改，会生成版本链。头部是最新版本，尾部是最旧版本。</li></ul> <ol start="3"><li>readview</li></ol> <blockquote><p>readview（读视图），是快照读SQL执行时的一个视图，用于读取数据，记录了事务开始时的活跃事务的事务（未提交）ID。</p></blockquote> <ul><li>当前读：读取数据时，数据不能被其他事务修改，会加锁，保证数据的一致性。</li> <li>快照读：读取数据时，不加锁，读取的是快照数据，保证数据的一致性。
<ul><li>读已提交：每次读取数据时，会生成一个readview，记录当前活跃事务的ID，只能读取已提交的数据。</li> <li>可重复读：开启事务时，第一次select会生成一个readview，记录当前活跃事务的ID，事务执行过程中，不会更新readview，只能读取事务开始时的数据。</li></ul></li></ul> <h3 id="包含4个核心字段"><a href="#包含4个核心字段" class="header-anchor">#</a> 包含4个核心字段：</h3> <h4 id="参数说明"><a href="#参数说明" class="header-anchor">#</a> 参数说明</h4> <ul><li><strong>trx_ids</strong>：当前活跃事务ID列表。</li> <li><strong>min_limit_id</strong>：最小事务ID（通常是一个提交过的事务ID）。这个值是所有事务的最小范围。</li> <li><strong>max_limit_id</strong>：预分配事务ID（当前最大的事务ID + 1）。表示下一个事务ID，它通常是尚未使用的事务ID。</li> <li><strong>creator_trx_id</strong>：创建当前readview的事务ID。</li></ul> <h4 id="事务id-读取数据权限规则"><a href="#事务id-读取数据权限规则" class="header-anchor">#</a> 事务ID 读取数据权限规则</h4> <ol><li><strong><code>trx_id == creator_trx_id</code></strong>：</li></ol> <ul><li>如果当前事务ID等于创建 <code>readview</code> 的事务ID，说明当前事务是自己创建了readview，<strong>可以读取自己的数据</strong>。</li> <li>该规则允许事务能够读取自己创建的事务内容。</li></ul> <ol start="2"><li><strong><code>trx_id &lt; min_limit_id</code></strong>：</li></ol> <ul><li>如果当前事务ID小于 <code>min_limit_id</code>，则说明该事务已被提交，并且其状态是已提交的，<strong>可以读取数据</strong>。</li> <li>因为已提交事务的数据是可见的，不会受到隔离。</li></ul> <ol start="3"><li><strong><code>trx_id &gt; max_limit_id</code></strong>：</li></ol> <ul><li>如果当前事务ID大于 <code>max_limit_id</code>，说明该事务尚未开始执行，事务ID是预分配的未来ID，<strong>不可以读取数据</strong>。</li> <li>因为这些事务还未开始，因此其数据不可见。</li></ul> <ol start="4"><li><strong><code>min_limit_id &lt;= trx_id &lt;= max_limit_id</code></strong>：</li></ol> <ul><li>如果当前事务ID在 <code>min_limit_id</code> 和 <code>max_limit_id</code> 之间，说明该事务尚未提交，且仍在执行中，<strong>不可以读取数据</strong>。</li> <li>因为该事务处于执行过程中，数据状态尚未确定，读取它的数据可能会导致不一致。</li></ul> <h4 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h4> <ul><li><p><strong>可以读取数据</strong>：</p> <ul><li>如果事务ID小于 <code>min_limit_id</code>（已提交）。</li> <li>如果事务ID等于 <code>creator_trx_id</code>（自己创建的readview）。</li></ul></li> <li><p><strong>不可以读取数据</strong>：</p> <ul><li>如果事务ID大于 <code>max_limit_id</code>（尚未开始）。</li> <li>如果事务ID在 <code>min_limit_id</code> 和 <code>max_limit_id</code> 之间（未提交或正在执行）。</li></ul></li></ul> <div class="custom-block tip"><p class="custom-block-title">MVVC的总结</p> <ol><li>MVCC是通过隐藏字段、undoLog、readview实现的。 维护一个数据的多个版本，使得读写操作没有冲突。</li> <li>隐藏字段 事务id和回滚指针，用于配合undoLog，指向上一个版本。</li> <li>undoLog 用于回滚操作，不同事务/相同事务对同一条记录的修改，会生成版本链。</li> <li>readview 读取数据时，不加锁，读取的是快照数据，保证数据的一致性。 RR/RC RR只会生成一次readview，RC每次select都会生成readview。</li> <li>事务ID读取数据权限规则：creator_trx_id、min_limit_id、max_limit_id。</li></ol></div> <h2 id="mysql主从复制原理"><a href="#mysql主从复制原理" class="header-anchor">#</a> mysql主从复制原理</h2> <p>核心原理：<strong>binlog日志</strong> ，记录了所有的DDL和DML操作，通过binlog日志实现主从复制。</p> <p>步骤：</p> <ol><li>主库执行操作后记录到binlog；</li> <li>从库通过 IO 线程 拉取 binlog，写入中继日志；</li> <li>从库通过 SQL 线程 执行中继日志中的 SQL，保持数据同步。</li></ol> <h2 id="分库分表"><a href="#分库分表" class="header-anchor">#</a> 分库分表</h2> <blockquote><p>什么情况下需要分库分表？</p></blockquote> <ol><li>数据量大，单表数据量超过1000W或者20G;</li> <li>优化解决不了性能问题；(主从读写分离，索引)</li> <li>IO瓶颈（磁盘IO，网络IO），CPU瓶颈（聚合查询，连接数太多）</li></ol> <h3 id="垂直拆分"><a href="#垂直拆分" class="header-anchor">#</a> 垂直拆分</h3> <blockquote><p>垂直拆分是指按照业务模块将表拆分到不同的数据库中，每个数据库中的表都是不同的业务模块。</p></blockquote> <h4 id="垂直分库"><a href="#垂直分库" class="header-anchor">#</a> 垂直分库</h4> <ol><li>按照业务模块将表拆分到不同的数据库中；</li></ol> <ul><li>特点：实现业务的分级管理，高并发场景下，提高磁盘IO和数据库连接数；</li></ul> <h4 id="垂直分表"><a href="#垂直分表" class="header-anchor">#</a> 垂直分表</h4> <ol><li>以字段为依据，将表中的字段拆分到不同的表中；</li></ol> <p>拆分规则：冷热数据分离</p> <ul><li>不常用的字段单独放到一个表中；</li> <li>把text，blob字段放到附表中；</li></ul> <h3 id="水平拆分"><a href="#水平拆分" class="header-anchor">#</a> 水平拆分</h3> <blockquote><p>水平拆分是指按照表的行进行拆分，将表中的数据按照某种规则拆分到不同的数据库中。</p></blockquote> <h4 id="水平分库"><a href="#水平分库" class="header-anchor">#</a> 水平分库</h4> <ol><li>按照某种规则将表中的数据拆分到不同的数据库中；</li> <li>水平分库的规则：hash取模、范围分片、一致性hash；</li></ol> <ul><li>特点：单库性能瓶颈，提高系统的稳定性和可用性；</li></ul> <h4 id="水平分表"><a href="#水平分表" class="header-anchor">#</a> 水平分表</h4> <ol><li>将一个表的数据按照某种规则拆分到不同的表中；</li></ol> <ul><li>特点：单表性能瓶颈，减少锁表的概率，提高系统的稳定性和可用性；</li></ul> <h3 id="分库问题"><a href="#分库问题" class="header-anchor">#</a> 分库问题</h3> <ol><li>分布式事务的一致性问题；</li> <li>跨节点关联查询问题；</li> <li>跨节点分页/排序问题；</li> <li>主键避重问题；</li></ol> <div class="custom-block tip"><p class="custom-block-title">分库分表总结</p> <ol><li>水平分库：将一个库的数据拆分到多个库中，解决海量数据存储和高并发问题；</li> <li>水平分表：将一个表的数据拆分到多个表中，解决单表存储和性能的问题；</li> <li>垂直分库：按照业务进行拆分，提高磁盘IO和数据库连接数；</li> <li>垂直分表：冷热数据分离，多表互不影响，提高查询性能；</li></ol></div></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024年11月13日星期三晚上11点53分</span></div></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c2492ba0.js" defer></script><script src="/assets/js/7.6855d7f5.js" defer></script><script src="/assets/js/1.3a8374e6.js" defer></script><script src="/assets/js/30.f0afd84f.js" defer></script><script src="/assets/js/22.15b12c38.js" defer></script>
  </body>
</html>
