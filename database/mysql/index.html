<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>MySQL数据库 | 轻狂帅哥</title>
    <meta name="generator" content="VuePress 1.9.10">
    <script src="https://www.googletagmanager.com/gtag/js?id=G-Y62GB4CEGY" async="true"></script>
    <script> window.dataLayer = window.dataLayer || [];        function gtag(){dataLayer.push(arguments);}        gtag('js', new Date());        gtag('config', 'G-Y62GB4CEGY');</script>
    <link rel="icon" href="/assets/img/favicon.ico">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
    <link href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
    <meta name="description" content="轻狂帅哥的笔记">
    <meta names="author" content="轻狂帅哥">
    <meta names="keywords" content="学习，成长，轻狂帅哥的笔记">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <link rel="preload" href="/assets/css/0.styles.25c602b9.css" as="style"><link rel="preload" href="/assets/js/app.c2492ba0.js" as="script"><link rel="preload" href="/assets/js/7.6855d7f5.js" as="script"><link rel="preload" href="/assets/js/1.3a8374e6.js" as="script"><link rel="preload" href="/assets/js/38.5db24d98.js" as="script"><link rel="preload" href="/assets/js/22.15b12c38.js" as="script"><link rel="prefetch" href="/assets/js/11.1265b5f0.js"><link rel="prefetch" href="/assets/js/12.54e0ed27.js"><link rel="prefetch" href="/assets/js/13.5d7b1694.js"><link rel="prefetch" href="/assets/js/14.0fe1e3ae.js"><link rel="prefetch" href="/assets/js/15.eba1568d.js"><link rel="prefetch" href="/assets/js/16.78b9404e.js"><link rel="prefetch" href="/assets/js/17.6ab60dbd.js"><link rel="prefetch" href="/assets/js/18.8a31c3b4.js"><link rel="prefetch" href="/assets/js/19.8952cbc3.js"><link rel="prefetch" href="/assets/js/2.2f2477cb.js"><link rel="prefetch" href="/assets/js/20.8bc8271e.js"><link rel="prefetch" href="/assets/js/21.11541702.js"><link rel="prefetch" href="/assets/js/23.152108a2.js"><link rel="prefetch" href="/assets/js/24.8d878e40.js"><link rel="prefetch" href="/assets/js/25.823137af.js"><link rel="prefetch" href="/assets/js/26.f23185c9.js"><link rel="prefetch" href="/assets/js/27.43be4522.js"><link rel="prefetch" href="/assets/js/28.74ed9ffb.js"><link rel="prefetch" href="/assets/js/29.375d247b.js"><link rel="prefetch" href="/assets/js/3.9e2336a3.js"><link rel="prefetch" href="/assets/js/30.f0afd84f.js"><link rel="prefetch" href="/assets/js/31.6ae0e49e.js"><link rel="prefetch" href="/assets/js/32.d4e12b03.js"><link rel="prefetch" href="/assets/js/33.75ea2804.js"><link rel="prefetch" href="/assets/js/34.5890d495.js"><link rel="prefetch" href="/assets/js/35.ca26b966.js"><link rel="prefetch" href="/assets/js/36.e127d760.js"><link rel="prefetch" href="/assets/js/37.97de2b13.js"><link rel="prefetch" href="/assets/js/39.d9d174e0.js"><link rel="prefetch" href="/assets/js/4.e7d0eacc.js"><link rel="prefetch" href="/assets/js/40.aba65f1e.js"><link rel="prefetch" href="/assets/js/41.efe6c0c2.js"><link rel="prefetch" href="/assets/js/42.7803e2c3.js"><link rel="prefetch" href="/assets/js/43.c81a9343.js"><link rel="prefetch" href="/assets/js/44.560a8b57.js"><link rel="prefetch" href="/assets/js/45.799166cd.js"><link rel="prefetch" href="/assets/js/46.61a082bf.js"><link rel="prefetch" href="/assets/js/47.8989967c.js"><link rel="prefetch" href="/assets/js/48.c4f46e16.js"><link rel="prefetch" href="/assets/js/49.3ebd371b.js"><link rel="prefetch" href="/assets/js/5.947449fc.js"><link rel="prefetch" href="/assets/js/50.0b88538c.js"><link rel="prefetch" href="/assets/js/51.c8efff9d.js"><link rel="prefetch" href="/assets/js/52.d2410e99.js"><link rel="prefetch" href="/assets/js/53.8168a589.js"><link rel="prefetch" href="/assets/js/54.9069084d.js"><link rel="prefetch" href="/assets/js/55.bfe16c8a.js"><link rel="prefetch" href="/assets/js/6.15ee44d5.js"><link rel="prefetch" href="/assets/js/8.c7e6bb89.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.94c2c2a5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25c602b9.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="轻狂帅哥" class="logo"> <span class="site-name can-hide">轻狂帅哥</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术笔记" class="dropdown-title"><span class="title">技术笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="技术笔记" class="mobile-dropdown-title"><span class="title">技术笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>
          前端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/frontend/html/" class="nav-link">
  HTML &amp; CSS
</a></li><li class="dropdown-subitem"><a href="/frontend/js/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-subitem"><a href="/frontend/vue/" class="nav-link">
  Vue
</a></li></ul></li><li class="dropdown-item"><h4>
          后端
        </h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/backend/javase/" class="nav-link">
  JavaSE
</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Spring框架" class="dropdown-title"><span class="title">Spring框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="Spring框架" class="mobile-dropdown-title"><span class="title">Spring框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frame/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/frame/springmvc/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/frame/springboot/" class="nav-link">
  SpringBoot
</a></li><li class="dropdown-item"><!----> <a href="/frame/springsecurity/" class="nav-link">
  SpringSecurity
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/database/mysql/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/database/oracle/" class="nav-link">
  Oracle
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="虚拟机" class="dropdown-title"><span class="title">虚拟机</span> <span class="arrow down"></span></button> <button type="button" aria-label="虚拟机" class="mobile-dropdown-title"><span class="title">虚拟机</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/virtualMachine/jvm/" class="nav-link">
  JVM
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="运维" class="dropdown-title"><span class="title">运维</span> <span class="arrow down"></span></button> <button type="button" aria-label="运维" class="mobile-dropdown-title"><span class="title">运维</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/linux/" class="nav-link">
  Linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/docker/" class="nav-link">
  Docker
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常见问题" class="dropdown-title"><span class="title">常见问题</span> <span class="arrow down"></span></button> <button type="button" aria-label="常见问题" class="mobile-dropdown-title"><span class="title">常见问题</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/commonproblem/git/" class="nav-link">
  git常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/java/" class="nav-link">
  java常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/mysql/" class="nav-link">
  mysql常见问题
</a></li><li class="dropdown-item"><!----> <a href="/commonproblem/vue/" class="nav-link">
  vue常见问题
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="面试常问" class="dropdown-title"><span class="title">面试常问</span> <span class="arrow down"></span></button> <button type="button" aria-label="面试常问" class="mobile-dropdown-title"><span class="title">面试常问</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/interview/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/interview/mysql/" class="nav-link">
  MySQL
</a></li><li class="dropdown-item"><!----> <a href="/interview/spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/interview/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/interview/springcloud/" class="nav-link">
  Springcloud
</a></li></ul></div></div><div class="nav-item"><a href="/about/about.html" class="nav-link">
  关于我
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>mysql</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/database/mysql/" aria-current="page" class="active sidebar-link">MySQL数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/database/mysql/#为什么要使用数据库" class="sidebar-link">为什么要使用数据库？</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#rdbms和非rdbms" class="sidebar-link">RDBMS和非RDBMS</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#er与表记录" class="sidebar-link">ER与表记录</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#mysql卸载" class="sidebar-link">Mysql卸载</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#sql分类" class="sidebar-link">SQL分类</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#函数" class="sidebar-link">函数</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#加密和解密的操作" class="sidebar-link">加密和解密的操作</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#sql执行原理" class="sidebar-link">SQL执行原理</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#子查询" class="sidebar-link">子查询</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#标识符命名规则" class="sidebar-link">标识符命名规则</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#commit和rollback" class="sidebar-link">COMMIT和ROLLBACK</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#dml-添加数据" class="sidebar-link">DML 添加数据</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#数据类型" class="sidebar-link">数据类型</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#为什么需要约束" class="sidebar-link">为什么需要约束</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#约束" class="sidebar-link">约束</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#面试题" class="sidebar-link">面试题</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#数据库对象" class="sidebar-link">数据库对象</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#视图-虚拟表" class="sidebar-link">视图（虚拟表）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#触发器" class="sidebar-link">触发器</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#存储过程" class="sidebar-link">存储过程</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#创建存储过程" class="sidebar-link">创建存储过程</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#存储函数的使用" class="sidebar-link">存储函数的使用</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#存储过程和函数的查看、修改、删除" class="sidebar-link">存储过程和函数的查看、修改、删除</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#变量" class="sidebar-link">变量</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#程序出错的处理机制" class="sidebar-link">程序出错的处理机制</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#条件判断语句" class="sidebar-link">条件判断语句</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#游标" class="sidebar-link">游标</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#mysql8-0-全局变量的持久化" class="sidebar-link">MySQL8.0 全局变量的持久化</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#窗口函数" class="sidebar-link">窗口函数</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#窗口函数-将结果置于每一条数据记录中" class="sidebar-link">窗口函数（将结果置于每一条数据记录中）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#公用表表达式" class="sidebar-link">公用表表达式</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#mysql优化" class="sidebar-link">mysql优化</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#suo-yisuoyi克隆虚拟机" class="sidebar-link">suo'yisuoyi克隆虚拟机</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#centos6-和-centos7-的区别" class="sidebar-link">centos6 和 centos7 的区别</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#mysql卸载的一些命令" class="sidebar-link">mysql卸载的一些命令</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#字符集-charset" class="sidebar-link">字符集（CHARSET）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#比较规则-collate" class="sidebar-link">比较规则（COLLATE）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#sql大小写规范" class="sidebar-link">SQL大小写规范</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#sql-mode-合理设置" class="sidebar-link">sql_mode 合理设置</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#mysql数据目录" class="sidebar-link">MYSQL数据目录</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#用户与权限关联" class="sidebar-link">用户与权限关联</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#密码" class="sidebar-link">密码</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#权限管理" class="sidebar-link">权限管理</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#角色管理-mysql8-0" class="sidebar-link">角色管理（mysql8.0）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#配置文件" class="sidebar-link">配置文件</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#逻辑架构" class="sidebar-link">逻辑架构</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#sql执行流程" class="sidebar-link">SQL执行流程</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#执行原理-区别就是有没有查询缓存" class="sidebar-link">执行原理（区别就是有没有查询缓存）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#oracle-sql执行流程" class="sidebar-link">oracle SQL执行流程</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#存储引擎" class="sidebar-link">存储引擎</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#索引" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#聚簇索引" class="sidebar-link">聚簇索引</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#非聚簇索引-二级索引-辅助索引" class="sidebar-link">非聚簇索引（二级索引/辅助索引）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#数据结构的合理性" class="sidebar-link">数据结构的合理性</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#innodb数据存储结构" class="sidebar-link">InnoDB数据存储结构</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#区-段-碎片区" class="sidebar-link">区,段,碎片区</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#索引-2" class="sidebar-link">索引</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#索引的设计原则" class="sidebar-link">索引的设计原则</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#性能分析工具" class="sidebar-link">性能分析工具</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#索引优化与查询优化" class="sidebar-link">索引优化与查询优化</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#索引下推" class="sidebar-link">索引下推</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#补充优化" class="sidebar-link">补充优化</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#数据库设计" class="sidebar-link">数据库设计</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#主键设计" class="sidebar-link">主键设计</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#数据库设计-2" class="sidebar-link">数据库设计</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#范式" class="sidebar-link">范式</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#结构设计" class="sidebar-link">结构设计</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#事务" class="sidebar-link">事务</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#状态" class="sidebar-link">状态</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#事务基础知识" class="sidebar-link">事务基础知识</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#事务分类" class="sidebar-link">事务分类</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#事务的隔离性" class="sidebar-link">事务的隔离性</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#事务日志" class="sidebar-link">事务日志</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#undo日志" class="sidebar-link">Undo日志</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#锁" class="sidebar-link">锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#记录锁-行锁" class="sidebar-link">记录锁（行锁）</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#间隙锁-gap锁" class="sidebar-link">间隙锁  gap锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#页锁" class="sidebar-link">页锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#悲观锁" class="sidebar-link">悲观锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#乐观锁" class="sidebar-link">乐观锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#显式锁-隐式锁" class="sidebar-link">显式锁/隐式锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#全局锁" class="sidebar-link">全局锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#死锁" class="sidebar-link">死锁</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#锁的内存结构" class="sidebar-link">锁的内存结构</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#mvcc" class="sidebar-link">MVCC</a></li><li class="sidebar-sub-header"><a href="/database/mysql/#日志" class="sidebar-link">日志</a></li></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p><a href="https://dev.mysql.com/doc/refman/8.0/en/" target="_blank" rel="noopener noreferrer">mysql8 交流网站<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.cs.usfca.edu/~galles/visualization/about.html" target="_blank" rel="noopener noreferrer">数据结构演示图<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://db-engines.com/en/ranking" target="_blank" rel="noopener noreferrer">数据库最新排名<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="为什么要使用数据库"><a href="#为什么要使用数据库" class="header-anchor">#</a> 为什么要使用数据库？</h2> <p><font style="color:#DF2A3F;">持久化 </font><font style="color:#000000;">将内存中的数据存储到关系型数据库中</font></p> <p><font style="color:#000000;">一张表可以存储，几千万，上亿条数据。</font></p> <p><font style="color:#000000;">类型多种多样，图片，大文本</font></p> <p><font style="color:#000000;">使用成本低，性能卓越，服务稳定，软件体积小，社区活跃</font></p> <p><font style="color:#000000;">概念：</font></p> <ol><li><font style="color:#000000;">DB 数据库   实际文件</font></li> <li><font style="color:#000000;">DBMS 数据库管理系统</font></li> <li><font style="color:#000000;">SQL 结构化查询语言</font></li></ol> <p>Mysql <font style="color:#DF2A3F;">开放源代码的关系型数据库管理系统</font></p> <ul><li>2008 sun 收购，2009 oracle 收购sun   mariadb  是mysql的分支项目</li> <li>6.x 后分社区版和商业版</li> <li>GPL 协议，修改源码来开发自己的mysql系统</li> <li>mysql 支持上千万条大型数据库</li> <li>mysql 在32系统下支持表文件4GB的存储，64位系统下支持表文件8TB的存储</li> <li>标准的SQL 标记语言</li> <li>mysql5.5 innodb 引擎作为默认存储引擎</li> <li>mysql5.7 比较多 2015年</li> <li>2016年 8.0</li></ul> <p>oracle 适用于大型跨国企业，性能和安全性要求高，收费</p> <p>mysql 中小型网站，互联网公司首选</p> <h2 id="rdbms和非rdbms"><a href="#rdbms和非rdbms" class="header-anchor">#</a> RDBMS和非RDBMS</h2> <ol><li>RDBMS 二维关系 行和列 构成表</li> <li>非RDBMS 阉割版  性能非常高</li></ol> <ul><li>redis 键值型  内存缓存</li> <li>mongodb 文档型  xml json</li> <li>搜索引擎数据库  ES  solr 数据量大</li> <li>列式数据库 HBase 降低IO   分布式文件系统</li> <li>图形数据库 存储实体对象之间的关系</li></ul> <h2 id="er与表记录"><a href="#er与表记录" class="header-anchor">#</a> ER与表记录</h2> <p>实体集，属性，联系集</p> <h3 id="一对一关联"><a href="#一对一关联" class="header-anchor">#</a> 一对一关联</h3> <ol><li>一对一可以创建成一张表</li></ol> <ul><li>外键唯一，外键是主键</li></ul> <ol start="2"><li>一对多</li></ol> <ul><li>主表的主键是从表的非主键字段</li></ul> <ol start="3"><li>多对多</li></ol> <ul><li>需要关联关系表</li></ul> <ol start="4"><li>自我引用</li></ol> <ul><li>自己对应自己，自我引用</li></ul> <h2 id="mysql卸载"><a href="#mysql卸载" class="header-anchor">#</a> Mysql卸载</h2> <div class="language-xml extra-class"><pre class="language-xml"><code>mysql --version  // 数据库版本
mysql -uroot -p   // 后面接上密码
show databases;  // 数据库
use atguigudbl // 使用数据库
show tables;   // 展示表
select version();// 查询版本
mysql -uroot -pabc123 -hlocalhost -P3307  // 主机端口号
net start 服务名 // 启动服务
net stop 服务名 // 停止服务
</code></pre></div><ul><li>控制面板卸载</li> <li>msi 卸载</li> <li>电脑管家或者360卸载</li> <li><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1700581511083-e88cd0a7-5a46-4f19-9676-f0e44e82674a.png" alt=""></li> <li>清除注册表  regedit</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>
information_schema<span class="token punctuation">;</span> <span class="token comment">-- 系统信息，数据库名称，表名称，存储权限</span>
mysql   <span class="token comment">-- 运行时系统信息。文件夹，字符集</span>
performance_schema<span class="token punctuation">;</span> <span class="token comment">-- 性能指标</span>
sys <span class="token comment">-- 性能指标，开发人员监控性能</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> bdtest1<span class="token punctuation">;</span> <span class="token comment">// 创建数据库</span>
<span class="token keyword">use</span> bdtest1<span class="token punctuation">;</span> <span class="token comment">// 使用数据库</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> employees<span class="token punctuation">(</span>id <span class="token keyword">int</span><span class="token punctuation">,</span>name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 创建表</span>
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span><span class="token comment">// 展示表</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> employees<span class="token punctuation">;</span><span class="token comment">// 查看数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> employees <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1002</span><span class="token punctuation">,</span><span class="token string">'Tom'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 插入数据</span>

<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> employees<span class="token punctuation">;</span> <span class="token comment">// 查看表信息</span>

<span class="token number">5.7</span> 不能插入中文  数据库默认字符集 latin1 不包含汉字

<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'character_%'</span><span class="token punctuation">;</span> <span class="token comment">// 显示字符集</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'collation_%'</span><span class="token punctuation">;</span> <span class="token comment">// 比较规则</span>

<span class="token keyword">drop</span> <span class="token keyword">database</span> dbtest1<span class="token punctuation">;</span><span class="token comment">// 删除数据库</span>


<span class="token number">5.7</span> my<span class="token punctuation">.</span>ini
<span class="token punctuation">[</span>mysql<span class="token punctuation">]</span>
<span class="token keyword">default</span><span class="token operator">-</span><span class="token keyword">character</span><span class="token operator">-</span><span class="token keyword">set</span><span class="token operator">=</span>utf8 <span class="token comment">#默认字符集</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token keyword">character</span><span class="token operator">-</span><span class="token keyword">set</span><span class="token operator">-</span>server<span class="token operator">=</span>utf8
collation<span class="token operator">-</span>server<span class="token operator">=</span>utf8_general_ci

<span class="token number">8.0</span> 默认 utf8mb4 <span class="token number">4</span>个字节表示一个字符


<span class="token number">5.7</span>默认是mysql_native_password
<span class="token number">8.0</span>默认是caching_sha2_password加密方式，需要更改加密规则

<span class="token keyword">use</span> mysql；

<span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> IDENTIFIED <span class="token keyword">with</span> mysql_native_password <span class="token keyword">by</span> <span class="token string">'123456'</span>

flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>


skip<span class="token operator">-</span><span class="token keyword">grant</span><span class="token operator">-</span><span class="token keyword">tables</span> 忽略密码金融

</code></pre></div><h2 id="sql分类"><a href="#sql分类" class="header-anchor">#</a> SQL分类</h2> <div class="language-sql extra-class"><pre class="language-sql"><code>DDL: 数据定义语言  <span class="token keyword">create</span>  <span class="token keyword">alter</span> <span class="token keyword">drop</span>  <span class="token keyword">rename</span>  <span class="token keyword">truncate</span> 

DML: 数据操纵语言  <span class="token keyword">insert</span>  <span class="token keyword">delete</span>  <span class="token keyword">update</span>  <span class="token keyword">select</span> 

DCL: 数据控制语言  <span class="token keyword">commit</span>  <span class="token keyword">rollback</span> <span class="token keyword">savepoint</span> <span class="token keyword">grant</span> <span class="token keyword">revoke</span> 

windows 不区分大小写
linux 区分大小写
数据库名，表名，表的别名，变量名 区分大小写
关键字，函数名，列名，列的字段名忽略大小写

规范
数据库名，表名，表别名，字段名，字段别名都小写
<span class="token keyword">sql</span>关键字，函数名，绑定变量都大写

<span class="token comment"># 单行注释</span>
<span class="token comment">/*
 多行注释
*/</span>
<span class="token comment">-- 必需有空格</span>
导入数据
source 文件的全路径名  cmd导入
基于图形化工具导入

别名 可以用双引号括起来 解决空格问题

去除重复行
<span class="token keyword">distinct</span> 关键字 只能整体不重复

空值参与运算
<span class="token boolean">null</span> 和 <span class="token number">0</span> <span class="token string">''</span> 是不一样的
<span class="token boolean">null</span> 参与运算的结果都是<span class="token boolean">null</span>
IFNULL<span class="token punctuation">(</span>commission_pct<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>

着重号 <span class="token identifier"><span class="token punctuation">`</span><span class="token punctuation">`</span></span> 
解决<span class="token keyword">order</span> 是关键字

常数
每一行都会匹配

显示表结构
<span class="token keyword">DESCRIBE</span> 表名<span class="token punctuation">;</span>
<span class="token keyword">DESC</span> 表名<span class="token punctuation">;</span>

<span class="token keyword">sql</span> 在windows下是不区分大小写  字符串也不区分 ANSI 标准 是mysql放水了
oracle 字符串区分大小写  
过滤数据
<span class="token keyword">where</span> 

<span class="token keyword">sql</span> 中 <span class="token operator">+</span> 没有连接作用。
和字母相加会当<span class="token number">0</span>处理

<span class="token operator">/</span> 除法是默认浮点型，除法自动保留小数位
<span class="token number">100</span> <span class="token operator">div</span> <span class="token number">0</span> 结果为<span class="token boolean">null</span>
mod 模数的符号 和被模数有关  为偶数 <span class="token operator">%</span><span class="token number">2</span>

比较运算符
<span class="token operator">=</span>   字符串存在隐式转换，如果转换不成功，则看做是<span class="token number">0</span>

两边都是字符串，通过ASNI的比较规则比较

只要有<span class="token boolean">null</span>参与运算结果就是<span class="token boolean">null</span>

<span class="token operator">&lt;=&gt;</span>  安全等于 没有<span class="token boolean">null</span> 参与是一样的  <span class="token boolean">null</span>可以参与运算
一样为<span class="token number">1</span> 不一样为<span class="token number">0</span>  <span class="token operator">is</span> <span class="token boolean">null</span>   <span class="token operator">is</span> <span class="token operator">not</span> <span class="token boolean">null</span>  isnull函数

<span class="token keyword">select</span> commission_pct
<span class="token keyword">from</span> employees
<span class="token keyword">where</span> <span class="token operator">not</span> commission_pct <span class="token operator">&lt;=&gt;</span> <span class="token boolean">null</span><span class="token punctuation">;</span> 也可以

LEAST 最小  GREATEST 最大 LENGTH 长度

<span class="token operator">BETWEEN</span> <span class="token operator">AND</span> 区间 左右都包含 要求条件<span class="token number">1</span>是下限 条件<span class="token number">2</span>是上限 

<span class="token operator">and</span> <span class="token operator">&amp;&amp;</span> 且  

<span class="token operator">in</span> 区间   <span class="token operator">not</span> <span class="token operator">in</span>

<span class="token operator">or</span> 或 非零就是<span class="token number">1</span>  条件要完整

<span class="token operator">like</span> 模糊查询  <span class="token operator">%</span>a<span class="token operator">%</span>  <span class="token operator">%</span>不确定个数的字符

last_name <span class="token operator">like</span> <span class="token string">'%a%e%'</span> <span class="token operator">or</span> last_name <span class="token operator">like</span> <span class="token string">'%e%a%'</span>

_ 代表一个不确定的字符

转义字符 \
<span class="token keyword">ESCAPE</span> <span class="token string">'$'</span> 告诉数据库这个是转义字符

<span class="token operator">REGEXP</span>  <span class="token operator">RLIKE</span> 正则
<span class="token operator">^</span> 开头
$ 结尾
<span class="token punctuation">.</span> 任意一个字符
<span class="token punctuation">[</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>abc<span class="token punctuation">]</span> 有a 或b 或c  <span class="token operator">-</span>代表范围
<span class="token operator">*</span> 匹配任意多个字符可以是零个

<span class="token operator">XOR</span> 异或  不同为真，相同为假

<span class="token operator">and</span> 比 <span class="token operator">or</span> 的优先级高



默认存储顺序，先后添加的顺序 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span>

使用 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 默认升序 <span class="token keyword">ASC</span>

可以使用列的别名进行排序

列的别名只能在 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 中使用
<span class="token keyword">WHERE</span> 不可以使用别名

二级排序 逗号分割就可以了 第一列相同
，再考虑第二列

分页节省资源 <span class="token keyword">limit</span> 偏移量 显示条目数

第二页  <span class="token keyword">limit</span> <span class="token number">20</span> <span class="token number">20</span><span class="token punctuation">;</span>

公式 <span class="token punctuation">(</span>pageNo<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span>pageSize<span class="token punctuation">,</span>pageSize

声名顺序 
<span class="token number">1.</span> <span class="token keyword">where</span>
<span class="token number">2.</span> <span class="token keyword">order</span> <span class="token keyword">by</span>
<span class="token number">3.</span> <span class="token keyword">limit</span>

<span class="token keyword">limit</span> 位置偏移量为<span class="token number">0</span> 可以省略这个<span class="token number">0</span>

偏移量从开始 注意一下

Mysql <span class="token number">8.0</span> 新特性

<span class="token keyword">OFFSET</span> 颠倒一下原来的顺序

<span class="token keyword">limit</span> 必须在最后！！！ PGSQL，SQLITE，MARIABD

扩展： sqlserver 使用<span class="token keyword">top</span>
DB2 <span class="token keyword">FETCH</span> <span class="token keyword">FIRST</span> <span class="token number">5</span> <span class="token keyword">ROWS</span> ONLY
oracle rownum 统计 隐藏字段
前<span class="token number">10</span>条记录 rownum<span class="token operator">&lt;=</span><span class="token number">10</span>

length<span class="token punctuation">(</span>email<span class="token punctuation">)</span> <span class="token keyword">desc</span> 邮箱字节数降序


拆表  解决冗余 IO次数变多，影响效率，粒度小的方面考虑 并发的角度

笛卡尔积：员工和部门都匹配了一遍。交叉连接
缺少连接条件  <span class="token keyword">cross</span> <span class="token keyword">join</span>  连接条件没写对
所有可能都出现一遍，元素个数的乘积

<span class="token comment">-- 关联查询</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>department_name
<span class="token keyword">FROM</span> employees<span class="token punctuation">,</span>departments
<span class="token keyword">where</span> employees<span class="token punctuation">.</span>department_id <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id

<span class="token comment">-- 建议多表查询每个字段前都指明所在的表</span>
<span class="token keyword">SELECT</span> employee_id<span class="token punctuation">,</span>department_name<span class="token punctuation">,</span>employees<span class="token punctuation">.</span>department_id
<span class="token keyword">FROM</span> employees<span class="token punctuation">,</span>departments
<span class="token keyword">where</span> employees<span class="token punctuation">.</span>department_id <span class="token operator">=</span> departments<span class="token punctuation">.</span>department_id

<span class="token comment">-- 可以给表起别名。在select 和 where 中使用  原名和别名不能混用，用了别名就不能用原名·</span>

n个表至少要有n<span class="token operator">-</span><span class="token number">1</span>个连接条件，否则会出现笛卡尔积


多表查询的分类
<span class="token number">1.</span> 等值连接和非等值连接
<span class="token number">2.</span> 自连接和非自连接
<span class="token number">3.</span> 内连接和外连接

<span class="token comment">#非等值连接</span>
<span class="token keyword">SELECT</span> e<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>e<span class="token punctuation">.</span>salary<span class="token punctuation">,</span>j<span class="token punctuation">.</span>grade_level
<span class="token keyword">FROM</span> employees e<span class="token punctuation">,</span>job_grades j
<span class="token keyword">where</span> e<span class="token punctuation">.</span>salary <span class="token operator">between</span> j<span class="token punctuation">.</span>lowest_sal <span class="token operator">and</span> j<span class="token punctuation">.</span>highest_sal

<span class="token comment">#自连接 查询员工id，员工姓名及其管理者的id和姓名</span>
<span class="token keyword">SELECT</span> a<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>a<span class="token punctuation">.</span>last_name<span class="token punctuation">,</span>b<span class="token punctuation">.</span>employee_id<span class="token punctuation">,</span>b<span class="token punctuation">.</span>last_name
<span class="token keyword">FROM</span> employees a<span class="token punctuation">,</span>employees b
<span class="token keyword">WHERE</span> a<span class="token punctuation">.</span>manager_id <span class="token operator">=</span> b<span class="token punctuation">.</span>employee_id

内连接  合并具有同一列的两个以上的表的行

外连接 合并具有同一列的两个以上的表的行，与另一个表匹配的行

左外 右外  满连接

sql92 sql99 <span class="token keyword">sql</span>经典标准

sql92 外连接  使用<span class="token operator">+</span> 在裤子短的位置
mysql 不支持sql92   <span class="token punctuation">(</span><span class="token operator">+</span><span class="token punctuation">)</span>

SQL99 是支持的
mysql 不支持 满外连接  <span class="token keyword">FULL</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 
<span class="token keyword">JOIN</span> <span class="token keyword">ON</span>

<span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token keyword">ON</span> 内连接 <span class="token keyword">INNER</span> 可以省略
<span class="token keyword">LEFT</span> <span class="token keyword">OUTER</span> <span class="token keyword">JOIN</span> 外连接 <span class="token keyword">OUTER</span> 可以省略

SQL99 <span class="token number">7</span>种<span class="token keyword">JOIN</span>实现方式

<span class="token keyword">union</span> 合并查询结果 去重重复数据  列必须一样
<span class="token keyword">union</span> <span class="token keyword">all</span> 合并查询结果 不去重   效率高  最好用<span class="token keyword">union</span> <span class="token keyword">all</span>

使用<span class="token operator">IS</span> <span class="token boolean">NULL</span>  去掉对应的中间部分

自然连接
两个连接条件  <span class="token keyword">NATURAL</span> <span class="token keyword">JOIN</span>  它回自动帮我查询两张连接表中的所有相同字段的，进行等值连接

<span class="token keyword">USING</span>
替换连接条件  当两张表的名字是一样的 里面是相同的字段名
<span class="token keyword">USING</span><span class="token punctuation">(</span>department_id<span class="token punctuation">)</span>

阿里巴巴 规范 禁止超过三个表进行<span class="token keyword">join</span>操作

</code></pre></div><h2 id="函数"><a href="#函数" class="header-anchor">#</a> 函数</h2> <ol><li>将代码进行封装，提高了代码效率，提高了维护性，提高用户对数据库的关联效率</li> <li>SQL代码移植性比较差。</li></ol> <h3 id="单行函数-可以嵌套"><a href="#单行函数-可以嵌套" class="header-anchor">#</a> 单行函数（可以嵌套）</h3> <p>一行出来一行</p> <div class="language-sql extra-class"><pre class="language-sql"><code>数值函数
ABS 绝对值
SIGN 返回符号i
PI 圆周率
CEIL 和 CEILING 天花板
FLOOR 地板
LEAST 一列最小
GREATEST 一列最大
MOD 取余
RAND 随机值 <span class="token number">0</span><span class="token operator">~</span><span class="token number">1</span>
RAND（x） 随机值<span class="token number">0</span><span class="token operator">~</span><span class="token number">1</span>  x值会产生相同的随机数
ROUND 四舍五入  后面的参数可以是负数，抹零
<span class="token keyword">TRUNCATE</span>（x<span class="token punctuation">,</span>y）  x截取y位小数
SQRT<span class="token punctuation">(</span>x<span class="token punctuation">)</span> x的平方根

角度和弧度的互换
RADIANS   角度变弧度
DEGREES   弧度变角度
SIN
ASIN
COS
ACOS
TAN
ATAN
ARAN2
COT

指数和对数
pow power
exp  e的x次方  e位常数<span class="token number">2.718128182859045</span>
ln log
log10  log2

进制转换
BIN  二进制
HEX  <span class="token number">16</span>进制
OCT   <span class="token number">8</span>进制
CONV 机制转换  conv<span class="token punctuation">(</span>x<span class="token punctuation">,</span>f1<span class="token punctuation">,</span>f2<span class="token punctuation">)</span>


字符串函数
ASCII 第一个字符有关系
CHAR_LENGTH 字符长度
LENGTH UTF8 汉字三个字节 字节长度
CONCAT 连接字符串
CONCAT_WS 指定连接字符
<span class="token keyword">INSERT</span> 字符串的索引是从<span class="token number">1</span>开始的    替换 从索引位置 替换多少个
<span class="token keyword">REPLACE</span> 替换
UPPER 大写
LOWER 小写
<span class="token keyword">LEFT</span> 最左面的几个字符
<span class="token keyword">RIGHT</span> 最右面的几个字符 
LPAD 左补充 一共多少位  以什么补齐
RPAD 右补充 一共多少位  以什么补齐
TRIM 去除空格
LTRIM 左去除
RTRIM 右去除
TRIM（s1 <span class="token keyword">FROM</span> S）指定去除什么
TRIM<span class="token punctuation">(</span>LEADING s1 <span class="token keyword">FROM</span> S<span class="token punctuation">)</span> 去除头部的S1
TRIM<span class="token punctuation">(</span>TRAILING s1 <span class="token keyword">FROM</span> S<span class="token punctuation">)</span> 去除尾部的S1
<span class="token keyword">REPEAT</span> 重复n次结果
SPACE 返回几个空格
STRCMP 比较ASCII码
SUBSTR 截取字符串
LOCATE 返回首次出现的位置
ELT 返回指定位置的字符串
FIELD  返回字符串s在字符串列表中首次出现的位置
FIND_IN_SET 返回字符串s1在字符串s2出现的位置
REVERSE 反转
<span class="token keyword">NULLIF</span> 相等返回<span class="token boolean">NULL</span>，不想等返回前面的

日期函数
CURDATE<span class="token punctuation">(</span><span class="token punctuation">)</span> 当前时间   年月日
CURTIME<span class="token punctuation">(</span><span class="token punctuation">)</span> 当前时间   时分秒
<span class="token function">NOW</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   当前时间
UTC_DATE<span class="token punctuation">(</span><span class="token punctuation">)</span>  格林威治时间 年月日
UTC_TIME<span class="token punctuation">(</span><span class="token punctuation">)</span>  格林威治时间 时分秒

日期转时间戳
UNIX_TIMESTAMP<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span>
UNIX_TIMESTAMP<span class="token punctuation">(</span><span class="token punctuation">)</span>
FROM_UNIXTIME<span class="token punctuation">(</span><span class="token punctuation">)</span>

年，月，日，星期，时分秒的获取
<span class="token keyword">YEAR</span> <span class="token keyword">MONTH</span> <span class="token keyword">DAY</span>
<span class="token keyword">HOUR</span> <span class="token keyword">MINUTE</span> <span class="token keyword">SECOND</span>
MONTHNAME  英文月数
DAYNAME 英文周几
WEEKDAY 第几周
QUARTER 季节
WEEK 这一年的第几周
DAYOFYEAR 这一年的多少天
DAYOFMONTH 这个月的第几天
DAYOFWEEK 周几

日期的操作函数  提取日期
EXTRACT<span class="token punctuation">(</span><span class="token keyword">type</span> <span class="token keyword">from</span> <span class="token keyword">date</span><span class="token punctuation">)</span>
<span class="token keyword">type</span> 可以是对应的类型  

时间和秒数的转换
TIME_TO_SEC<span class="token punctuation">(</span><span class="token punctuation">)</span>
SECT_TO_TIME<span class="token punctuation">(</span><span class="token punctuation">)</span>

计算日期和时间的函数
DATE_ADD<span class="token punctuation">(</span><span class="token keyword">dateTIME</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> expr <span class="token keyword">type</span><span class="token punctuation">)</span> 新增时间
DATE_SUB<span class="token punctuation">(</span><span class="token keyword">dateTIME</span><span class="token punctuation">,</span><span class="token keyword">INTERVAL</span> expr <span class="token keyword">type</span><span class="token punctuation">)</span> 减去时间
ADDTIME<span class="token punctuation">(</span>time1<span class="token punctuation">,</span>time2<span class="token punctuation">)</span>   数字值时是秒
SUBTIME<span class="token punctuation">(</span>time1<span class="token punctuation">,</span>time2<span class="token punctuation">)</span>   数字值时是秒
DATEDIFF<span class="token punctuation">(</span>date1<span class="token punctuation">,</span>date2<span class="token punctuation">)</span>  间隔多少天
TIMEDIFF<span class="token punctuation">(</span>time1<span class="token punctuation">,</span>time2<span class="token punctuation">)</span>  间隔时间
FROM_DAYS<span class="token punctuation">(</span>N<span class="token punctuation">)</span> 从<span class="token number">0000</span>年<span class="token number">1</span>月<span class="token number">1</span>日。N天以后的日期
TO_DAYS<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">)</span>  返回日期<span class="token keyword">date</span>日期距离<span class="token number">0000</span>年<span class="token number">1</span>月<span class="token number">1</span>日所在天数
LAST_DAY<span class="token punctuation">(</span><span class="token punctuation">)</span>  所在年份最后一天
MAKEDATE<span class="token punctuation">(</span><span class="token keyword">year</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span>  根据年和日创建时间
MAKETIME<span class="token punctuation">(</span><span class="token keyword">hour</span><span class="token punctuation">,</span><span class="token keyword">minute</span><span class="token punctuation">,</span><span class="token keyword">second</span><span class="token punctuation">)</span> 分解小时，分，秒。计算时间返回
PERIOD_ADD<span class="token punctuation">(</span><span class="token keyword">time</span><span class="token punctuation">,</span>n<span class="token punctuation">)</span> 返回<span class="token keyword">time</span>加上n后的时间

日期的格式化和解析
DATE_FORMAT<span class="token punctuation">(</span><span class="token keyword">date</span><span class="token punctuation">,</span>fmt<span class="token punctuation">)</span>   
TIME_FORMAT<span class="token punctuation">(</span><span class="token keyword">time</span><span class="token punctuation">,</span>fmt<span class="token punctuation">)</span>
GET_FORMAT<span class="token punctuation">(</span>date_type<span class="token punctuation">,</span>format_type<span class="token punctuation">)</span> 获取格式化
STR_TO_DATE<span class="token punctuation">(</span>str<span class="token punctuation">,</span>fmt<span class="token punctuation">)</span> 
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702226252050-f799ecfe-7574-4a12-819c-30f99f3c0d8c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702226310501-cb8c5425-8731-4883-8d42-98abb6c71221.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702226615440-7deca405-a522-4849-9a31-08e76824711b.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702227555063-26b4ffb3-9e15-4cb7-98a1-fb4e732ebfe2.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702227642841-537deee1-8e90-4410-806a-3c3823389a95.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702227721960-bf59b782-7225-412c-a556-a0c75f2d5762.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702228133320-34a083aa-1326-4a4f-9149-fd3d8e77f5a0.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1708500299115-0f839a05-0804-47a4-a616-6e256657c722.png" alt=""></p> <h3 id="聚合函数"><a href="#聚合函数" class="header-anchor">#</a> 聚合函数</h3> <p>一行出来多行</p> <h3 id="流程控制函数"><a href="#流程控制函数" class="header-anchor">#</a> 流程控制函数</h3> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702526490028-9674fe39-59f8-4ebd-8a42-7d312edddbf0.png" alt=""></p> <ul><li>第一个有些像三元表达式</li> <li>第4个 expr  是字段名   when 后面是常量值  起别名要在END 后</li></ul> <h2 id="加密和解密的操作"><a href="#加密和解密的操作" class="header-anchor">#</a> 加密和解密的操作</h2> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702529156552-04a0c933-62da-47a0-a34d-ae53c2fe99f1.png" alt=""></p> <p>password ENCODE  DECODE 8.0 的版本不支持，已弃用。</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702529516091-5b03d7aa-3260-478d-9b62-4b87704e4060.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702529652572-943712aa-0443-4f5b-a3d2-6b9a683248c8.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702529809553-4b40f110-9fd0-423c-8527-e88ed98980dc.png" alt=""></p> <p>char_length  字符多少</p> <p>length 字节多少</p> <div class="language-sql extra-class"><pre class="language-sql"><code>AVG 平均值  里面是字符串是没有意义的
SUM  和   里面是字符串是没有意义的
MAX 最大  可以是字符串或者日期
MIN 最小  可以是字符串或者日期
COUNT 作用 计算指定字段在查询结果中的作用   记录数
<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> 把每一行当成<span class="token number">1</span>
<span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>  也可以
<span class="token function">COUNT</span><span class="token punctuation">(</span>具体字段<span class="token punctuation">)</span> 不一定对的  不计算空值的
sum 计算不考虑<span class="token boolean">null</span>值   avg 计算也不考虑<span class="token boolean">null</span>值  里面使用ifnull<span class="token punctuation">(</span>字段值，<span class="token number">0</span><span class="token punctuation">)</span>处理

MyISAM 存储引擎  三者效率相同 O1
<span class="token keyword">Innodb</span> 存储引擎 <span class="token function">count</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">count</span><span class="token punctuation">(</span>字段<span class="token punctuation">)</span>  效率高是因为使用了二级索引 找key_len 小的

<span class="token keyword">GROUP</span> <span class="token keyword">BY</span>
<span class="token keyword">SELECT</span> 中出现一下的非组函数的字段必须声明在<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> 中，反之，<span class="token keyword">GROUP</span> <span class="token keyword">by</span> 中声名的字段可以不出现在<span class="token keyword">SELECT</span>中



<span class="token keyword">WITH ROLLUP</span> 整体的分组  慎重和<span class="token keyword">order</span> <span class="token keyword">by</span> 使用 会报错

如何过滤条件中使用了聚合函数，则必须使用<span class="token keyword">having</span>来替换<span class="token keyword">where</span>，否则报错

<span class="token keyword">having</span> 必须声名在<span class="token keyword">group</span> <span class="token keyword">by</span> 的后面

开发中使用的前提是<span class="token keyword">sql</span>中，使用了<span class="token keyword">group</span> <span class="token keyword">by</span>，针对分组进行过滤的

当过滤条件中有聚合函数时候，则此过滤条件必须声名在<span class="token keyword">HAVING</span>中。
没有聚合函数声名在<span class="token keyword">where</span>中，<span class="token keyword">where</span>效率高于<span class="token keyword">having</span>

</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702800945058-dd000dff-5563-4379-923b-6dcabbf78ef0.png" alt=""></p> <h2 id="sql执行原理"><a href="#sql执行原理" class="header-anchor">#</a> SQL执行原理</h2> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702801660795-99333ba3-a35b-473c-a1e8-75dbe9a383f7.png" alt=""></p> <ol><li>FROM 交叉连接</li> <li>ON 过滤</li> <li>左外还是右外</li> <li>WHERE</li> <li>GROUP BY</li> <li>HAVING</li> <li>SELECT 列上的过滤</li> <li>DISTINCT 去重</li> <li>ORDER BY</li> <li>LIMIT</li></ol> <p>每一个步骤都会产生一个虚拟表</p> <h2 id="子查询"><a href="#子查询" class="header-anchor">#</a> 子查询</h2> <p>谁的工资比Abel 高</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702827864201-b2abe253-ac22-4efd-a2fa-f34b93d74bdd.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> last_name<span class="token punctuation">,</span>salary
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> salary <span class="token operator">&gt;</span> <span class="token punctuation">(</span>
			<span class="token keyword">SELECT</span> salary
			<span class="token keyword">FROM</span> employees
			<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> <span class="token string">'Abel'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

外查询（主查询）  内查询（子查询）

内查询先计算
子查询在括号内
放在比较条件的右侧 可读性比较好

单行子查询和多行子查询

</code></pre></div><p>分类</p> <ol><li>单行子查询和多行子查询   根据查询出来的条目数去辨别</li> <li>内查询是否被执行多次，相关子查询和非相关子查询</li></ol> <p>相关子查询  子查询的结果是变化的</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1702828841983-f560e4f9-8f11-4364-b733-01e5fc7ab188.png" alt=""></p> <p>子查询有空值，不返回任何行</p> <p>单行子查询  =  !=&gt; &lt; &gt;= &lt;=</p> <p>多行子查询  in  any  some   all</p> <p>any 和 some 是同一个    all和 any 经常和单行运算符一起用</p> <p>聚合函数 不能嵌套   mysql 不可以   oracle 可以</p> <p>子查询作为表用的时候要有别名</p> <p>查询平均工资最低的部门id</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703000365421-344f599a-7ba2-48a8-aa9d-be63f36dab1a.png" alt=""></p> <p>内查询有null值，not in 就不会有结果</p> <p>关联子查询</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703004015527-5e1fc126-7e3a-4290-ac11-5203e3f959e2.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703004282580-317a8f20-7e20-4fc3-8c28-7fd0d171b18a.png" alt=""></p> <p>结论：在SELECT 除了GROUP BY 和 LIMIT 之外其他位置，都可以声名子查询。</p> <p>EXISTS 和 NOT EXISTS</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703005447089-93119a2f-0e54-48ee-bc3d-2edc5f51a045.png" alt=""></p> <p>自连接 效率高于子查询</p> <p>相关子查询 比较简单 从外往里面写</p> <h2 id="标识符命名规则"><a href="#标识符命名规则" class="header-anchor">#</a> 标识符命名规则</h2> <ol><li>数据库和表名不能超过30个字符，变量名限制为29个</li> <li>必须只能包含A-Z，a-z，0-9，_</li> <li>中间不能有空格</li> <li>数据库中表不能重名，表中字段不能重名</li> <li>字段没有保留字，如果要用就加上着重号</li> <li>表和表直接的字段名和类型要保持一致</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703173994897-fa1d3e65-5597-44cb-869d-4e1a39a78ae8.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token operator">not</span> exist 数据库名  <span class="token keyword">character</span> <span class="token keyword">set</span> 字符集
<span class="token comment">// 查看当前使用的数据库</span>
<span class="token keyword">SELECT</span> <span class="token keyword">DATABASE</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">FROM</span> DUAL<span class="token punctuation">;</span>
<span class="token comment">// 查看指定数据库下的表</span>
<span class="token keyword">SELECT</span> <span class="token keyword">TABLES</span> <span class="token keyword">FROM</span> mysql<span class="token punctuation">;</span>
<span class="token comment">// 查看数据库的创建信息</span>
<span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">DATABASE</span> 数据库名<span class="token punctuation">;</span>
<span class="token comment">// 修改数据库字符集</span>
<span class="token keyword">ALTER</span> <span class="token keyword">DATABASE</span> 数据库名 <span class="token keyword">character</span> <span class="token keyword">set</span> 字符集
可视化工具 改库名都是创建一个新的库，把数据复制过去，成本比较高
<span class="token comment">// 删除数据库</span>
<span class="token keyword">DROP</span> <span class="token keyword">DATABASE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> 数据库名
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703175264471-2451e662-6d4a-4bdf-93f7-7dcf724da73a.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703175391001-1d82e6b8-0091-4bff-bbf9-152120621fec.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token operator">NOT</span> EXIST 表名<span class="token punctuation">(</span>
字段名  字段类型  字段长度
<span class="token punctuation">)</span>

<span class="token keyword">desc</span> 表名   <span class="token comment">// 查看表结构</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> 表名 <span class="token comment">// 查看表结构</span>

<span class="token comment">// 数据也会带过来 需要用where 1 =2 过滤数据  别名也可以用就是字段名  也可以关联表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> 表名
<span class="token keyword">as</span>
<span class="token keyword">select</span> 字段名
<span class="token keyword">FROM</span> 表名 

</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703175967153-a4279748-6110-451d-a579-b0618927aea6.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703176149732-a3af5ebf-5520-4819-8819-b1cc6e3ad2da.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">// 修改表  alter table</span>
<span class="token number">1</span>， 添加字段  默认添加到表的最后一个字段 
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名  <span class="token keyword">ADD</span> 字段名 字段类型  <span class="token punctuation">[</span><span class="token keyword">FIRST</span><span class="token operator">|</span><span class="token keyword">AFTER</span> 字段名<span class="token punctuation">]</span>
<span class="token number">2.</span> 修改字段 数据类型 长度
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">MODIFY</span> 字段名 字段类型 <span class="token punctuation">[</span><span class="token keyword">default</span> <span class="token string">'aaa'</span><span class="token punctuation">]</span>
<span class="token number">3.</span> 重命名一个字段 有<span class="token keyword">MODIFY</span>行为
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 CHANGE  字段名 字段类型 新字段名 字段类型 
<span class="token number">4.</span> 删除一个字段
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 表名 <span class="token keyword">DROP</span> <span class="token keyword">COLUMN</span> 字段名
<span class="token comment">// 重命名表</span>
<span class="token keyword">RENAME</span> <span class="token keyword">TABLE</span> 原数据库名 <span class="token keyword">TO</span> 新数据库名
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 原数据库名 <span class="token keyword">RENAME</span> <span class="token keyword">TO</span> 新数据库名
<span class="token comment">// 删除表 不能回滚  日志文件 触发器 备份 释放表空间</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> <span class="token keyword">IF</span> <span class="token keyword">EXISTS</span> 表名
<span class="token comment">// 清空表 清空数据，表结构还在</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> 表名
</code></pre></div><h2 id="commit和rollback"><a href="#commit和rollback" class="header-anchor">#</a> COMMIT和ROLLBACK</h2> <p>commit  提交数据  一旦执行，数据永久保存  不可以回滚</p> <p>rollback  可以实现数据的回滚，回滚到最近一次commit</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment">// 相同点  都是对数据的删除，同时保留表结构</span>
<span class="token comment">// 不同点</span>
<span class="token keyword">TRUNCATE</span> 数据不可以回滚，表数据全部清除
<span class="token keyword">DELETE</span> 可以全部清除，数据可以回滚

<span class="token comment">// DDL 和 DML 的说明</span>
DDL 一旦执行，就不可以回滚，自动<span class="token keyword">COMMIT</span> 不受我们的<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token boolean">false</span>操作影响
DML 默认情况下，一旦执行，也不可以回滚，通过修改参数可以回滚，如在执行DML之前
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token boolean">false</span> 就可以回滚
<span class="token comment">// DELETE</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> 表名
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
<span class="token comment">// TRUNCATE</span>
<span class="token keyword">COMMIT</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> autocommit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token keyword">TRUNCATE</span> <span class="token keyword">TABLE</span> 表名
<span class="token keyword">ROLLBACK</span><span class="token punctuation">;</span>
</code></pre></div><p>mysql8.0 的原子性  要么全部成功，要么不成功   区别于5.7   体现在进行DDL 操作的时候，执行成功的效果</p> <h2 id="dml-添加数据"><a href="#dml-添加数据" class="header-anchor">#</a> DML 添加数据</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1 <span class="token keyword">values</span> <span class="token punctuation">(</span>字段值<span class="token punctuation">,</span>字段值<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 一定要知道声名字段的先后顺序</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1<span class="token punctuation">(</span>字段名<span class="token punctuation">)</span> <span class="token keyword">VALUES</span><span class="token punctuation">(</span>字段值<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 推荐这种  里面的值可以少，但是要一一对应</span>
可以使用逗号同时插入记录  插入多条记录  效率高 比单行一条一条添加快

<span class="token comment">// 将查询结果插入到表中</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> emp1<span class="token punctuation">(</span>字段名<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> 查询   查询的字段名要与添加到的字段一一对应  数据范围不一样可能会报错 数据长度不够的风险
</code></pre></div><h3 id="更新-删除数据"><a href="#更新-删除数据" class="header-anchor">#</a> 更新/删除数据</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">update</span> 表名 <span class="token keyword">set</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">where</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
可以实现批量修改

修改同一数据的多个字段 逗号分割   可能存在不成功的情况 收到约束影响

<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">WHERE</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  删除也可能存在不成功的情况，表之间存在外键

回滚可以使用<span class="token keyword">set</span> autocommit <span class="token operator">=</span> <span class="token boolean">FALSE</span>
</code></pre></div><h3 id="mysql-8-0-计算列"><a href="#mysql-8-0-计算列" class="header-anchor">#</a> MYSQL 8.0 计算列</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> test<span class="token punctuation">(</span>
  a <span class="token keyword">INT</span><span class="token punctuation">,</span>
  b <span class="token keyword">INT</span><span class="token punctuation">,</span>
  c <span class="token keyword">INT</span> GENERATED ALWAYS <span class="token keyword">AS</span> <span class="token punctuation">(</span>a<span class="token operator">+</span>b<span class="token punctuation">)</span> VIRTUAL
<span class="token punctuation">)</span>
</code></pre></div><h3 id="去掉字符串中间的空格"><a href="#去掉字符串中间的空格" class="header-anchor">#</a> 去掉字符串中间的空格</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">replace</span><span class="token punctuation">(</span>字段值<span class="token punctuation">,</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="插入-删除新方法"><a href="#插入-删除新方法" class="header-anchor">#</a> 插入/删除新方法</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">insert</span> <span class="token keyword">into</span>  表名
<span class="token keyword">select</span> 字段值<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token keyword">union</span> <span class="token keyword">all</span>

<span class="token keyword">DELETE</span> 表<span class="token number">1</span>别名，表<span class="token number">2</span>别名
<span class="token keyword">FROM</span> 表<span class="token number">1</span> <span class="token keyword">JOIN</span> 表<span class="token number">2</span> <span class="token keyword">ON</span> 条件 <span class="token keyword">WHERE</span> 过滤条件
</code></pre></div><h2 id="数据类型"><a href="#数据类型" class="header-anchor">#</a> 数据类型</h2> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703175264471-2451e662-6d4a-4bdf-93f7-7dcf724da73a.png?x-oss-process=image%2Fresize%2Cw_1125%2Climit_0" alt="">    1. 创建数据库，表和字段都可以知道字符集 character set 'utf8'</p> <p><img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703695330489-739ec2d8-eef0-4c08-ba06-bec7e38953d0.png" alt="">'<img src="https://cdn.nlark.com/yuque/0/2023/png/33708367/1703835292378-14715472-906f-44be-b58b-10a9c79491dd.png" alt=""></p> <p>ZEROFILL 零填充</p> <p>INT(5)  显示宽度  配合 ZEROFILL 使用 当显示宽度不足五位用0填充  自动加上unsigned</p> <p>8.0.17 以后不要使用显示宽度了</p> <p>TINYINT   设置取值范围的时候</p> <p>SMALLINT  统计工厂的固定资产库存数量</p> <p>MEDIUMINT  客流量</p> <p>INT  商品编号</p> <p>BIGINT 双十一的交易量，大型门户网站点击量</p> <p>存储空间和可靠性</p> <p>确保数据不会超过取值范围</p> <h3 id="浮点类型"><a href="#浮点类型" class="header-anchor">#</a> 浮点类型</h3> <p>REAL 默认就是double，可以改成float</p> <p>REAL_AS_FLOAT</p> <p>浮点数格式：符号，尾数，阶码</p> <p>非标准写法 FLOAT（M,D）M是标度，D是精度</p> <p>UNSIGNED 只有一半的</p> <p>超过整数，报错</p> <p>超过小数，四舍五入</p> <p>建议不要使用等号去判断是否相等。</p> <p>场景：计算化学，分子建模，流体动力学</p> <h3 id="定点数"><a href="#定点数" class="header-anchor">#</a> 定点数</h3> <p>decimal 最大的取值范围和DOUBLE 一样（注意不是有效取值范围）</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704850413476-9849076a-5019-431f-a0a8-e5104913511f.png" alt=""></p> <p>底层使用字符串方式去存储</p> <p>默认decimal (10,0)</p> <p>场景：金额计算</p> <h3 id="位类型"><a href="#位类型" class="header-anchor">#</a> 位类型</h3> <p>BIT  2进制  默认是1位</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704853334879-26b22a4a-44eb-4493-acd1-269dd3f194ab.png" alt=""></p> <p>BIN（）  HEX（） 读取方式 2进制16进制</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704853718732-e3771023-7086-4408-9818-0880bf175229.png" alt=""></p> <p>10进制</p> <h3 id="时间类型"><a href="#时间类型" class="header-anchor">#</a> 时间类型</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704855778317-1794b11b-1a81-4fe2-bd53-1c2d257906e9.png" alt=""></p> <p>year</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704856353769-deadcf43-24fe-4d2a-8aa5-8e00526e09d6.png" alt=""></p> <p>TIME</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704861472832-e7779221-d4c5-41c3-861e-c4d8d1c0afdf.png" alt=""></p> <p>DATETIME 和 TIMESTAMP 区别</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> time_zone<span class="token operator">=</span><span class="token string">'+9:00'</span>
</code></pre></div><p>TIMESTAMP 存储空间小，时间范围小</p> <p>TIMESTAMP 底层是毫秒值</p> <p>两个日期比较大小或日期计算时，TIMESTAMP更快</p> <p>TIMESTAMP和时区有关，用户所处不同时区显示不同结果</p> <p>DATETIME只能反应插入时候的时区</p> <p><font style="color:#DF2A3F;">DATETIME 使用最多</font></p> <p><font style="color:#DF2A3F;">注册时间，商品发布时间不建议使用，最好使用时间戳，因为DATETIME不方便计算。<br></font></p> <h3 id="字符串类型"><a href="#字符串类型" class="header-anchor">#</a> 字符串类型</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704936681037-f3e2fe97-1a7e-4a13-8b4f-acff33c8b1d4.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704936702045-98de466a-72cc-4d70-b1c9-fa3f93dd0afb.png" alt=""></p> <p>char 默认1   右侧填充空格</p> <p>varchar 必须指定 M  长度</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704937305466-ad17187c-6508-4d27-a21c-a650426985f6.png" alt=""></p> <p>存储很短 用char</p> <p>固定长度 用char</p> <p>十分频繁的改字段  用char</p> <p>存储引擎</p> <p>MYISAM  建议用char 长度固定，静态化，数据检索更快</p> <p>MEMORY 不管定义什么都是char</p> <p>INNODB 推荐使用varchar  主要影响因素是数据行存储的总量</p> <h3 id="text-类型"><a href="#text-类型" class="header-anchor">#</a> TEXT 类型</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704937978038-3bf03ec0-ba1d-4fbd-a531-6e7da82d7e69.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704938471115-94978aff-70ce-428f-b709-ed3b2d1edbc1.png" alt=""></p> <h3 id="enum类型"><a href="#enum类型" class="header-anchor">#</a> ENUM类型</h3> <p>忽略大小写</p> <p>可以使用索引进行调用</p> <p>可以添加null，没有限制非空</p> <p>只能选一个</p> <h3 id="set类型"><a href="#set类型" class="header-anchor">#</a> SET类型</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1704939048530-069b9f32-0366-48d7-bec7-dd2d341447c4.png" alt=""></p> <p>可以写多个，不可以写不存在的，多个会去重</p> <h3 id="二进制字符串"><a href="#二进制字符串" class="header-anchor">#</a> 二进制字符串</h3> <p>BINARY 和 VARBINARY 和 char VARCHAR类似   VARBINARY 必须指定长度   BINARY 不指明是1</p> <p>BIOB 二进制大对象  图片，音频，视频</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1705134934691-dd87cdbd-0037-488c-922d-0a68c1c3590d.png" alt=""></p> <p>开发中很少把文件存到数据库，都是存路径</p> <p>OPTIMIZETABLE 功能对表进行碎片整理，空洞</p> <p>前缀索引 少去检索大文本</p> <p>分离单独表去做，减少主表碎片</p> <h3 id="json类型"><a href="#json类型" class="header-anchor">#</a> JSON类型</h3> <p>数据交互格式</p> <p>js  JSON可以将JS对象表示一组数据转换成字符串。 js -&gt; $.字段名</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1705136750679-261ba031-5a37-4f44-a805-c15b330f6d9c.png" alt=""></p> <h3 id="空间类型"><a href="#空间类型" class="header-anchor">#</a> 空间类型</h3> <p>单值和集合类型 用的比较少  地理特征的生成存储和分析</p> <h3 id="数据类型小结-可靠性"><a href="#数据类型小结-可靠性" class="header-anchor">#</a> 数据类型小结 可靠性</h3> <p>整数 INT</p> <p>小数 DECIMAL</p> <p>日期和时间 DATETIME</p> <p>非负数 UNSIGNED</p> <p>小数 超出 分开存储</p> <p>定长用char</p> <p>长度不超过5000用VARCHAR，超出就用text</p> <h2 id="为什么需要约束"><a href="#为什么需要约束" class="header-anchor">#</a> 为什么需要约束</h2> <ol><li>保证数据的完整性</li></ol> <h3 id="考虑方面"><a href="#考虑方面" class="header-anchor">#</a> 考虑方面</h3> <ul><li>实体完整性</li> <li>域完整性</li> <li>引用完整性</li> <li>用户自定义完整性</li></ul> <h2 id="约束"><a href="#约束" class="header-anchor">#</a> 约束</h2> <p>创建表时规定的约束，表创建之后通过语句规定约束   表级的强制规定</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> 添加约束
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> 增加约束<span class="token operator">/</span>删除约束
</code></pre></div><h3 id="约束的分类"><a href="#约束的分类" class="header-anchor">#</a> 约束的分类</h3> <ul><li>跟进约束数据列的限制</li></ul> <ol><li>单列约束: 每个约束只约束一列</li> <li>多列约束: 每个约束可约束多列数据</li></ol> <ul><li>约束的作用</li></ul> <ol><li>列级约束： 只能作用一个列跟在列的后面</li> <li>表级约束：可以作用在多个列上，不与列一起，而是单独定义</li></ol> <h3 id="约束的种类"><a href="#约束的种类" class="header-anchor">#</a> 约束的种类</h3> <ul><li>NOT NULL 非空约束</li> <li>UNIQUE 唯一约束</li> <li>PRIMARY  主键约束</li> <li>FOREIGN KEY 外键约束</li> <li>CHECK 检查约束</li> <li>DEFAULT 默认值约束</li></ul> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span>table_constraints
<span class="token keyword">where</span> table_name <span class="token operator">=</span> <span class="token string">'employees'</span>
</code></pre></div><h4 id="非空约束"><a href="#非空约束" class="header-anchor">#</a> 非空约束</h4> <p>NOT NULL   默认都可以为NULL  列级约束</p> <h4 id="唯一约束"><a href="#唯一约束" class="header-anchor">#</a> 唯一约束</h4> <div class="language-plain extra-class"><pre class="language-plain"><code>UNIQUE KEY unique_key (column1, column2) 夹在创建表里面
UNIQUE key 单个唯一约束
UNIQUE key(...,...) 复核唯一约束  会自动添加索引
</code></pre></div><h4 id="删除约束"><a href="#删除约束" class="header-anchor">#</a> 删除约束</h4> <div class="language-plain extra-class"><pre class="language-plain"><code>删除唯一索引，删除指定唯一索引名
单列就是列名，多列可以是第一个字段名
ALTER TABLE USER DROP INDEX uk_name_pwd
// 查看表索引
show index from 表名称
</code></pre></div><h4 id="主键约束"><a href="#主键约束" class="header-anchor">#</a> 主键约束</h4> <div class="language-plain extra-class"><pre class="language-plain"><code>primary key 标识表中的一条记录  唯一加非空
一个表只能有一个主键约束
主键名 primary
primary key  (column1, column2) 要求均不为空NULL
ALTER TABLE 表名	ADD primary key （字段名）
ALTER TABLE 表名 DROP primary key  删除主键
</code></pre></div><h4 id="自增列-auto-increment"><a href="#自增列-auto-increment" class="header-anchor">#</a> 自增列 AUTO_INCREMENT</h4> <div class="language-plain extra-class"><pre class="language-plain"><code>一个表里面只能有一个自增长列
必须是整型的
列必须有主键约束或者唯一约束
当我们向主键的字段，添加0或者null 会自动往上添加

ALTER TABLE 表名 modify 主键名 主键类型 AUTO_INCREMENT
// 删除
ALTER TABLE 表名 modify 主键名 主键类 
MYSQL 5.7 
AUTO_INCREMENT 内存中维护一个值 重启就会重新计算

MYSQL 8.0
自增主键的持久化到重做日志中，每次计数器变化都会写入重做日志， redo日志读取记录
</code></pre></div><h4 id="foreign-key-约束"><a href="#foreign-key-约束" class="header-anchor">#</a> FOREIGN KEY 约束</h4> <p>限制某个表的某个字段的引用完整性</p> <div class="language-plain extra-class"><pre class="language-plain"><code>关联字段在主表，必须有主键约束或者唯一约束
默认不是列名，自动生成的
创建 先主后从
删除 先从后主
名可以不一样，数据类型要一样
外键约束也会建索引，只不过是普通索引
删除约束，要手动删除索引
// 表级约束
CONSTRAINT 约束名 FOREIGN KEY （字段名） REFERENCES 主表（主表字段）
ALTER TABLE 表名 ADD CONSTRAINT 约束名 FOREIGN KEY （字段名） REFERENCES 主表（主表字段）
</code></pre></div><h5 id="约束等级"><a href="#约束等级" class="header-anchor">#</a> 约束等级</h5> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1708496049521-8e79cfec-a031-418b-8150-09bf1abe31c2.png" alt=""></p> <div class="language-plain extra-class"><pre class="language-plain"><code>ON UPDATE CASCADE ON DELETE SET NULL

// 删除外键约束
ALTER TABLE 从表名 DROP FOREIGN KEY 外键的约束名
// 删除外键索引
ALTER TABLE 从表名 DROP INDEX 外键的约束名
</code></pre></div><p>外键约束有成本，因为外键约束的系统开销而变得非常慢</p> <p><font style="color:#DF2A3F;">阿里开发规范</font></p> <p>不得使用外键和级联，一切外键必须在应用层面去解决</p> <p>外键 适合单机，低并发</p> <p>不适合 分布式和高并发集群 级联更新强阻塞，更新风暴，影响插入速度</p> <h4 id="check-约束-5-7不支持"><a href="#check-约束-5-7不支持" class="header-anchor">#</a> CHECK 约束  5.7不支持</h4> <p>检查某个字段的值，是符合要求</p> <div class="language-plain extra-class"><pre class="language-plain"><code>check(salary &gt; 2000)
</code></pre></div><h4 id="default-约束"><a href="#default-约束" class="header-anchor">#</a> DEFAULT 约束</h4> <p>默认值</p> <h2 id="面试题"><a href="#面试题" class="header-anchor">#</a> 面试题</h2> <ol><li>not null default  '' 或 default 0  不想让表中出现默认值</li> <li>效率不高，影响提高索引的效果。</li> <li>AUTO_INCREMENT跟第一条有关</li> <li>外键约束不能跨引擎使用</li></ol> <h2 id="数据库对象"><a href="#数据库对象" class="header-anchor">#</a> 数据库对象</h2> <ol><li>数据字典：系统表，存放数据库信息的表</li> <li>存储过程，没有返回值</li> <li>存储函数，有返回值，用户自定义</li> <li>触发器，事件的监听器，比如数据备份</li></ol> <h2 id="视图-虚拟表"><a href="#视图-虚拟表" class="header-anchor">#</a> 视图（虚拟表）</h2> <p>更改视图，原表中的数据也会更改，创建视图的根据表叫<font style="color:#DF2A3F;">基表</font></p> <p><font style="color:#000000;">存储起来的select 语句</font></p> <p><font style="color:#000000;">小型项目 不推荐使用   控制数据访问</font></p> <div class="language-plain extra-class"><pre class="language-plain"><code>create view 视图名 as select 语句
show tables;// 查看表和视图
desc 视图名
show table status like '视图名'
show create view vu_emp1
// 删除
drop view 视图名
</code></pre></div><p>可以利用视图对数据进行格式化</p> <p>不能更新视图里面带聚合函数的字段</p> <p>只有存在1对1的关系的数据才能更新</p> <p>看表约束</p> <p>JOIN 了  不支持delete ，insert</p> <p>主要是方便查询使用的，不建议更新，有可能会失败</p> <p><font style="color:#DF2A3F;">操作简单</font></p> <p><font style="color:#DF2A3F;">减少数据冗余</font></p> <p><font style="color:#DF2A3F;">数据安全</font></p> <p><font style="color:#DF2A3F;">灵活多变的需求</font></p> <p><font style="color:#DF2A3F;">分解复杂的查询逻辑</font></p> <p><font style="color:#DF2A3F;">视图和表息息相关，需要维护，可读性不好</font></p> <h2 id="触发器"><a href="#触发器" class="header-anchor">#</a> 触发器</h2> <ol><li>原子性 创建一个触发器，商品信息插入自动触发插入库存数据插入</li> <li>5.0 支持触发器  由事件（行为）触发  增删改 触发</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> 触发器名称
{BEFORE <span class="token operator">|</span> <span class="token keyword">AFTER</span> }{<span class="token keyword">INSERT</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> <span class="token operator">|</span> <span class="token keyword">DELETE</span> } <span class="token keyword">ON</span> 表面
<span class="token keyword">FOR EACH ROW</span>
触发器执行语句柄
单条<span class="token operator">/</span>多条  都可以  复合语句块<span class="token keyword">BEGIN</span> <span class="token keyword">END</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code>NEW 关键字  新插入的数据
SIGNAL SQLSTATE <span class="token string">'HY000'</span> <span class="token keyword">SET</span> MESSAGE_TEXT <span class="token operator">=</span> <span class="token string">'报错信息'</span>
OLD 关键字 老数据
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> TRIGGERS<span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">CREATE</span> <span class="token keyword">TRIGGER</span> 触发器名<span class="token punctuation">;</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>SELECT * FROM information_schema.TRIGGERS
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>DROP TRIGGER IF EXISTS 触发器名
</code></pre></div><h3 id="优点-数据完整性-记录日志-数据合法性进行校验"><a href="#优点-数据完整性-记录日志-数据合法性进行校验" class="header-anchor">#</a> 优点：数据完整性，记录日志，数据合法性进行校验</h3> <h3 id="缺点-可读性差-相关数据的变更可能会导致出错"><a href="#缺点-可读性差-相关数据的变更可能会导致出错" class="header-anchor">#</a> 缺点：可读性差，相关数据的变更可能会导致出错</h3> <p>外键不会触发触发器，比如删除父亲，影响儿子</p> <h2 id="存储过程"><a href="#存储过程" class="header-anchor">#</a> 存储过程</h2> <ol><li>参数类型  IN  参数 OUT  返回  INOUT</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code>CREATE PROCEDURE 存储过程名<span class="token punctuation">(</span>IN <span class="token operator">|</span> OUT <span class="token operator">|</span> INOUT 参数名  参数类型<span class="token punctuation">)</span>
<span class="token punctuation">[</span>characteristics<span class="token punctuation">]</span> 
BEGIN  一条可以省略


END
</code></pre></div><p>characteristics</p> <ol><li>LANGUAGE SQL   执行体是SQL</li> <li>NOT  DETRMINISTIC 是否确定执行的结果  随机数</li> <li>CONTAINS SQL  包含SQL    NO SQL 没有SQL   READS SQL DATA  包含读数据的SQL    MODIFIES  SQL DATA  包含写数据的SQL</li> <li>SQL SECURITY  {DEFINER | INVOKER}  DEFINER 默认有访问权限的用户可以用  INVOKER 创建者和定义者可以用</li> <li>COMMENT 'String'    注释信息</li></ol> <p>DELIMITER  指定什么什么结束  $</p> <p>DELIMITER ;  改回去</p> <h3 id="优点"><a href="#优点" class="header-anchor">#</a> 优点</h3> <ol><li>存储过程可以一次编译多次使用</li> <li>可以减少开发工作量</li> <li>连接一次即可，良好的封装性</li> <li>安全性比较强</li> <li>可以减少网络的数据传输量</li></ol> <h3 id="缺点"><a href="#缺点" class="header-anchor">#</a> 缺点</h3> <ol><li>可移植性差 不能跨库移植</li> <li>调试困难</li> <li>存储过程的版本管理很困难</li> <li>它不适合高并发的场景</li></ol> <h2 id="创建存储过程"><a href="#创建存储过程" class="header-anchor">#</a> 创建存储过程</h2> <div class="language-shell extra-class"><pre class="language-shell"><code> CREATE DATABASE dbtest15<span class="token punctuation">;</span>

 USE dbtest15<span class="token punctuation">;</span>

 CREATE TABLE employees
 AS 
 SELECT *
 FROM atguigugb.<span class="token variable"><span class="token variable">`</span>employees<span class="token variable">`</span></span>

  CREATE TABLE departments
 AS 
 SELECT *
 FROM atguigugb.<span class="token variable"><span class="token variable">`</span>departments<span class="token variable">`</span></span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span>  $

<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> select_all_data<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span>
		<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">END</span> $

<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div><p>调用  CALL select_all_data()</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span>  $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> avg_employee_salary<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">SELECT</span> <span class="token function">AVG</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span>  $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_min_salary<span class="token punctuation">(</span><span class="token keyword">OUT</span> ms   <span class="token keyword">DOUBLE</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">SELECT</span> <span class="token function">MIN</span><span class="token punctuation">(</span>salary<span class="token punctuation">)</span> <span class="token keyword">INTO</span> ms
<span class="token keyword">FROM</span> employees<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token keyword">CALL</span> show_min_salary<span class="token punctuation">(</span><span class="token variable">@ms</span><span class="token punctuation">)</span>

<span class="token keyword">SELECT</span> <span class="token variable">@ms</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span>  $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_someone_salary<span class="token punctuation">(</span><span class="token operator">IN</span> empname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">SELECT</span> salary
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> empname<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>

<span class="token keyword">CALL</span> show_someone_salary<span class="token punctuation">(</span><span class="token string">'Abel'</span><span class="token punctuation">)</span>

<span class="token keyword">SET</span> <span class="token variable">@empname</span> :<span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>

<span class="token keyword">CALL</span> show_someone_salary<span class="token punctuation">(</span><span class="token variable">@empname</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>@@系统变量       @ 用户自定义变量     :=  赋值符号</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">DELIMITER</span>  $
<span class="token keyword">CREATE</span> <span class="token keyword">PROCEDURE</span> show_someone_salary2<span class="token punctuation">(</span><span class="token operator">IN</span> empname <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">OUT</span> empsalary <span class="token keyword">decimal</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">BEGIN</span> 
<span class="token keyword">SELECT</span> salary <span class="token keyword">INTO</span> empsalary
<span class="token keyword">FROM</span> employees
<span class="token keyword">WHERE</span> last_name <span class="token operator">=</span> empname<span class="token punctuation">;</span>
<span class="token keyword">END</span> $
<span class="token keyword">DELIMITER</span> <span class="token punctuation">;</span>


<span class="token keyword">SET</span> <span class="token variable">@empname</span> :<span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">;</span>
<span class="token keyword">CALL</span> show_someone_salary2<span class="token punctuation">(</span><span class="token variable">@empname</span><span class="token punctuation">,</span><span class="token variable">@empsalary</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">SELECT</span> <span class="token variable">@empsalary</span><span class="token punctuation">;</span>
</code></pre></div><p>INOUT empname VARCHAR(25)   先后改变变量的值</p> <p>调试非常麻烦，逐步排错。</p> <h2 id="存储函数的使用"><a href="#存储函数的使用" class="header-anchor">#</a> 存储函数的使用</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>CREATE FUNCTION 函数名<span class="token punctuation">(</span>参数名 参数类型<span class="token punctuation">)</span>
RETURNS 返回值类型
<span class="token punctuation">[</span>characteristics<span class="token punctuation">]</span> 
BEGIN

函数体 肯定有return 语句

END

SEKECT 函数名（参数列表）
</code></pre></div><p>只有IN类型 （可省略不写）</p> <div class="language-shell extra-class"><pre class="language-shell"><code>DELIMITER  $
CREATE FUNCTION email_by_name<span class="token punctuation">(</span><span class="token punctuation">)</span>
RETURNS VARCHAR<span class="token punctuation">(</span><span class="token number">25</span><span class="token punctuation">)</span>
DETERMINISTIC
CONTAINS SQL
READS SQL DATA
BEGIN

RETURN<span class="token punctuation">(</span>SELECT email FROM employees WHERE last_name <span class="token operator">=</span> <span class="token string">'Abel'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

END $

DELIMITER <span class="token punctuation">;</span>
</code></pre></div><p>特性不加会报错</p> <div class="language-shell extra-class"><pre class="language-shell"><code>SET GLOBAL log_bin_trust_function_creators <span class="token operator">=</span> <span class="token number">1</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1709613629090-471f8775-591a-4835-aa85-1311c1230134.png" alt=""></p> <h2 id="存储过程和函数的查看、修改、删除"><a href="#存储过程和函数的查看、修改、删除" class="header-anchor">#</a> 存储过程和函数的查看、修改、删除</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>SHOW CREATE PROCEDURE 存储过程名
SHOW CREATE FUNCTION 函数名

// 查看存储过程/函数的状态  
SHOW PROCEDURE STATUS <span class="token punctuation">[</span>LIKE <span class="token string">'show_max_salary'</span><span class="token punctuation">]</span>
SHOW FUNCTION STATUS <span class="token punctuation">[</span>LIKE <span class="token string">'show_max_salary'</span><span class="token punctuation">]</span>

// 从information_schema.Routines表中查看存储过程和函数信息
SELECT * FROM information_schema.Routines
WHERE ROUTINE_NAME <span class="token operator">=</span> <span class="token string">'存储过程或者函数名'</span> AND ROUTINE_TYPE <span class="token operator">=</span> <span class="token string">'FUNCTION'</span> // FUNCTION 区分大小写
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>ALTER FUNCTION<span class="token operator">|</span>PROCEDURE 存储过程或者函数名 <span class="token punctuation">[</span>characteristics<span class="token punctuation">]</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>DROP FUNCTION IF EXISTS 函数名
DROP PROCEDURE IF EXISTS 函数名
</code></pre></div><ol><li>INTO  后面不要加括号 逗号拼接</li> <li>date_diff  相隔天数</li> <li>SET 给变量赋值</li></ol> <h2 id="变量"><a href="#变量" class="header-anchor">#</a> 变量</h2> <p>存储查询或计算的中间结果，或者输出最终的结果数据。</p> <p>系统变量和用户自定义变量</p> <h3 id="系统变量-重启失效"><a href="#系统变量-重启失效" class="header-anchor">#</a> 系统变量(重启失效)</h3> <p>服务器，编译MySQL时参数，配置文件</p> <p><a href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html" target="_blank" rel="noopener noreferrer">查看系统变量<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>全局 global   max_connections 最大连接数</p> <p>会话 session  默认</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1709776572883-a26b7caa-239d-4260-88d1-c12c7125448b.png" alt=""></p> <p>character_set_client  设置字符集  变量的作用域只能时会话级别的还是全局级别的</p> <p>pseudo_thread_id  标记当前会话的Mysql连接id</p> <div class="language-shell extra-class"><pre class="language-shell"><code>// 查看所有或部分系统变量
SHOW GLOBAL VARIABLES<span class="token punctuation">;</span>
// 查看会话系统变量
SHOW <span class="token environment constant">SESSION</span> VARIABLES<span class="token punctuation">;</span> 或者 SHOW VARIABLES<span class="token punctuation">;</span>

SHOW GLOBAL VARIABLES LIKE <span class="token string">''</span><span class="token punctuation">;</span>

SHOW GLOBAL <span class="token environment constant">SESSION</span> LIKE <span class="token string">''</span><span class="token punctuation">;</span>

// 查看指定的全局系统变量
SELECT @@global.max_connections<span class="token punctuation">;</span>
// 查看指定的会话系统变量
SELECT @@session.max_connections<span class="token punctuation">;</span>

// 修改系统变量  配置文件my.ini   
SET @@global.max_connections <span class="token operator">=</span> <span class="token number">161</span><span class="token punctuation">;</span>//重启失效
SET GLOBAL max_connections <span class="token operator">=</span> <span class="token number">171</span><span class="token punctuation">;</span>

// 会话系统变量
SET @@session.character_set_client <span class="token operator">=</span> <span class="token string">'gbk'</span><span class="token punctuation">;</span>
SET <span class="token environment constant">SESSION</span> character_set_client <span class="token operator">=</span> <span class="token string">'gbk'</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="用户变量"><a href="#用户变量" class="header-anchor">#</a> 用户变量</h3> <p>会话用户变量和局部变量</p> <ul><li>会话用户变量  当前连接生效  @ 开头</li> <li>局部变量        存储过程和函数</li></ul> <div class="language-shell extra-class"><pre class="language-shell"><code>// 定义和赋值
SET @用户变量 <span class="token operator">=</span> 值<span class="token punctuation">;</span>
SET @用户变量 ：<span class="token operator">=</span> 值<span class="token punctuation">;</span>
SELECT @用户变量 :<span class="token operator">=</span> 表达式<span class="token punctuation">[</span>FROM 等子句<span class="token punctuation">]</span>
SELECT 表达式 INTO @用户变量 <span class="token punctuation">[</span>FROM 等子句<span class="token punctuation">]</span>

// 查看
SELECT @用户变量<span class="token punctuation">;</span>

// 局部变量 定义 DECLARE 声名 DECLARE 必须在BEGIN 中的首行,顺序往下排
DECLARE 变量名 类型 <span class="token punctuation">[</span>default值<span class="token punctuation">]</span> 可以合并
DECLARE a,b INT DEFAULT <span class="token number">0</span><span class="token punctuation">;</span>

// 使用差不多
SET 变量名 <span class="token operator">=</span> 值<span class="token punctuation">;</span>
SET 变量名 ：<span class="token operator">=</span> 值<span class="token punctuation">;</span>
 
SELECT 表达式 INTO 变量名 <span class="token punctuation">[</span>FROM 等子句<span class="token punctuation">]</span>

// 使用
SELECT a,b,c<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1709880343026-477058ac-f7e1-4af7-bfcd-4aa9efb04443.png" alt=""></p> <h2 id="程序出错的处理机制"><a href="#程序出错的处理机制" class="header-anchor">#</a> 程序出错的处理机制</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1710816698802-6d4bc893-d097-4cdc-a26a-e4c683c1a961.png" alt=""></p> <p>1048 是MySQL_error_code   数值类型错误码</p> <p>23000 是sqlstate_value 是长度为5的字符串类型错误代码</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code>DECLARE 错误名称 CONDITION FOR 错误码（错误条件）
DECLARE Field_Not_Be_NULL CONDITION FOR 1048;
DECLARE Field_Not_Be_NULL CONDITION FOR SQLSTATE '23000';
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code>DECLARE 处理方式 HANDLER FOR 错误类型 处理语句
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1710817987972-766a231e-23e1-4fc3-ab8f-d96d53aad5de.png" alt=""></p> <h2 id="条件判断语句"><a href="#条件判断语句" class="header-anchor">#</a> 条件判断语句</h2> <div class="language-shell extra-class"><pre class="language-shell"><code>IF 表达式1 THEN 操作1
<span class="token punctuation">[</span>ELSEIF 表达式2 THEN 操作2<span class="token punctuation">]</span>
<span class="token punctuation">[</span>ELSE 操作N<span class="token punctuation">]</span> 这个可以没有
END IF
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>CASE 表达式
WHEN 值1 THEN 结果1或语句1<span class="token punctuation">(</span>如果是语句需要加分号<span class="token punctuation">)</span>
WHEN 值2 THEN 结果2或语句2<span class="token punctuation">(</span>如果是语句需要加分号<span class="token punctuation">)</span>

ELSE  结果n或语句n<span class="token punctuation">(</span>如果是语句需要加分号<span class="token punctuation">)</span>
END <span class="token punctuation">[</span>case<span class="token punctuation">]</span> <span class="token punctuation">(</span>如果是放在begin end中需要加上case，如果放在select后面不需要<span class="token punctuation">)</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>CASE 表达式
WHEN 条件1 THEN 结果1或语句1<span class="token punctuation">(</span>如果是语句需要加分号<span class="token punctuation">)</span>
WHEN 条件2 THEN 结果2或语句2<span class="token punctuation">(</span>如果是语句需要加分号<span class="token punctuation">)</span>

ELSE  结果n或语句n<span class="token punctuation">(</span>如果是语句需要加分号<span class="token punctuation">)</span>
END <span class="token punctuation">[</span>case<span class="token punctuation">]</span> <span class="token punctuation">(</span>如果是放在begin end中需要加上case，如果放在select后面不需要<span class="token punctuation">)</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># LEAVE 跳出循环 [标签名]</span>
标签名 <span class="token keyword">LOOP</span> 
循环执行的语句
<span class="token keyword">END</span> <span class="token keyword">LOOP</span> 标签名

<span class="token keyword">call</span> 存储函数名<span class="token punctuation">(</span>@参数名<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code>标签名 <span class="token keyword">WHILE</span> 循环条件 <span class="token keyword">DO</span>
循环执行的语句
<span class="token keyword">END</span> <span class="token keyword">WHILE</span> <span class="token punctuation">[</span>标签名<span class="token punctuation">]</span>

<span class="token number">1.</span> 初始化条件
<span class="token number">2.</span> 循环条件
<span class="token number">3.</span> 循环体
<span class="token number">4.</span> 迭代条件

<span class="token keyword">DROP</span> 存储过程名 后面没有括号

循环条件 <span class="token boolean">TRUE</span> 不做限制
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code>标签名 <span class="token keyword">REPEAT</span> 
循环执行的语句
UNTIL 结束循环的条件表达式
<span class="token keyword">END</span> <span class="token keyword">REPEAT</span> <span class="token punctuation">[</span>标签名<span class="token punctuation">]</span>

类似<span class="token keyword">do</span> <span class="token keyword">while</span> 先执行一次  至少执行一次
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1710949514702-68b95308-0525-437f-9a0e-deaecd93e929.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>LEAVE 标签名  
相当于break
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>ITERATE 标签名
相当于continue<span class="token punctuation">;</span> 
</code></pre></div><h2 id="游标"><a href="#游标" class="header-anchor">#</a> 游标</h2> <p>随意定位到某一条记录，面向过程的能力，指针，变量声明的后面</p> <div class="language-shell extra-class"><pre class="language-shell"><code>DECLARE 游标名 CURSOR FOR 查询语句
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>DECLARE 游标名 CURSOR IS 查询语句
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>OPEN 游标名
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>FETCH 游标名 INTO 变量名
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>CLOSE 游标名
</code></pre></div><p>会加锁，消耗系统资源。</p> <h2 id="mysql8-0-全局变量的持久化"><a href="#mysql8-0-全局变量的持久化" class="header-anchor">#</a> MySQL8.0 全局变量的持久化</h2> <p>set persist 设置全局变量</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1711444372722-a23033b1-3e33-44a7-97a7-ad25d1630778.png" alt=""></p> <h2 id="窗口函数"><a href="#窗口函数" class="header-anchor">#</a> 窗口函数</h2> <ol><li>更简单支持NoSQL,不依赖chema</li> <li>隐藏索引/降序索引</li> <li>JSON支持更完善 增加了聚合函数</li> <li>安全和账户管理  sha2 插件</li> <li>Innodb 优化</li> <li>事务数据字典</li> <li>原子数据定义语句</li> <li>资源管理 分配合理</li> <li>字符集 utf8mb4 之前是latin1</li> <li>优化器增强</li> <li>公用表表达式  替换子查询</li> <li>窗口函数</li> <li>正则表达式 优化</li> <li>内部临时表</li> <li>日志记录 过滤和写入</li> <li>备份锁</li> <li>增强Mysql复制  二进制节省空间</li> <li>去掉查询缓存  命中率太低了</li> <li>只保留 AES_ENCRYPT 和 AES_DECRYPT</li> <li>\N 不再是NULL</li></ol> <h2 id="窗口函数-将结果置于每一条数据记录中"><a href="#窗口函数-将结果置于每一条数据记录中" class="header-anchor">#</a> 窗口函数（将结果置于每一条数据记录中）</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1711696711952-3a779fa4-2348-49ea-91ca-3bd5004a09a1.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">CREATE</span> <span class="token keyword">TEMPORARY</span> <span class="token keyword">TABLE</span> 表名  后面是查询语句
</code></pre></div><p><font style="color:#DF2A3F;">分组统计，对每一天记录进行计算。   对分区数据进行统计和分析  不改变原来的数据</font></p> <ol><li>静态窗口：窗口大小固定，不会随着记录的不同而不同</li> <li>动态窗口:  窗口大小不固定，随着记录的不同而不同</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>函数 <span class="token keyword">OVER</span><span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> 字段名 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段名 ASE<span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">)</span>
函数 <span class="token keyword">OVER</span> 窗口名 WINDOW 窗口名 <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">PARTITION</span> <span class="token keyword">BY</span> 字段名 <span class="token keyword">ORDER</span> <span class="token keyword">BY</span> 字段名 ASE<span class="token operator">|</span><span class="token keyword">DESC</span><span class="token punctuation">)</span>  简洁写法
</code></pre></div><p>OVER 窗口范围</p> <p>PARTITION BY 分组字段 可以省略</p> <p>ORDER BY  排序字段</p> <p>FRAME 子句 定义规则，滑动窗口</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1711697480212-21807301-0f7e-41fc-af94-8cb572371013.png" alt=""></p> <ul><li>ROW_NUMBER()  行号</li> <li>RANK() 排序字段一样 行号则一样，跳过重复编号</li> <li>DENSE_RANK() 排序字段一样 行号则一样，不跳过重复编号</li> <li>PERCENT_RANK() 等级值百分比  rank-1/rows-1  rank 序号数  rows 总记录数</li> <li>CUME_DIST()  函数  小于或者等于的比例</li> <li>LAG（expr，n）前n个值   LAG（price，1）</li> <li>LEAD（expr，n）后n行值</li> <li>FIRST_VALUE(expr)  第一个值</li> <li>lAST_VALUE(expr) 最后一个值</li> <li>NTH_VALUE(expr)  指定第一个的值</li> <li>NTILE（n）分几组  尽量均分，均分不了，前面多</li></ul> <h2 id="公用表表达式"><a href="#公用表表达式" class="header-anchor">#</a> 公用表表达式</h2> <p>可以复用的子查询</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WITH</span> CTE名称
<span class="token keyword">AS</span> <span class="token punctuation">(</span>子查询<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">|</span> <span class="token keyword">DELETE</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> 语句
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">WITH</span> RECURSIVE
<span class="token keyword">AS</span> <span class="token punctuation">(</span>子查询<span class="token punctuation">)</span>
<span class="token keyword">SELECT</span> <span class="token operator">|</span> <span class="token keyword">DELETE</span> <span class="token operator">|</span> <span class="token keyword">UPDATE</span> 语句
</code></pre></div><p>替代子查询，多次被引用</p> <h2 id="mysql优化"><a href="#mysql优化" class="header-anchor">#</a> mysql优化</h2> <h2 id="suo-yisuoyi克隆虚拟机"><a href="#suo-yisuoyi克隆虚拟机" class="header-anchor">#</a> suo'yisuoyi克隆虚拟机</h2> <ol><li>修改mac地址  右键虚拟机，找到mac地址点生成</li> <li>主机名</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>vim <span class="token operator">/</span>etc<span class="token operator">/</span>hostname
reboot <span class="token comment"># 重启虚拟机</span>
</code></pre></div><ol start="3"><li>ip地址  动态ip 不需要修改</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>vim <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>network<span class="token operator">-</span>scripts<span class="token operator">/</span>ifcfg<span class="token operator">-</span>ens33
systemctl restart network
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1711951126435-414b6a4a-791b-4fc6-9e66-ca190ac4a2ed.png" alt=""></p> <ol start="4"><li>UUID 调整</li></ol> <h2 id="centos6-和-centos7-的区别"><a href="#centos6-和-centos7-的区别" class="header-anchor">#</a> centos6 和 centos7 的区别</h2> <ol><li>6是iptables   7是firewalld</li> <li>启动服务 6是service   7是systemctl</li></ol> <h2 id="mysql卸载的一些命令"><a href="#mysql卸载的一些命令" class="header-anchor">#</a> mysql卸载的一些命令</h2> <p>rpm安装</p> <div class="language-sql extra-class"><pre class="language-sql"><code>rpm <span class="token operator">-</span>qa <span class="token operator">|</span> grep <span class="token operator">-</span>i mysql <span class="token comment"># -i 忽略大小写</span>
sytemctl <span class="token keyword">status</span> mysqld<span class="token punctuation">.</span>service <span class="token comment"># 查看运行状态</span>
sytemctl stop mysqld<span class="token punctuation">.</span>service <span class="token comment"># 停止运行状态</span>
yum remove 查看到的包名
find <span class="token operator">/</span> <span class="token operator">-</span>name mysql <span class="token comment"># 全局搜索mysql</span>
最后删除etc下面的my<span class="token punctuation">.</span>cnf
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712051120057-0b915df7-af5d-4a8b-8a48-6b84bce3be56.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712051341148-6e61578e-3d3e-4f42-9498-cf08a1866a89.png" alt="">\</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712051432028-264f670a-485a-4b95-a167-14247236a23c.png" alt=""> 有依赖顺序</p> <div class="language-sql extra-class"><pre class="language-sql"><code>rpm <span class="token operator">-</span>ivh  i 是install  v 是提示信息  h <span class="token keyword">hash</span> 进度条
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code>cat <span class="token operator">/</span>var<span class="token operator">/</span>log<span class="token operator">/</span>mysqld<span class="token punctuation">.</span>log
systemctl <span class="token keyword">enable</span> mysqld <span class="token comment"># 开机自启</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'root'</span><span class="token variable">@'localhost'</span> identified <span class="token keyword">by</span> <span class="token string">'abc123'</span> <span class="token comment">#8.0</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token string">'root'</span><span class="token variable">@'%'</span> INDENTIFIED <span class="token keyword">WITH</span> mysql_native_password <span class="token keyword">By</span> <span class="token string">'新密码'</span>
</code></pre></div><p>mysql8.0 校验密码插件</p> <div class="language-sql extra-class"><pre class="language-sql"><code>install plugin validate_password <span class="token keyword">SONAME</span> <span class="token string">'validate_password.so'</span>
</code></pre></div><h2 id="字符集-charset"><a href="#字符集-charset" class="header-anchor">#</a> 字符集（CHARSET）</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%character%'</span><span class="token punctuation">;</span>
character_set_server<span class="token operator">=</span>utf8  <span class="token comment"># 设置字符集 在my.cnf</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> 表名
表的字符集都和数据库保持一致
<span class="token keyword">alter</span> <span class="token keyword">database</span> dbtest1 <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token string">'utf8'</span>   数据库字符集修改
<span class="token keyword">alter</span> <span class="token keyword">table</span> 表名 <span class="token keyword">convert</span> <span class="token keyword">to</span> <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token string">'utf8'</span>  表字符集修改
保证数据是可改的
</code></pre></div><ol><li>服务器级别</li> <li>数据库级别</li> <li>表级别</li> <li>列级别</li></ol> <p>uft8 3个字节   utf8mb4  4个字节</p> <h2 id="比较规则-collate"><a href="#比较规则-collate" class="header-anchor">#</a> 比较规则（COLLATE）</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SHOW</span> <span class="token keyword">CHARSET</span><span class="token punctuation">;</span>
</code></pre></div><p>比较大小，排序操作</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712218783325-2f1f6715-22b5-48dd-890c-718ab0e6ff13.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712218834947-6583fb64-c739-4e95-8e27-8e1ecb2edf0c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712219064419-051af4b5-da5f-4610-8678-3957c54f4e9e.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> <span class="token keyword">table</span> <span class="token keyword">status</span> <span class="token keyword">from</span> 表名 
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712219307702-55fe04e1-0e8c-4794-be39-99dc52d50b3a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712219419101-0d1d577b-8b29-450d-b34f-96687310d2a3.png" alt=""></p> <p>只要保证发送的和client 一样   返回的和results 一样就行</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">set</span> names utf8<span class="token punctuation">;</span> <span class="token comment"># 三个都设置成一样的</span>
<span class="token punctuation">[</span>client<span class="token punctuation">]</span>
<span class="token keyword">default</span><span class="token operator">-</span><span class="token keyword">character</span><span class="token operator">-</span><span class="token keyword">set</span><span class="token operator">=</span>utf8 <span class="token comment"># 配置文件里面</span>
</code></pre></div><h2 id="sql大小写规范"><a href="#sql大小写规范" class="header-anchor">#</a> SQL大小写规范</h2> <p>windows系统默认大小写不敏感</p> <p>linux系统默认大小写敏感</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'%lower_case_table_name%'</span><span class="token punctuation">;</span>
<span class="token number">0</span> 大小写敏感  <span class="token number">1</span>大小写不敏感   <span class="token number">2</span> 只有查找是小写
</code></pre></div><ol><li>数据库名，表名，表的别名，变量名区分</li> <li>关键字和函数不区分</li> <li>列和列的别名不区分</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code>lower_case_table_name<span class="token operator">=</span><span class="token number">1</span>
</code></pre></div><p>mysql 8 要先删除数据/var/lib/mysql</p> <h3 id="建议"><a href="#建议" class="header-anchor">#</a> 建议</h3> <ol><li>关键字，函数名大写</li> <li>数据库名，表名，表别名，字段名，字段别名小写</li> <li>SQL语句分号结束</li></ol> <h2 id="sql-mode-合理设置"><a href="#sql-mode-合理设置" class="header-anchor">#</a> sql_mode 合理设置</h2> <p>sql语法，数据验证检查</p> <p>5.7 宽松模式</p> <p>8.0 严格模式 不允许零日期 0000-00-00 00:00:00</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@session.sql_mode</span><span class="token punctuation">;</span>

<span class="token keyword">SET</span> <span class="token keyword">SESSION</span> sql_mode <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span> <span class="token comment"># 清空</span>

</code></pre></div><p>临时设置和永久设置   在my.ini</p> <div class="language-sql extra-class"><pre class="language-sql"><code>sql_mode<span class="token operator">=</span>ONLY_FULL_GROUP_BY<span class="token punctuation">,</span>STRICT_TRANS_TABLES<span class="token punctuation">,</span>NO_ZERO_IN_DATE<span class="token punctuation">,</span>NO_ZERO_DATE<span class="token punctuation">,</span>ERROR_FOR_DIVISION_BY_ZERO<span class="token punctuation">,</span>NO_ENGINE_SUBSTITUTION
</code></pre></div><h2 id="mysql数据目录"><a href="#mysql数据目录" class="header-anchor">#</a> MYSQL数据目录</h2> <p>表ibd 格式</p> <p>bin目录 可执行文件</p> <p>linux 下不一样</p> <ol><li>数据目录  /var/lib/mysql</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'datadir'</span><span class="token punctuation">;</span>
</code></pre></div><ol start="2"><li>相关命令 /usr/bin 或者 /usr/sbin  客户端程序和服务端程序的命令</li> <li>配置文件 /usr/share/mysql-8.0 或 /etc/my.cnf</li> <li>存储引擎 把表存在磁盘上</li></ol> <h3 id="默认数据库"><a href="#默认数据库" class="header-anchor">#</a> 默认数据库</h3> <ol><li>mysql 用户账户和权限信息</li> <li>information_schema  维护其他数据库的信息  表，视图，触发器，列，索引</li> <li>performance_schema 服务的各类性能指标</li> <li>sys 监控mysql性能，视图描述</li></ol> <h3 id="_5-5-7-5-6-8-表数据"><a href="#_5-5-7-5-6-8-表数据" class="header-anchor">#</a> 5.5.7~5.6.8 表数据</h3> <ol><li>ibdata1 系统表空间  或者 ibd 独立表空间</li> <li>db.opt 是字符集或者关联关系   frm 表结构信息</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token punctuation">[</span>server<span class="token punctuation">]</span>
innodb_file_per_table<span class="token operator">=</span><span class="token number">0</span>   <span class="token number">0</span>系统表空间  <span class="token number">1</span> 独立表空间
</code></pre></div><h3 id="_8-0-表数据"><a href="#_8-0-表数据" class="header-anchor">#</a> 8.0 表数据</h3> <ol><li>表结构和表数据合一  只有ibd 方便关联</li></ol> <p>证明：ibd2sdi 工具</p> <div class="language-sql extra-class"><pre class="language-sql"><code>ibd2sdi <span class="token comment">--dump-file=文件.txt 文件.ibd</span>
</code></pre></div><p>视图只有frm</p> <h3 id="_5-7-myisam"><a href="#_5-7-myisam" class="header-anchor">#</a> 5.7 MyISAM</h3> <ol><li>frm  MYD MYI  数据和索引分开存储</li></ol> <h3 id="_8-0-myisam"><a href="#_8-0-myisam" class="header-anchor">#</a> 8.0 MyISAM</h3> <ol><li>sdi MYD MYI  数据和索引分开存储</li></ol> <h2 id="用户与权限关联"><a href="#用户与权限关联" class="header-anchor">#</a> 用户与权限关联</h2> <p>root用户创建普通用户，保证安全性。</p> <div class="language-sql extra-class"><pre class="language-sql"><code>mysql <span class="token operator">-</span>h 主机地址 <span class="token operator">-</span>P <span class="token number">3306</span> <span class="token operator">-</span>p 密码 数据库 <span class="token operator">-</span>e <span class="token string">&quot;sql语句&quot;</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> <span class="token keyword">user</span> <span class="token string">'用户名'</span> identified <span class="token keyword">by</span> <span class="token string">'密码'</span><span class="token punctuation">;</span>
<span class="token keyword">user</span> 和 host 作为联合主键
权限有限
<span class="token keyword">update</span> <span class="token keyword">user</span> <span class="token keyword">set</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'用户名'</span> <span class="token keyword">where</span> <span class="token keyword">user</span> <span class="token operator">=</span> <span class="token string">'用户名'</span><span class="token punctuation">;</span>
flush <span class="token keyword">privileges</span><span class="token punctuation">;</span>
<span class="token keyword">drop</span> <span class="token keyword">user</span> <span class="token string">'用户名'</span><span class="token punctuation">;</span> <span class="token comment"># 不需要flush</span>
@ 用于指定host的用户
不推荐使用<span class="token keyword">delete</span>，容易有残留
</code></pre></div><h2 id="密码"><a href="#密码" class="header-anchor">#</a> 密码</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> PASSWORD<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 8.0 不支持</span>
</code></pre></div><div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token keyword">user</span><span class="token punctuation">(</span><span class="token punctuation">)</span> identified <span class="token keyword">by</span> <span class="token string">'新密码'</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> PASSWORD <span class="token operator">=</span> <span class="token string">'新密码'</span><span class="token punctuation">;</span>
<span class="token keyword">alter</span> <span class="token keyword">user</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span> identified <span class="token keyword">by</span> <span class="token string">'新密码'</span><span class="token punctuation">;</span> <span class="token comment"># DDL操作</span>
<span class="token keyword">SET</span> PASSWORD <span class="token keyword">FOR</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span><span class="token operator">=</span> <span class="token string">'新密码'</span><span class="token punctuation">;</span>
</code></pre></div><p>8.0</p> <ol><li>密码过期</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">ALTER</span> <span class="token keyword">USER</span> <span class="token keyword">user</span> PASSWORD EXPIRE<span class="token punctuation">;</span> <span class="token comment"># 过期能登录，不能查询</span>
<span class="token comment"># 配置文件</span>
default_password_lifetime <span class="token operator">=</span> <span class="token number">0</span>  不过期  N单位天
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712477060525-9ae30b68-2a65-4ed6-9078-f71f24e3b4ac.png" alt=""></p> <ol start="2"><li>密码重用设置</li></ol> <p>数量和时间指定</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">SET</span> PERSIST password_history <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment"># 6次</span>
<span class="token keyword">SET</span> PERSIST password_reuse_interval <span class="token operator">=</span> <span class="token number">365</span><span class="token punctuation">;</span>  一年
</code></pre></div><ol start="3"><li>密码强度评估</li></ol> <h2 id="权限管理"><a href="#权限管理" class="header-anchor">#</a> 权限管理</h2> <p>分内的事  创建的用户没有给别人赋予权限的能力 如需要 添加WITH GRANT OPTION</p> <p>权限：表，列，过程</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712477453001-b1ecb9a5-1541-4de8-b019-dafa9891bb56.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712477472382-b489f173-bc93-48b9-bdb2-bc7330c0d55d.png" alt=""></p> <p>授予权限2种</p> <ol><li>授予角色权限，再授予角色</li> <li>直接授予用户</li></ol> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">grant</span> <span class="token keyword">select</span><span class="token punctuation">,</span><span class="token keyword">update</span> <span class="token keyword">on</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span><span class="token punctuation">;</span>
<span class="token keyword">grant</span> <span class="token keyword">delete</span> <span class="token keyword">on</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span><span class="token punctuation">;</span> 权限叠加
<span class="token keyword">grant</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">on</span> <span class="token operator">*</span><span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span><span class="token punctuation">;</span> <span class="token comment"># 所有权限</span>
<span class="token keyword">show</span> grants<span class="token punctuation">;</span>
<span class="token keyword">show</span> grants <span class="token keyword">for</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span><span class="token punctuation">;</span>
<span class="token keyword">REVOKE</span> 权限 <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">'用户名'</span><span class="token variable">@'host'</span><span class="token punctuation">;</span>
</code></pre></div><p>横向 能看见哪个表</p> <p>纵向  能操作哪个表</p> <h3 id="权限表"><a href="#权限表" class="header-anchor">#</a> 权限表</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712541703043-aff9074c-6686-47c9-91d4-4f6555e6ec0c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712541824684-a2a4f6c4-1eca-4f7c-90cc-073101d6ed14.png" alt=""></p> <h2 id="角色管理-mysql8-0"><a href="#角色管理-mysql8-0" class="header-anchor">#</a> 角色管理（mysql8.0）</h2> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">create</span> ROLE <span class="token string">'角色名'</span><span class="token variable">@'%'</span> 默认为<span class="token operator">%</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> 权限 <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'角色名'</span><span class="token punctuation">;</span>
<span class="token keyword">GRANT</span> <span class="token keyword">all</span> <span class="token keyword">privileges</span> <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">to</span> <span class="token string">'角色名'</span><span class="token punctuation">;</span>
<span class="token keyword">SHOW</span> GRANTS <span class="token keyword">for</span> <span class="token string">'角色名'</span><span class="token punctuation">;</span>
<span class="token keyword">REVOKE</span> 权限 <span class="token keyword">ON</span> 数据库名<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token string">'角色名'</span><span class="token punctuation">;</span>
<span class="token keyword">DROP</span> ROLE <span class="token string">'角色名'</span><span class="token punctuation">;</span>

<span class="token keyword">GRANT</span> <span class="token string">'角色名'</span> <span class="token keyword">TO</span> <span class="token string">'用户名'</span><span class="token punctuation">;</span> <span class="token comment"># 需要激活</span>
<span class="token keyword">SELECT</span> CURRENT_ROLE<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment"># 查看</span>
<span class="token keyword">SET</span> <span class="token keyword">default</span> role <span class="token string">'角色名'</span> <span class="token keyword">TO</span> <span class="token string">'用户名'</span><span class="token punctuation">;</span> <span class="token comment"># 激活 需要退出</span>

<span class="token keyword">SET</span> <span class="token keyword">GLOBAL</span> activate_all_roles_on_login<span class="token operator">=</span><span class="token keyword">ON</span> <span class="token comment"># 设置所有角色登陆自动激活</span>

<span class="token keyword">REVOKE</span> <span class="token string">'角色名'</span> <span class="token keyword">FROM</span> <span class="token string">'用户名'</span><span class="token punctuation">;</span> <span class="token comment"># 回收角色，需要退出</span>

<span class="token comment"># 强制角色 不能回收或者删除</span>
<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
mandatory_roles <span class="token operator">=</span> <span class="token string">'角色名'</span>
</code></pre></div><h2 id="配置文件"><a href="#配置文件" class="header-anchor">#</a> 配置文件</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712559273296-f1f675aa-7239-40d5-a600-9beee2ef806a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712559283785-8cc95848-f476-48f8-a2c8-89c9ec26d582.png" alt=""></p> <p>最后声明生效，如果配置一样，命令行大于启动命令</p> <h2 id="逻辑架构"><a href="#逻辑架构" class="header-anchor">#</a> 逻辑架构</h2> <ol><li>服务端程序使用mysqld</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712559667881-77d21c87-3e7f-4bab-a7a9-9a647decc2cb.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712560575732-de53e24b-9f31-4c97-8ce4-3ca5ff2011f6.png" alt=""></p> <p>连接池分TCP连接池和线程连接池，TCP连接池控制连接数，线程连接池用来做认证和授权，长连接模式复用TCP连接</p> <p>解析器，生成语法树</p> <p>优化器，生成执行计划，计算成本，选取，投影，连接</p> <p>查询缓存，8.0去掉了</p> <p>引擎，负责了mysql中的数据进行提取和存储，对物理服务器的底层进行操作。show engines；</p> <h2 id="sql执行流程"><a href="#sql执行流程" class="header-anchor">#</a> SQL执行流程</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712561444535-4eac1f70-61d9-4ebb-9519-b822e2c83bdc.png" alt=""></p> <p><font style="color:#DF2A3F;">查询缓存 </font> key-value 形式存于内存  鸡肋  命中率低  必须完全相同操作才能命中缓存。</p> <ol><li>now函数不缓存</li> <li>更新压力大，最好在静态表中，极少更新  query_cache_type=2  按需使用</li> <li>SQL_NO_CACHE 不查询缓存</li></ol> <div class="language-java extra-class"><pre class="language-java"><code>show status like '<span class="token operator">%</span><span class="token class-name">Qcache</span><span class="token operator">%</span>'<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712590057771-d576e789-a43a-413a-8fbe-6230ebde495c.png" alt=""></p> <p><font style="color:#DF2A3F;">解析器 </font>  词法分析，语法分析</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712590222921-ab0b394a-48d2-4d9a-b0b3-2d5839c08b75.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712590374023-458ad564-f58e-43f8-a933-a5721b9689e3.png" alt=""></p> <p><font style="color:#DF2A3F;">优化器  </font> 确定SQL语句的执行路径  全表检索   索引检索    选择最好的执行计划</p> <p>逻辑优化  等价变换</p> <p>物理优化  索引 表连接方式</p> <p><font style="color:#DF2A3F;">执行器 </font>判断是否有权限   调用存储引擎API</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712590792660-fbf594c4-05b4-455f-a090-a4f655b29511.png" alt=""></p> <h2 id="执行原理-区别就是有没有查询缓存"><a href="#执行原理-区别就是有没有查询缓存" class="header-anchor">#</a> 执行原理（区别就是有没有查询缓存）</h2> <p>开启profiling 默认不执行</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">select</span> @<span class="token variable">@profiling</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> @<span class="token variable">@SESSION.profiling</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> profiling <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">show</span> profiles<span class="token punctuation">;</span> <span class="token comment"># 全部的</span>
<span class="token keyword">show</span> profile profilefile<span class="token punctuation">;</span> <span class="token comment"># 最近的</span>
<span class="token keyword">show</span> profile <span class="token keyword">for</span> query <span class="token number">6</span><span class="token punctuation">;</span>  <span class="token comment"># 指定某次</span>
<span class="token keyword">show</span> profile cpu<span class="token punctuation">,</span>block io <span class="token keyword">for</span> query <span class="token number">6</span><span class="token punctuation">;</span> <span class="token comment"># 指定某次 cpu和iO的开销</span>
</code></pre></div><h2 id="oracle-sql执行流程"><a href="#oracle-sql执行流程" class="header-anchor">#</a> oracle SQL执行流程</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712591981146-4b012563-392b-453a-9c86-09a237aa397d.png" alt=""></p> <p>缓存了执行计划，和mysql不一样，数据字典缓冲区，绑定变量来提高命中率，sql优化比较困难</p> <p>Innodb存储引擎是以页为单位管理存储空间，占用内存来作为数据缓冲池，减少硬盘IO</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712592476661-1da7c885-4810-43e0-8b80-926f26f47ddf.png" alt=""></p> <p>会对频次高的热数据进行加载，每次都是完整的页加载，预定去多加载前后页</p> <h3 id="缓冲池读取数据"><a href="#缓冲池读取数据" class="header-anchor">#</a> 缓冲池读取数据</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712592618377-776cfdeb-e35a-4a57-acd6-3b83c7ac2f2c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712592736695-bd29adfd-18e2-479e-9b50-283ecc319122.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_buffer_pool_size'</span><span class="token punctuation">;</span> <span class="token comment">// 8.0 查看缓存池大小</span>
<span class="token keyword">SET</span> <span class="token keyword">global</span> <span class="token keyword">innodb</span> innodb_buffer_pool_size <span class="token operator">=</span> <span class="token number">268435456</span><span class="token punctuation">;</span> <span class="token comment">// 设置缓存池大小</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712592962178-f4c71e86-b644-4460-b88a-9d7b0217912a.png" alt=""></p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'innodb_buffer_pool_instances'</span><span class="token punctuation">;</span> <span class="token comment">// 数据缓存池实例  多个人就会分区降低了性能</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712593069291-3c779967-baa1-469b-98f3-5d3fa3872677.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712593130306-2d621faa-d594-4427-87d7-f4efb3308ddb.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712593308858-18fd318a-3db4-4d40-845f-2a45b1535971.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712593386248-add15b4f-8bbf-4e46-9404-5872753b25cf.png" alt=""></p> <h2 id="存储引擎"><a href="#存储引擎" class="header-anchor">#</a> 存储引擎</h2> <p>存储引擎就是指<font style="color:#DF2A3F;">表的类型</font>，表处理器，不同存储引擎，文件的结构不一样</p> <p>接收指令，对表的数据进行提取和写入</p> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token keyword">show</span> engines<span class="token punctuation">;</span> <span class="token comment"># 支持的引擎   8.0 默认innodb  XA 分布式事务  Savepoints 保存点 部分事务回滚</span>
<span class="token keyword">show</span> @<span class="token variable">@default_storage_engine</span><span class="token punctuation">;</span> <span class="token comment"># 查看默认的存储引擎  5.5 之后改成innodb  </span>
<span class="token keyword">SET</span> default_storage_engine<span class="token operator">=</span>MyISAM<span class="token punctuation">;</span> <span class="token comment"># 临时修改</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712629420929-ce76c904-cf17-4592-9c03-691f5bafcf68.png" alt=""> 修改配置文件</p> <p>innodb 支持外键，支持事务，行级锁，崩溃恢复功能，适用于更新和删除 ，适用于巨大数据量，效率差一些，内存要求高，索引即数据，8.0都在ibd中</p> <p>MyISAM 5.5 不支持外键，不支持事务，适用于新增和查询，适用于小数据量，表锁，数据统计有额外的常数存储，查询效率很高。</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712630880588-d48fd291-9f21-4dc2-984d-ef3b33f92ee9.png" alt=""></p> <p>阿里巴巴，淘宝 Xtradb   性能更好 替代了innodb</p> <p><font style="color:#DF2A3F;">Archive</font> 数据存档  插入之后不能修改，只能插入和查询，支持索引，行级锁。AUTO_INCREMENT,ZLib压缩库</p> <p>.ARZ文件<font style="color:#DF2A3F;">  历史记录的存储</font></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712641872539-601ef4d4-b477-45be-9d18-123acbc5945c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712641881869-010a27e7-a133-46cb-8899-e7d68c391acc.png" alt=""></p> <p><font style="color:#DF2A3F;">BlackHole</font> 引擎  丢弃写操作，读操作返回空，记录一个BlackHole表日志</p> <p><font style="color:#DF2A3F;">CSV</font> 引擎  以逗号分割各个数据项  数据交换机制   .csv文件，excel和文本编辑器读取</p> <p><font style="color:#DF2A3F;">Memory </font>引擎， 数据存储到内存里面，响应快，数据会丢失，长度要不可变，hash索引和B+树索引</p> <p>hash索引等值比较快，范围比较慢，表的大小受到限制，目标数据小，频繁访问。丢了也无所的数据。</p> <p><font style="color:#DF2A3F;">Federated</font>引擎，访问远程表，默认是禁用的</p> <p><font style="color:#DF2A3F;">Merge</font>集合，管理多个MyISAM的表集合</p> <p><font style="color:#DF2A3F;">NDB</font>引擎，MySQL集群专用引擎，MySQL CLuster 分布式集群</p> <h2 id="索引"><a href="#索引" class="header-anchor">#</a> 索引</h2> <p>目录，页码，快速定位，二叉树 log2为底n的对数，减少IO次数</p> <p>数据结构  排好序的数据结构  跟存储引擎有关 innodb是b+树，索引最多16个，长度256字节</p> <ol><li>降低IO</li> <li>数据的唯一性</li> <li>加速表与表之间的连接</li> <li>减少查询中分组和排序的时间</li> <li>创建索引和维护索引耗费时间  数据量太大</li> <li>占磁盘空间 存储在磁盘上</li> <li>降低更新表的速度</li></ol> <p>先删除索引，再更新，再创建索引  小技巧</p> <p>数据存储的底层是<font style="color:#DF2A3F;">数据页</font>，默认大小16KB</p> <ol><li>主键有序，二分法</li> <li>其他列，最小记录开始依次遍历的单链表</li> <li>多个页，从第一页双向链表   索引应运而生</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712678093510-9e5089fb-def5-41ac-bf64-dcefb5106b65.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712677997227-9cd183f4-f537-4571-b753-9f22800dd341.png" alt=""></p> <p>数据页之间是双向链表，伴随着记录移动，页分类，主键值递增</p> <p>出现目录项  key是最小的主键值</p> <p>目录页出现了 数据页  页目录出现了  数据页也有页目录 目的是使用二分法</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712678913064-a362643c-0f51-489a-9759-b0e48c0d7fb0.png" alt=""></p> <p>目录页也可以是多个  再生成上层目录页</p> <p>B+树  叶子节点  根节点  非叶子节点  树的层次越低IO次数越少<img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712679627034-7f89d27c-63c4-42fa-93a1-2912ded9537a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712679874496-9e4bb979-3c36-4f94-9bf8-04b7a8916b74.png" alt=""></p> <p>compact行格式</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712677678918-bc8011f8-7e19-4661-802b-d53e9ff39c89.png" alt=""></p> <h2 id="聚簇索引"><a href="#聚簇索引" class="header-anchor">#</a> 聚簇索引</h2> <p>针对于主键构建的b+树</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712763576475-232e0030-1f42-4c47-a27f-f8847bfa7d46.png" alt=""></p> <p>数据存储方式 叶子节点（完整的用户记录）  索引即数据，数据即索引  数据和索引是一个整体</p> <p>页内 单项链表</p> <p>页和页 之间双向链表</p> <p>目录项记录的页 双向链表</p> <p>不需要create index</p> <p>数据访问快  排序查找和范围查找快省IO操作</p> <p>主键是自增的 插入速度跟插入顺序有关  主键不可更新  二级索引需要访问两次索引查找</p> <p>只能有一个聚簇索引     非空的唯一索引替代主键 隐藏列  选用有序的顺序id</p> <h2 id="非聚簇索引-二级索引-辅助索引"><a href="#非聚簇索引-二级索引-辅助索引" class="header-anchor">#</a> 非聚簇索引（二级索引/辅助索引）</h2> <p>针对于非主键构建的b+树   c2 加主键</p> <p>可以有多个</p> <p>找c3 回 聚簇索引 查找要进行回表</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712764129344-c80cb5df-0ee3-45b8-8f92-a4afca388f3c.png" alt=""></p> <p>非聚簇索引  更新/删除/新增 效率高  聚簇索引还需要维护<font style="color:#DF2A3F;">数据行的物理顺序</font>，而非聚簇索引只需要更改索引</p> <p>联合索引   两个字段进行索引 先c2再c3</p> <p>注意事项</p> <ol><li>根页面的位置万年不变 从上往下   下沉</li> <li>内节点中目录项记录是唯一的  二级索引内节点也保存了主键</li> <li>一个数据页最少要存两个</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712765191761-1976817e-14be-477b-b460-53cbc76eef84.png" alt=""></p> <p>MyISAM 索引和数据分开存储  不排序   全是非聚簇索引   主键加数据记录地址</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712765455307-5a18672e-5f65-4a09-ae0b-8b79b5d8c565.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712765580981-e71c2880-defe-444c-a6d4-eeb586c2b8c5.png" alt=""></p> <p>主键不建议过长，会导致树过长   自增主键最好</p> <p>缺点</p> <ol><li>空间上   16kb的数据页  存储空间大</li> <li>时间上  增/删/改  记录移位，页分裂，页面回收  索引从小到大的顺序</li></ol> <p><font style="color:rgb(51, 51, 51);">InnoDB使用了多种策略来决定淘汰哪些页：</font></p> <ol><li><font style="color:rgb(51, 51, 51);">LRU（最近最少使用）列表：InnoDB维护一个LRU列表，其中包含所有当前缓冲的页。最近使用的页在LRU列表的前端，而最少使用的页在列表的尾端。当空间不足时，将尾端页淘汰。</font></li> <li><font style="color:rgb(51, 51, 51);">页面脏页检查：在可用空间不足时，InnoDB还会检查LRU列表中的页面是否是脏页（已修改但未写入磁盘的页）。如果是脏页，则会优先进行检查点操作，将脏页写入磁盘，然后再进行页面淘汰。</font></li> <li><font style="color:rgb(51, 51, 51);">合并插入缓冲（Change Buffer）：对于非唯一索引页，如果插入或更新不会造成页的直写（直接将改动写入磁盘），可以使用合并插入缓冲区来减少I/O操作。</font></li> <li><font style="color:rgb(51, 51, 51);">自适应哈希索引：InnoDB还会利用自适应哈希索引来更快地访问频繁使用的页。</font></li></ol> <p><font style="color:rgb(51, 51, 51);">如果遇到页面淘汰频繁或发生错误，可能需要调整InnoDB的缓冲池大小，优化工作负载，或考虑增加服务器的物理内存。</font></p> <h2 id="数据结构的合理性"><a href="#数据结构的合理性" class="header-anchor">#</a> 数据结构的合理性</h2> <p>磁盘IO的操作次数</p> <h3 id="全表遍历"><a href="#全表遍历" class="header-anchor">#</a> 全表遍历</h3> <p>最差</p> <h3 id="hash结构"><a href="#hash结构" class="header-anchor">#</a> Hash结构</h3> <p>相同的输入可以得到相同的输出</p> <p>hashmap  操作是O1级别  key进行hash</p> <p>从效率上是hash快</p> <p>hash碰撞 产生链表</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712766730962-355d23e4-8fed-469d-8a01-78c99480a075.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712766865581-c0c8e500-3b4e-4c71-9bec-c3376ba045cc.png" alt=""></p> <p>Redis核心就是hash表</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712766966231-911fad13-b443-41d8-87c2-4fde7d301774.png" alt=""></p> <p>memory 等值查询用</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712767013646-9a5c1121-b8b7-4e58-8393-50e1cdc4d444.png" alt=""></p> <p>8.0 默认开启</p> <h3 id="二叉搜索树"><a href="#二叉搜索树" class="header-anchor">#</a> 二叉搜索树</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712798154016-e74868bb-b695-4e7c-a979-820bc19cc099.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712798172021-4e425f39-52e7-42ca-ab99-10e189c6cdf5.png" alt="">  不太理想</p> <h3 id="avl树"><a href="#avl树" class="header-anchor">#</a> AVL树</h3> <p>二叉平衡搜索树，它的左右两个树的高度差不会超过1，高度较高</p> <p>M叉树  高度变小</p> <h3 id="b-树"><a href="#b-树" class="header-anchor">#</a> B-树</h3> <p>多路平衡查找树</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712798994558-f1ba5e76-23b9-46c8-9e13-682d313f388a.png" alt=""></p> <p>关键字和叶子节点的信息都放在磁盘块2</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712799877863-a54a5dba-0e06-4565-85b2-f8f2715bd52b.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712799923169-4d757ee4-dafe-427f-a264-6fb4bcd580af.png" alt=""></p> <h3 id="b-树-2"><a href="#b-树-2" class="header-anchor">#</a> B+树</h3> <p>多路搜索树   适合索引系统 mysql官网看见b树就是b+树</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712800320088-9d01021e-3f55-4938-b77b-2117ff4585e2.png" alt=""></p> <p><font style="color:#DF2A3F;">B+树的查询效率更稳定   b树不稳定</font></p> <p><font style="color:#DF2A3F;">B+树的查询效率更高 B+树目录项的不存数据，更加矮胖，叉多</font></p> <p><font style="color:#DF2A3F;">范围查找  B+树链表遍历 B树要树进行遍历</font></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712800626898-c43c442a-d0bc-4f06-8d94-fa45b018c645.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712800661664-6e908789-a2b8-4998-800c-47ddb43b3f6a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712800892121-53546124-392d-4127-9cb2-203287d3926b.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712800958496-2227a46e-320e-4c4b-ad2e-9938d3e20690.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712801101414-4eed210d-4d87-4250-9403-80f25d3a95e9.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712801126960-e9ed7ec9-d04c-42a0-8a43-3f4346b4143e.png" alt=""></p> <h3 id="r树"><a href="#r树" class="header-anchor">#</a> R树</h3> <p>geometry 数据类型   空间  解决高维空间的搜索问题</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712801209890-3a685e39-08a0-4c57-ab30-0a826a287c07.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712801224995-9d076f8f-b3dd-4b0a-b697-ba4e46b6b679.png" alt=""></p> <h2 id="innodb数据存储结构"><a href="#innodb数据存储结构" class="header-anchor">#</a> InnoDB数据存储结构</h2> <p>索引是在存储引擎中的，存放格式不同  Memory 内存级别的 不用磁盘</p> <h3 id="页"><a href="#页" class="header-anchor">#</a> 页</h3> <p>默认大小16KB</p> <p>在数据库，不论读一行，还是多行，都是将这些行所在的页进行加载，也就是说，数据库管理存储空间的基本单位是页(Page)，数据库IO操作的最小单位是页</p> <div class="language-java extra-class"><pre class="language-java"><code>show variables like '<span class="token operator">%</span>innodb_page_size<span class="token operator">%</span>'<span class="token punctuation">;</span>
</code></pre></div><p>不在物理结构上相连，页之间双向链表，数据页内容单向链表，每个数据页都会生成一个页目录，为了用二分法</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712891496424-150873fa-3246-4d15-aec9-7ce1fe77ebc3.png" alt=""></p> <p>一个区会分配64个连续的页,区是1M空间</p> <p>段是数据库中的分配单位，不同类型的数据库对象以不同的段形式存在。</p> <p>表空间是逻辑容器，系统表空间和独立表空间</p> <h4 id="页的内部结构"><a href="#页的内部结构" class="header-anchor">#</a> 页的内部结构</h4> <p>数据页，系统页，Undo页，事务数据页  16KB</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712892288159-215e2cbc-7b1d-4a80-b5e6-0ed01675be7b.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712892300123-3d0c9264-60ba-49b2-980e-3227a9f730fd.png" alt=""></p> <h4 id="file-header"><a href="#file-header" class="header-anchor">#</a> File Header</h4> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712892596286-08edcb38-5db4-4f46-b6fa-415c9d425329.png" alt=""></p> <p>FIL_PAGE_TYPE</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712892686820-13f2c56a-c39b-4ab1-9095-940fa83c6fca.png" alt=""></p> <p>校验和</p> <p>比较两个页相等，根据算法算出来一个较短的值，节省比较的时间</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712898063431-6331d545-3dad-46df-82f0-ebac5812d71b.png" alt=""></p> <p>头部和尾部不相等，回滚或继续写入</p> <p>FIL_PAGE_LSN</p> <p>页面被最后修改时的日志位置</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712898538263-f9453c33-9909-48e3-a1eb-7d96e91b0ee4.png" alt=""></p> <h4 id="空闲空间"><a href="#空闲空间" class="header-anchor">#</a> 空闲空间</h4> <p>剩下空间，越来越小</p> <h4 id="用户记录"><a href="#用户记录" class="header-anchor">#</a> 用户记录</h4> <p>指定行格式，形成单链表   数据如何记录   记录头信息</p> <p>记录头信息</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712901002238-3a598ac2-078a-4861-a3a2-dd5c92fa93c8.png" alt=""></p> <p>delete_mask   0 没删除   1 删除   重新排序消耗性能   垃圾链表 可重用空间  删除新增时会重用</p> <p>min_rec_mask 非叶子节点最小记录  标记为1   自己插入的都是0</p> <p>record_type 记录类型</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712901982762-d1515ace-36ac-4889-a6c4-460fa5e6ef60.png" alt=""></p> <p>heap_no  当前记录在本页中的位置</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712902045479-7ba8ee73-b171-4dd5-adf9-d01e15abd4e1.png" alt=""></p> <p>n_owned   页目录每个组，存储了多少记录</p> <p>next_record 地址偏移量  最小记录指向了第一条记录   最大记录是 0</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712902777355-846a7b1d-cfb8-4d93-a045-f4430a3ce4e9.png" alt=""></p> <h4 id="最小和最大记录"><a href="#最小和最大记录" class="header-anchor">#</a> 最小和最大记录</h4> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1712902291793-7a49d8c2-74a4-450a-b482-fd55e274e521.png" alt=""></p> <h4 id="page-directory-页目录"><a href="#page-directory-页目录" class="header-anchor">#</a> Page Directory 页目录</h4> <p>分成几个组，包括最小和最大，不包括已删除</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713021946676-dc45089f-0424-4ee7-8725-7ce7e85e3be2.png" alt=""></p> <p>页目录用来存储每组最后一条记录的地址偏移量</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713022140857-ca765e1f-28b7-481d-b498-91c02fe2a4ca.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713022381161-ed0ee310-cf89-4f1b-8a78-2cf5c2571721.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713022521477-281a320c-58f7-42f5-8638-946eb02b9cb0.png" alt=""></p> <h4 id="页面头部"><a href="#页面头部" class="header-anchor">#</a> 页面头部</h4> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713022578170-f329922a-134d-4694-a6ed-46c0b856e8fa.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713022857753-0ae083ac-1463-46d4-846f-5e8e0b170e89.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713022919680-d9c6ddf1-ff3b-4f33-82e1-7734b16b3964.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713023095282-4e073abe-235a-4bda-94ef-3a42aba97a58.png" alt=""></p> <h3 id="innodb行格式"><a href="#innodb行格式" class="header-anchor">#</a> Innodb行格式</h3> <div class="language-java extra-class"><pre class="language-java"><code><span class="token constant">SELECT</span> @<span class="token annotation punctuation">@innodb_default_row_format</span><span class="token punctuation">;</span> # dynatic
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713023310866-a9c321ea-db31-4262-ada3-63ad8830e812.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713023395198-d0e318b4-eddd-44e9-adc1-dae7df89c08b.png" alt=""></p> <h4 id="变长字段长度列表"><a href="#变长字段长度列表" class="header-anchor">#</a> 变长字段长度列表</h4> <p>存储到底存了多大的数据，顺序反过来</p> <h4 id="null值列表"><a href="#null值列表" class="header-anchor">#</a> NULL值列表</h4> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713023698184-650a2c8a-475b-439f-8398-cdfe1360a884.png" alt=""></p> <p>不考虑非空和主键</p> <h4 id="记录的真实数据"><a href="#记录的真实数据" class="header-anchor">#</a> 记录的真实数据</h4> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713023784535-8b3b4ecb-0192-451a-9d43-8ebe2c432fea.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713023863143-3104348c-dd48-46a9-ae8a-7e32c8268811.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713024432152-a893a360-df14-4f29-808b-5d52b5812446.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713024648344-96c97ce7-51a9-40c9-a394-c0437ae969ef.png" alt=""></p> <h4 id="dynamic和compressed行格式"><a href="#dynamic和compressed行格式" class="header-anchor">#</a> Dynamic和Compressed行格式</h4> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713024956466-9128bfa1-073a-4626-8a76-5bf1e8bf6172.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713024985883-36c1c626-914e-4771-be28-99e0dd4e8dff.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713025012366-ce282c23-f860-4fbe-8483-e5ab9bb7fb28.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713025104814-4cdf8d47-0834-4cc1-9423-e20f270394e6.png" alt=""></p> <h4 id="redundant行格式"><a href="#redundant行格式" class="header-anchor">#</a> Redundant行格式</h4> <p>字段长度偏移列表</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713025324067-06987f2f-c602-4106-a7e5-ee69fcdebaff.png" alt=""></p> <p>记录头信息</p> <p>不一样</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713025415676-a98be097-e696-4b59-b8ff-6b13e37cfb9f.png" alt=""></p> <h2 id="区-段-碎片区"><a href="#区-段-碎片区" class="header-anchor">#</a> 区,段,碎片区</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713025642304-1c211333-75ee-49df-ab28-cd0b67880f25.png" alt=""></p> <p>保证一段是顺序存储，不是所有</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713025961211-23513ac3-0eba-4a5d-a8d9-d96586976a02.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713026045616-2594b2c8-9297-4fb5-93eb-7b02d12133a7.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713026465587-d0435af8-49c0-48a3-8878-ca74f6c9b73a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713026964272-87b4f39c-2dc6-4d31-9d8b-7509dbc98655.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713027136928-8832ea5a-2e30-432f-8f60-a3385244376a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713027193358-cf812c7c-51e9-4640-aab6-0361f5aa7153.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713027246938-46629c60-bec9-4730-998c-6903cfac7129.png" alt=""></p> <p>5.7 默认6个页 idb  96k</p> <p>8.0 不是 有表结构 多了一个页</p> <div class="language-java extra-class"><pre class="language-java"><code>show variables like 'innodb_file_oer_table'<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713027522539-f1a2f31f-3e83-4f1a-8604-67e91f538059.png" alt=""></p> <p>内部系统表  数据字段</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713027592858-1497aa82-62fa-4f1d-aea4-54ee191064e6.png" alt=""></p> <p>不能访问，information_schema 提供查看接口</p> <h2 id="索引-2"><a href="#索引-2" class="header-anchor">#</a> 索引</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713080337844-7393ef20-31e2-47d2-b8f4-3b74ac661be2.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713080764809-fa9836f5-85e8-4822-9a07-b5fe1a1816d6.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713080831178-54c7f585-45d1-4963-b615-115670975313.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713080912419-eedf87ab-6807-4573-a634-5fcf14925cba.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713080987776-70b419b6-3afc-4b90-94a2-c64f258e7e6a.png" alt=""></p> <p><font style="color:rgb(25, 27, 31);">nnoDB 中的哈希索引其实也就是</font><font style="color:rgb(25, 27, 31);"></font><font style="color:rgb(25, 27, 31);background-color:rgb(248, 248, 250);">自适应哈希索引（Adaptive Hash Index）</font></p> <p><font style="color:rgb(25, 27, 31);">InnoDB 会自动检测某些索引值是否使用的非常频繁</font></p> <p><font style="color:rgb(25, 27, 31);">通过自动创建 </font><font style="color:rgb(25, 27, 31);background-color:rgb(248, 248, 250);">自适应哈希索引</font><font style="color:rgb(25, 27, 31);"> 来提高查对热点数据的访问速度，特别是在频繁执行等值查询的情况下</font></p> <h3 id="创建索引"><a href="#创建索引" class="header-anchor">#</a> <font style="color:rgb(25, 27, 31);">创建索引</font></h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713081608652-50c1bc4e-f5fd-4961-bbd4-62cf25c9c835.png" alt=""></p> <p>普通索引</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713081648378-c1da40e3-3656-4685-8c31-356961e61faf.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713082269670-08f22513-039a-4e64-841c-399f2dca3fe1.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713082914950-4941904c-1586-4a62-92c8-eca3a78eab8e.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713083289400-3e1ab981-c257-41bb-96d6-85865195e749.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713083564313-a9847421-f0c2-411b-99a9-f70e4fe4c2dc.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713083652814-8e34cefc-da6e-4b06-9204-cf300f9fb30e.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713083706008-3637c1d4-2f57-4dbc-8abd-da5664ae72c0.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713083927915-dad70ea6-8120-4cb3-a57b-7754bec82c21.png" alt=""></p> <p>最左前缀原则</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084152490-85e3f919-729a-490d-a9f0-681aa287a039.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084230339-f424d9bb-ba79-4102-a2cf-7d8d0478574f.png" alt=""></p> <p>不精准，速度快</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084299618-cca88484-8719-4b84-99f5-576345fd5f4c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084510360-b7050fad-fc9f-4d3b-808c-b6e9a1ced002.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084573167-64af4fd1-b97f-4dec-8e3c-3d5f660482fa.png" alt=""></p> <h3 id="删除索引"><a href="#删除索引" class="header-anchor">#</a> 删除索引</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084688999-7f100189-229d-4f9f-8261-7c055302b6d4.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084741702-90d8a053-5088-4183-9e16-3612ec8fd17e.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084800212-f997e738-7545-4894-8b49-15574cd3030e.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713084916424-166fa54b-71fd-45cb-9a08-483cce4717f2.png" alt=""></p> <h3 id="降序索引-8-0"><a href="#降序索引-8-0" class="header-anchor">#</a> 降序索引（8.0）</h3> <p>支持降序排列</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085118600-114c1fd2-9c88-4927-90eb-35b7292f85be.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085275681-232d08d1-f2b3-4000-9fb2-f1057f773bd2.png" alt="">  这样就不推荐了 799了 正常就是5</p> <h3 id="隐藏索引-8-0"><a href="#隐藏索引-8-0" class="header-anchor">#</a> 隐藏索引（8.0）</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085377460-3a62a941-b467-4183-a6b9-3f4e3d560929.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085570551-0d37bb4d-0579-40e9-84ad-fb3078ac5b8d.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085659870-29836f2e-c2a5-4144-9ad8-7068cf0b7126.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085686185-d167da1c-3206-4f16-a60a-9caed95b1cc7.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085786891-380f2326-1852-4fa6-b1ec-faf7a2f46094.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085986309-edbb4124-0812-4a41-bd89-3d6ef8e0e1d9.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713085973724-227c9d08-7886-4032-9387-b9e9d830db75.png" alt=""></p> <h2 id="索引的设计原则"><a href="#索引的设计原则" class="header-anchor">#</a> 索引的设计原则</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713086473328-7b7a5d09-d7b2-4d06-9ad6-8fb2ffadcc87.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713086772969-6f48e497-defd-4ebd-95eb-a273ed633746.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713086781085-395d0b5f-0f6d-4b32-af5b-515423d2e066.png" alt=""></p> <h3 id="适合创建"><a href="#适合创建" class="header-anchor">#</a> 适合创建</h3> <ol><li>字段的数值有唯一性限制</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713087010874-6d822fcd-0d53-4c3e-8836-284e15def377.png" alt=""></p> <ol start="2"><li>频繁作为WHERE 查询条件的字段</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713087150749-f59603e4-5113-4c96-b094-bf3e7ac3f348.png" alt=""></p> <ol start="3"><li>经常group by 和 order by 的字段</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713087323239-3b0b44ae-de10-4945-a2b8-69c0811fa2d7.png" alt=""></p> <p><font style="color:rgba(0, 0, 0, 0.75);">group by或者order by后面的字段添加索引，由于索引是排好序的，所以建立索引就等同于在查询之前已经是排好序了</font></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713088096425-97c8ae6a-3e19-4e02-879e-458d14791a48.png" alt=""></p> <ol start="4"><li>UPDATE、DELETE的WHERE 条件列</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713088510082-c93bb764-8610-4ddb-83dc-fcc0d08057d2.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713090005969-e8682cb2-0dd3-4553-8b9a-25d2f7c94d6d.png" alt=""></p> <ol start="5"><li>DISTINCT字段需要创建索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713111145188-ff44c3d1-c1d6-4468-b62c-8bbd62eb9797.png" alt=""></p> <ol start="6"><li>连接表的数量尽量不要超过三张，对where 条件创建索引，对用于连接的字段创建索引，类型必须一致</li> <li>使用列的类型小的，创建索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713111892610-bc1231fb-119f-4c1e-8de2-c39c078516fc.png" alt=""></p> <ol start="8"><li>使用字符串前缀创建索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713112154533-03e90ada-26ad-493a-8781-9ffc2f372e32.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713112258569-4211f0e8-e49a-47f7-8afb-3e29677219ba.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713112437587-567a1c41-7463-46f1-9077-90d9061cc3d4.png" alt=""></p> <ol start="9"><li>区分度高(散列性高)的列适合作为索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713112511442-2dbe5db4-f155-4728-b807-a597ec6fcf4c.png" alt=""></p> <ol start="10"><li>使用最频繁的列放到联合索引的左侧</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713112925637-24b13e2d-6913-4c16-b7ef-b2501ace7115.png" alt=""></p> <ol start="11"><li>在多个字段都要创建索引的情况下，联合索引优于单值索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113006687-f34c247e-aa26-44d2-b73a-fb726ea358b2.png" alt=""></p> <h3 id="不适合创建"><a href="#不适合创建" class="header-anchor">#</a> 不适合创建</h3> <ol><li>where中使用不到的字段，不要设置索引</li> <li>数据量小的表最好不要使用索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113260041-03db4e3f-9113-4782-afc7-51d473b084ad.png" alt=""></p> <ol start="3"><li>有大量重复数据的列上不要建立索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113308238-c9c277b7-7489-4cd6-b704-a10b8bad3f32.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113391223-8662e08d-e933-4d3a-97aa-6a163d96fe7f.png" alt=""></p> <ol start="4"><li>避免对经常更新的表创建过多的索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113494115-eb561d24-bd60-464b-a3d0-13449b4e01f4.png" alt=""></p> <ol start="5"><li>不建议无序的值作为索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113636515-81194c2b-e369-4411-b2f7-938a578da751.png" alt=""></p> <ol start="6"><li>删除不再使用或者很少使用的索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113704008-c85ac976-a347-4c5f-aee2-c11b8bf1ab28.png" alt=""></p> <ol start="7"><li>不要定义冗余或者重复的索引</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713113824027-d9e620db-1262-4650-aab4-07b026ff90c3.png" alt=""></p> <h2 id="性能分析工具"><a href="#性能分析工具" class="header-anchor">#</a> 性能分析工具</h2> <p>响应时间更快，吞吐量更大 explain 和 show profiling</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713150547631-ff4af028-a347-43c5-9034-876be552c25a.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713150644143-789b5590-60c4-4796-b6c0-30708d62e430.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713150676714-0bfe1b53-89b8-4af9-b362-ee061409c8e9.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713150754163-34a632bf-a049-4475-9b92-f55b35a03d5b.png" alt=""></p> <h3 id="查看系统参数"><a href="#查看系统参数" class="header-anchor">#</a> 查看系统参数</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713150835505-d74bd258-9167-482c-9b03-9f175aefb24b.png" alt=""></p> <h3 id="统计sql查询的成本"><a href="#统计sql查询的成本" class="header-anchor">#</a> 统计sql查询的成本</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713151209091-b8bb1d71-c066-4e37-8371-4e94405cb67e.png" alt=""></p> <div class="language-java extra-class"><pre class="language-java"><code>show status like 'last_query_cost'<span class="token punctuation">;</span>
</code></pre></div><p>1 就是一个数据页</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713151530002-666a1305-ad10-4a66-a765-734a669b4762.png" alt=""></p> <h3 id="定位执行慢的sql-慢查询日志"><a href="#定位执行慢的sql-慢查询日志" class="header-anchor">#</a> 定位执行慢的SQL：慢查询日志</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713171796928-b28fac34-046c-4fe8-bde2-7e3c547402e2.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>show variables like <span class="token string">'%slow_query_log%'</span><span class="token punctuation">;</span>// 查看是否开启慢查询
<span class="token builtin class-name">set</span> global slow_query_log <span class="token operator">=</span> ON<span class="token punctuation">;</span>
show variables like <span class="token string">'%long_query_time%'</span><span class="token punctuation">;</span>// 查看慢查询的时间阈值
<span class="token builtin class-name">set</span> global <span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>// 新建会话生效
<span class="token builtin class-name">set</span> session <span class="token assign-left variable">long_query_time</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>// 当前会话生效
show global status like <span class="token string">'%slow_queries%'</span><span class="token punctuation">;</span>// 查看有多少
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713172299762-450c9f76-a251-47e4-add1-27c0d7b8d670.png" alt="">文件配置写法</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713198538732-c4e8c105-efb9-4231-ba5c-a8b6c52d2df7.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>mysqldumpslow <span class="token parameter variable">-help</span>
mysqldumpslow <span class="token parameter variable">-a</span> <span class="token parameter variable">-s</span> t <span class="token parameter variable">-t</span> <span class="token number">5</span> 文件位置/文件
<span class="token parameter variable">-a</span> 不模糊参数
<span class="token parameter variable">-s</span> t 根据时间排序
<span class="token parameter variable">-t</span> <span class="token number">5</span> top5
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713198805624-9ff73047-e786-4ec8-b6b6-3fce11e109e9.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713199125720-ec8dea9e-f798-448f-9c63-9a1dad6a973a.png" alt=""></p> <h3 id="show-profile-查看sql执行成本"><a href="#show-profile-查看sql执行成本" class="header-anchor">#</a> SHOW PROFILE  查看SQL执行成本</h3> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token builtin class-name">set</span> <span class="token assign-left variable">profiling</span><span class="token operator">=</span> ON<span class="token punctuation">;</span>
show variables like <span class="token string">'profiling'</span><span class="token punctuation">;</span>
show profiles<span class="token punctuation">;</span>
show profile cpu,block io <span class="token keyword">for</span> query <span class="token number">3</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713199570778-419ff37b-c7c2-439f-b6a7-9da35542aa8a.png" alt=""></p> <h3 id="explain-分析查询语句"><a href="#explain-分析查询语句" class="header-anchor">#</a> EXPLAIN 分析查询语句</h3> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713200007325-112522ec-b1ef-4965-a4fb-7b4ad821786f.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713276012212-7ee36b09-dfd0-40f7-9bfb-d0385d365914.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713276034116-82c0c035-d1c1-4502-9ef1-0ea2f4f48fc3.png" alt=""></p> <p>查询优化器可能对涉及的子查询的语句进行重新，转变为多表查询的操作</p> <p>union 有临时表     union all 没有</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713277138641-2c3dec0b-6cbd-4bb3-901b-30cb813d6355.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713277837377-a03cb934-16e4-46ec-8b8b-de4d3e507401.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713278130200-7f28f042-042a-4f6a-9998-e1329dd64c05.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713365973115-2c38ff36-687f-4ee4-b1c6-331c97874111.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713366689388-964cacee-9d6a-4e9b-8819-b4d27a8b532c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713367231177-0083e406-1469-4c5c-9947-85464eb7ad7c.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713428592387-1c5acf69-23b1-4428-be34-5d404ad78831.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713428639917-c5e501b8-f973-4db4-871e-08ed334e850e.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>show warnings // 优化器优化后的结果
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452069975-60947ed1-aa4b-4b91-9f96-6c67056e30b4.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452153373-fca8cd22-5a94-42ae-a31c-315b49922a38.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452320637-18422d9c-3b9b-455f-a734-610f0205b01c.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452401045-ff643ea2-5411-442b-84e1-96844e108712.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452437370-66f27b65-37f8-48db-93f4-510a921604d0.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452490133-d3bdd585-0e07-4497-bc08-bee8a44a4f9d.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452525512-3940b428-6d05-40e6-9e0b-c26360fe4d28.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452566578-f9b791d2-bc6f-460e-b329-625b2dbe9dc6.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452591908-12bcc743-eb75-41da-b135-7b04b0747aca.png" alt=""></p> <h2 id="索引优化与查询优化"><a href="#索引优化与查询优化" class="header-anchor">#</a> 索引优化与查询优化</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713452675381-e8939b92-9970-43f4-9f5a-8ec6af31392d.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713453900949-7f8ba726-4a34-43e8-9a71-40b652a29ff7.png" alt=""></p> <ol><li>全值匹配我最爱</li> <li>最佳左前缀法则</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713454924378-e3780ce1-1515-4ed4-95e2-0a02760eefca.png" alt=""></p> <ol start="3"><li>主键插入顺序</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713454981176-ca3e8068-ebfc-4070-885f-0d197d8e0894.png" alt=""></p> <ol start="4"><li>计算、函数、类型转换导致索引失效</li> <li>类型转换导致索引失效</li> <li>范围条件右边的列导致索引失效</li> <li>不等于索引失效</li> <li>is null 可以使用索引，in not null 不可以</li> <li>like 以 %开头失效</li> <li>or前后出现非索引列</li> <li>数据库的字符要统一使用utf8mb4</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713797924349-36c9aabe-5a58-4e3c-bbc3-844eb1f400dc.png" alt=""></p> <p>内连接是可以决定谁作为驱动表，谁作为被驱动表出现的</p> <p>被驱动表有索引，成本低</p> <p>小表驱动大表</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713889997076-5549b7c2-1a93-47d4-8081-34011bc18e50.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713890108492-26976bdc-114e-45e1-a60f-0d492a607c85.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713890418242-92f84360-48c4-440d-a4ba-c76040f3d8a9.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1713890741306-b50b13c4-cdcf-4103-8b94-ef7c720b6f77.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714009823064-a928a5b3-2f24-42f6-afc9-9b37eb210182.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714015286398-dad56407-1929-4ed5-8242-98ba5085ac43.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714015963206-1d27015b-87bd-4ba5-a77a-930c9298fb89.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714024109740-7f53ff44-6bde-4082-b105-10ecefc01a78.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714024164207-9fcd3403-9601-497b-984c-857de246f67f.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714024213782-112a09b4-ee02-4b45-98bf-ee2639c67144.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714024347762-7e6ca12d-9064-4f09-9ef0-a84d78700b1d.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714035301144-72e9c3a4-c34a-4eaf-ad32-8bf43b90d0cc.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1714035479684-ca2d6360-c38a-4274-8db9-2c5c8458a9df.png" alt=""></p> <h3 id="覆盖索引"><a href="#覆盖索引" class="header-anchor">#</a> 覆盖索引</h3> <p><font style="color:#DF2A3F;">一个索引包含了满足查询结果的数据</font>就叫做覆盖索引。</p> <p>索引列+主键  =  SELECT 到 FROM 的查询列</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715070730550-fdffdebb-41e3-4388-9ea8-216278167206.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715070752479-a9e2951b-c716-4269-9b73-242b7550e982.png" alt=""></p> <h2 id="索引下推"><a href="#索引下推" class="header-anchor">#</a> 索引下推</h2> <p>减少了回表的次数，针对于联合索引，过滤完再回表，有字段 ICP</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715072847346-f22a36a8-a321-43cf-ac3a-904ee1b7fad9.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073018862-5cd8a246-695f-4e7e-8334-9d5047486259.png" alt="">    不使用索引下推</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073146156-88c9b428-bab3-48c4-9a26-41a0cb9c947a.png" alt=""></p> <h2 id="补充优化"><a href="#补充优化" class="header-anchor">#</a> 补充优化</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073376718-4bd11760-2b1c-4fbf-b7b2-214c0c063678.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073703535-f05a0649-9ce0-4f97-bb56-7e6827d0a575.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073753228-78c013d1-7265-4eb7-8739-d1c0168e087c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073856250-83b98d17-db83-4a1b-81e2-644c200f695f.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1715073874358-eb838bc4-56b4-4156-b4ff-f98ca40d507a.png" alt=""></p> <h2 id="数据库设计"><a href="#数据库设计" class="header-anchor">#</a> 数据库设计</h2> <h2 id="主键设计"><a href="#主键设计" class="header-anchor">#</a> 主键设计</h2> <ol><li>自增id</li></ol> <ul><li>可靠性不高  自增回溯问题</li> <li>安全性不高   可以猜测用户数量</li> <li>性能差 服务器端生成</li> <li>交互多    last_insert_id()   多一次交互</li> <li>局部唯一</li></ul> <ol start="2"><li>业务主键</li></ol> <p>推荐 全局唯一，单调递增。</p> <p>UUID  在8.0 推荐  因为可以时间的高低换位</p> <p>淘宝订单号    时间+ 去重字段 + 用户id 后几位</p> <h2 id="数据库设计-2"><a href="#数据库设计-2" class="header-anchor">#</a> 数据库设计</h2> <ol><li>节省数据的存储空间</li> <li>能够保证数据的完整性</li> <li>方便进行数据库应用系统的开发</li></ol> <p>冗余度较小、结构合理</p> <h2 id="范式"><a href="#范式" class="header-anchor">#</a> 范式</h2> <p>数据库设计的基本原则</p> <p>阶数越高冗余度</p> <p>一般也就巴斯-科德范式</p> <h3 id="第一范式"><a href="#第一范式" class="header-anchor">#</a> 第一范式</h3> <p>原子性，字段值不可再次拆分，主观性的</p> <h3 id="第二范式"><a href="#第二范式" class="header-anchor">#</a> 第二范式</h3> <p>满足数据表里面得有主键，非主键字段完全依赖于主键，不能只依赖于主键的一部分，一张表只表达一个意思。</p> <h3 id="第三范式"><a href="#第三范式" class="header-anchor">#</a> 第三范式</h3> <p>非主键字段不能依赖于其他非主键字段。  他们之间必须相互独立。直接相关，消除冗余。</p> <p>范式  表关联多了，降低了查询效率。冗余可以反范式化。</p> <h3 id="反范式化"><a href="#反范式化" class="header-anchor">#</a> 反范式化</h3> <p>业务优先，增加冗余字段。</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716370554380-f3e18ebf-4063-4ae8-aab0-afbd7f977949.png" alt=""></p> <p>浪费空间，修改部门，全部的冗余字段也要修改。要不然会数据不一致。而且存储过程去更新会消耗，系统资源。并且数据量小，会使得数据库设计变复杂。</p> <ol><li>不需要经常更改的字段</li> <li>查询的时候不可或缺</li></ol> <p>历史快照，订单收货信息。</p> <p>数据库设计的目的是捕获数据，数据仓库是分析数据。 数据仓库因为是历史数据，可以考虑反范式化。</p> <h3 id="巴斯-科德范式"><a href="#巴斯-科德范式" class="header-anchor">#</a> 巴斯-科德范式</h3> <p>只有一个候选键，或者每个候选键都是单属性。不存在部分依赖</p> <p>仓库名，管理员，物品名，数量  这个就不是BCNF</p> <p>主键和候选建有依赖关系不行</p> <p>学生、导师、学科、CPA</p> <h3 id="第四范式-很少了"><a href="#第四范式-很少了" class="header-anchor">#</a> 第四范式（很少了）</h3> <p>平凡的多值依赖   整个表就是一组一对多的关系。</p> <h3 id="第五范式-完美范式"><a href="#第五范式-完美范式" class="header-anchor">#</a> 第五范式（完美范式）</h3> <p>消除不是由候选键所蕴含的连接依赖。理论中</p> <p><font style="color:#DF2A3F;">技术服务于业务</font></p> <h3 id="er模型三要素"><a href="#er模型三要素" class="header-anchor">#</a> <font style="color:#000000;">ER模型三要素</font></h3> <p>实体，属性，关系</p> <p>可以独立存在的叫实体，不可再分的是属性。</p> <h3 id="数据表的设计原则"><a href="#数据表的设计原则" class="header-anchor">#</a> 数据表的设计原则</h3> <ol><li>数据表的个数越少越好</li> <li>数据表的字段个数越少越好</li> <li>数据表中联合主键的字段个数越少越好</li> <li>主键和外键越多越好</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716448751979-7cab9df4-d307-4d2b-acd3-d4036bac34c6.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716448847016-65bd766c-57da-4d3a-94a6-e8ee278ec7dc.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716452501868-0247e487-5670-4837-837a-fb93c3b3fcc3.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716453170806-d98f9213-fc6d-4d81-a187-ede24628fdf7.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716453184529-bc87fe3f-2938-4bed-80ee-321151b01b35.png" alt=""></p> <h2 id="结构设计"><a href="#结构设计" class="header-anchor">#</a> 结构设计</h2> <ol><li>冷热数据分离，减少磁盘IO，增加热数据内存缓存的命中率，更有效的利用缓存，避免读入无用的冷数据。</li> <li>增加中间表，经常联合表查询，增加查询效率。不是频繁更新。</li> <li>增加冗余字段</li> <li>优化数据类型，最小的数据类型。字段大，空间大，每一页索引存储的数量就少，IO次数也就越多。</li> <li>LOAD DATA INFILE 比insert 导入快。</li></ol> <p>分析表/检查表/优化表</p> <div class="language-shell extra-class"><pre class="language-shell"><code>ANALYZE TABLE 表名<span class="token punctuation">;</span> -- 更新表的分享，比如show index from 表名<span class="token punctuation">;</span>里面的区分度。
CHECK TABLE 表名<span class="token punctuation">;</span> -- 查看表有没有问题，损毁。
OPTIMIZE TABLE 表名<span class="token punctuation">;</span> -- 优化表 varchar blob text 优化
</code></pre></div><p>mysqlcheck -o 数据库 表名 -uroot -p</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716778824595-98433eff-b8fe-43cf-a7b5-0f41096252cb.png" alt=""></p> <p>服务器语句超时处理</p> <p>创建全局通用表空间</p> <p>8.0 隐藏索引进行调优  看查询参数。</p> <h2 id="事务"><a href="#事务" class="header-anchor">#</a> 事务</h2> <p>InnoDB 支持事务</p> <p>要么都成功，要么都失败</p> <p>原子性 无中间状态</p> <p>一致性 合法性 符合现实</p> <p>隔离性 不能被其他事务干扰</p> <p>持久性 事务一旦提交数据就是永久性的</p> <h2 id="状态"><a href="#状态" class="header-anchor">#</a> 状态</h2> <ol><li>活动的</li> <li>部分提交的</li> <li>失败的</li> <li>中止的</li> <li>提交的</li></ol> <h2 id="事务基础知识"><a href="#事务基础知识" class="header-anchor">#</a> 事务基础知识</h2> <ol><li>开启事务</li> <li>一系列DML操作</li> <li>事务结束的状态  提交commit / 中止 rollback</li></ol> <h3 id="显式事务"><a href="#显式事务" class="header-anchor">#</a> 显式事务</h3> <ol><li>开启事务 start transaction;  begin;</li> <li>start transaction 后面 read only，read write（默认），with consistent snapshot</li> <li>保存点 savepoint</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716797235525-8a298b8d-2acb-437e-88d6-236fdec5873b.png" alt=""></p> <h3 id="隐式事务"><a href="#隐式事务" class="header-anchor">#</a> 隐式事务</h3> <ol><li>autocommit 自动提交 默认是ON</li> <li>SET autocommit = OFF; 关闭自动提交    DDL无效</li></ol> <h2 id="事务分类"><a href="#事务分类" class="header-anchor">#</a> 事务分类</h2> <ol><li>扁平事务</li> <li>带有保存点的扁平事务</li> <li>链事务   set @@completion_type= 1；</li> <li>嵌套事务</li> <li>分布式事务</li></ol> <h2 id="事务的隔离性"><a href="#事务的隔离性" class="header-anchor">#</a> 事务的隔离性</h2> <p>脏写   事务A 修改了 事务B未提交的数据</p> <p>脏读   事务A 读取了 事务B未提交的数据</p> <p>不可重复读  事务A 读取了2次 数据不一样    少了可以算这里面</p> <p>幻读  事务A  读取了2次 行数多了                删除不算</p> <ol><li>读未提交  最差  不怎么选</li> <li>读已提交  解决了脏读  oracle 默认</li> <li>可重复读</li> <li>串行化</li></ol> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716948135749-832addf1-7600-4db3-a561-f4e5f579765b.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716948927761-88af3092-3cac-429d-ae42-5d89d1ded1b9.png" alt=""></p> <h3 id="mysql支持的隔离级别"><a href="#mysql支持的隔离级别" class="header-anchor">#</a> MySQL支持的隔离级别</h3> <div class="language-shell extra-class"><pre class="language-shell"><code>show variables like <span class="token string">'tx_isolation'</span><span class="token punctuation">;</span>
show variables like <span class="token string">'transaction_isolation'</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> @@transaction_isolation<span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716951624841-13396cc7-3bd2-4d4c-a267-489465054e23.png" alt=""></p> <h2 id="事务日志"><a href="#事务日志" class="header-anchor">#</a> 事务日志</h2> <p>重做日志 redo日志  保证持久性</p> <p>回滚日志 undo日志  保证一致性</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716965260748-e313592a-9df9-4baf-ba1a-bc71350a9de0.png" alt=""></p> <p>redo 日志 降低了刷盘频率</p> <p>redo 日志 占用空间小</p> <p>redo 日志 是顺序写入磁盘的。</p> <p>redo 日志 在事务执行过程中，不断的写入  和 binlog 并不相同 binlog只有在事务提交才记录。</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716991328593-8c1db232-602e-439a-9af4-c671714c61a3.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1716992803264-29c3297f-62a3-4af9-bd91-d9849e7071d7.png" alt=""></p> <p>时间花费从小到大 0 &lt; 2 &lt; 1</p> <p>Innodb的更新操作采用的是 Write Ahead Log 预先日志持久化 先写日志，再写入磁盘，中间经过redo log buffer</p> <h2 id="undo日志"><a href="#undo日志" class="header-anchor">#</a> Undo日志</h2> <p>更新数据的前置操作，写入undo log  撤销日志  回滚日志</p> <ol><li>回滚数据    只是逻辑层面的，物理层面的不会改变，不会删除创建的数据页</li> <li>MVCC 多版本并发控制</li></ol> <p>回滚段，一个回滚段1024个 undo log  segment</p> <p>insert undo log 直接删除</p> <p>update undo log 不能直接删除，undo log 链表中，等待清除线程删除</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717123506533-8858157c-d878-46d9-8da3-4c5bfca771a2.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717125623698-bacb57e4-e515-4b03-b77b-17ec3856fd9e.png" alt=""></p> <h2 id="锁"><a href="#锁" class="header-anchor">#</a> 锁</h2> <p>保证事务的隔离性，保证数据的一致性和完整性。</p> <p>相同记录</p> <p>锁结构 和事务相关   排队</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717142227691-5dc08e87-22f3-4ae3-9464-bad0808606ea.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717144552948-7ae4adec-b5e6-46fb-b103-aad5751d7c92.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717506309180-1dd28844-8c14-4f5a-b21a-736ad5870a05.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>lock tables 表名 <span class="token function">write</span><span class="token punctuation">;</span> // 写锁
lock tables 表名 <span class="token builtin class-name">read</span><span class="token punctuation">;</span> // 读锁
unlock tables<span class="token punctuation">;</span> // 解锁
show <span class="token function">open</span> tables where in_use <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>// 查看锁
</code></pre></div><ul><li>意向锁 行级锁和表级锁 共存</li></ul> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717507157955-22c985db-da43-4308-8964-a006280f56b0.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717507198894-4da8f6c3-5381-42e7-84a0-f3b29835e30a.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717508223951-8fa7c411-39fb-46a8-9b2e-58a7b72833b5.png" alt=""></p> <p>意向锁 排外不排内  相当于表级阻塞  给整个表加了一个标识</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1717508483827-ee17bd11-6c6f-4d31-a9a7-e5a2d6a52722.png" alt=""></p> <p>自增锁  表级锁</p> <ol><li>单行添加</li> <li>批量添加</li> <li>混合添加</li></ol> <p>对应三种模式  innodb_auto_lock_mode 0 1 2</p> <p>元数据锁</p> <ol><li>表结构变更</li> <li>crud MDL 读锁   变更操作 MDL 写锁</li></ol> <h2 id="记录锁-行锁"><a href="#记录锁-行锁" class="header-anchor">#</a> 记录锁（行锁）</h2> <h2 id="间隙锁-gap锁"><a href="#间隙锁-gap锁" class="header-anchor">#</a> 间隙锁  gap锁</h2> <ol><li>防止幻影记录，取区间加锁，在两个数值之间。  大于最大的值，到正无穷</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token keyword">select</span> * from performance.schema.data_locks<span class="token punctuation">;</span>
</code></pre></div><p>聚簇索引 有个无穷小和无穷大 指向前面和最后的数据   有可能出现死锁。</p> <p><font style="color:#DF2A3F;">临建锁</font> 结合了记录锁和间隙锁   Innodb默认是临建锁</p> <p><font style="color:#DF2A3F;">插入意向锁 </font><font style="color:#000000;">Innodb规定事务在等待的时候也需要在内存中生成一个锁结构。并不阻止别的事务继续获取该记录上任何类型的锁。</font></p> <h2 id="页锁"><a href="#页锁" class="header-anchor">#</a> 页锁</h2> <p>介于表锁和行锁之间，也会出现表锁和锁升级。</p> <h2 id="悲观锁"><a href="#悲观锁" class="header-anchor">#</a> 悲观锁</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718035110010-0709fe9d-e512-4beb-9d92-4d822dd1a716.png" alt=""></p> <h2 id="乐观锁"><a href="#乐观锁" class="header-anchor">#</a> 乐观锁</h2> <p>版本号或者时间戳</p> <p>读写分离 强制读取主机</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718036269042-6b0afa56-7bff-4b81-a229-7608d92a5257.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718036292871-abc06eff-b73b-46ef-945b-38f72c54955e.png" alt=""></p> <h2 id="显式锁-隐式锁"><a href="#显式锁-隐式锁" class="header-anchor">#</a> 显式锁/隐式锁</h2> <p>插入一条数据，保护这条数据叫隐式锁。</p> <p>事务2看事务1是否是活跃状态，如果是的话，帮助事务1构建一个锁结构。自己阻塞一下。</p> <p>非聚簇索引 page headers 里面有个最大事务id，这个id和事务二比较，小的话就全部都提交了</p> <p>延迟加锁   隐式锁转成显式锁</p> <h2 id="全局锁"><a href="#全局锁" class="header-anchor">#</a> 全局锁</h2> <p>整个数据库实例加锁，当你需要让整个库处于只读，全库逻辑备份。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>Flush tables with <span class="token builtin class-name">read</span> lock
</code></pre></div><h2 id="死锁"><a href="#死锁" class="header-anchor">#</a> 死锁</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718124561030-7b788dd6-d18c-4f69-9fc6-bb61310f8c6e.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718124869125-e7d7ad4d-51ca-4a84-a174-983778bde29c.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718125095243-81e48d2f-49e9-4486-abbc-66b1689debb1.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718125201838-85c36a3f-f7c6-43bc-ba46-574024d45652.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718125276128-8c637e48-cd8a-401a-a920-b2a3d7881a73.png" alt=""></p> <h2 id="锁的内存结构"><a href="#锁的内存结构" class="header-anchor">#</a> 锁的内存结构</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718125750686-bd2affb9-76b3-4b5b-b61f-75c72de0a88d.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>show status like <span class="token string">'%innodb_row_lock%'</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718126361752-8eb89fa4-ba4e-4cbf-8826-bc6de687cc0d.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718126425921-14d789d6-9b7a-4979-91f9-381968d02a10.png" alt=""></p> <h2 id="mvcc"><a href="#mvcc" class="header-anchor">#</a> MVCC</h2> <p>多版本并发控制 依赖于隐藏字段、Undo log 和 Read View</p> <p>一致性读 快照读  看见被事务更改之前的值</p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1718172975149-5325701f-e270-4585-8e25-935c6bef36b3.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719291385783-9924c1d1-0904-45fd-aec7-7a4b699bf6ed.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719291467070-e335fff2-de0a-453d-bc31-eac8b4100733.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719291707917-22b32b7c-9d38-4024-8f63-4219d3d45a74.png" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719376350374-5666b669-078a-4195-8b96-61248debb492.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719376368800-27ae4b61-b6fe-478d-8ee7-b7407104a44b.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719376945525-e3b2f14b-3981-49f7-a21e-7286b5081348.png" alt=""><img src="" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719377584525-ed6fc235-e174-40b9-a99f-17c00848e71d.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719377632251-1b04e3b8-f2e0-4821-81b4-510975e910da.png" alt=""></p> <h2 id="日志"><a href="#日志" class="header-anchor">#</a> 日志</h2> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1719817415009-cd50f7c9-2750-48c7-b16d-f4598f75b629.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1719817422127-3dcf6131-5a35-4745-ad0c-502a687346ae.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1719817437806-8563b8b6-679c-4d42-84d4-bdac1fc846d5.jpeg" alt=""><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719898164013-f2e84656-4566-4387-853d-6a721f6d3db0.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719898171373-1e8b66df-b3ec-4842-b0ef-94011cff8802.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719898180173-b76f2b97-23fe-4a73-a649-6bfe4bb0745c.png" alt=""></p> <div class="language-shell extra-class"><pre class="language-shell"><code>flush logs<span class="token punctuation">;</span> // 重新生成binlog日志
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>mysqlbinlog <span class="token parameter variable">-v</span> <span class="token string">&quot;/var/lib/mysql/binlog/atguigu-bin.000002&quot;</span>
</code></pre></div><div class="language-shell extra-class"><pre class="language-shell"><code>show variables like <span class="token string">'%log_bin%'</span><span class="token punctuation">;</span>
</code></pre></div><p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719930430344-387f321e-10f7-48ab-80e3-ffb320f73f1d.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719930498781-d8c6b31a-672b-42e3-b6c4-df30bf447f91.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719931369840-49f4b4ff-d141-4393-9608-af32c141a740.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/png/33708367/1719931442570-ea89df3c-5f3d-4fb4-a24a-cdb19690a840.png" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1721278612549-bdb2b680-5993-40f9-ac3f-51abdbf35072.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1721278614424-f76b1b58-06bf-4340-8cd5-1c07dae1785a.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1721278616045-2dc06414-908e-433b-b0c3-0a2a89425b87.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1721278617717-117098e7-259b-499b-be14-cc370844f2a9.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1721278619360-d1f61447-e2d8-4d39-b4b2-b48a1d833e0e.jpeg" alt=""></p> <p><img src="https://cdn.nlark.com/yuque/0/2024/jpeg/33708367/1721278621058-302402cd-57c7-45fc-ae0e-e8e019f6dc4e.jpeg" alt=""></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">更新时间:</span> <span class="time">2024年11月5日星期二下午4点33分</span></div></footer> <!---->  <!----></main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/assets/js/app.c2492ba0.js" defer></script><script src="/assets/js/7.6855d7f5.js" defer></script><script src="/assets/js/1.3a8374e6.js" defer></script><script src="/assets/js/38.5db24d98.js" defer></script><script src="/assets/js/22.15b12c38.js" defer></script>
  </body>
</html>
